<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>合同存证 | Cups</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Fabric">
    <meta name="description" content="下面的做法在一个只求跑通区块链的项目中是费时费力且不讨好。 1、orderer是一个单独的组织，有一套独立的证书（MSP），任何网络必不可少。对其在实际的组之间进行化分是没有意义的。该组织只提供排序，分发等服务。 2、需要配置的配置文件如果仔细追究的话，需要配置的东西是非常多的。 3、各组织之间不需要有共同的根ca。节点启动时从创世区块或者通道配置中读取被信任的根证书组。 4、cryptogen">
<meta name="keywords" content="Fabric">
<meta property="og:type" content="article">
<meta property="og:title" content="合同存证">
<meta property="og:url" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;2020&#x2F;10&#x2F;05&#x2F;2020&#x2F;contract-deposit&#x2F;index.html">
<meta property="og:site_name" content="Cups">
<meta property="og:description" content="下面的做法在一个只求跑通区块链的项目中是费时费力且不讨好。 1、orderer是一个单独的组织，有一套独立的证书（MSP），任何网络必不可少。对其在实际的组之间进行化分是没有意义的。该组织只提供排序，分发等服务。 2、需要配置的配置文件如果仔细追究的话，需要配置的东西是非常多的。 3、各组织之间不需要有共同的根ca。节点启动时从创世区块或者通道配置中读取被信任的根证书组。 4、cryptogen">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;contract-deposit&#x2F;map.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;contract-deposit&#x2F;pem.png">
<meta property="og:updated_time" content="2020-10-12T12:27:54.087Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;contract-deposit&#x2F;map.png">
    
    <link rel="shortcut icon" href="/img/brand.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/the_Huanghe_River.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">CupsWen</h5>
          <a href="mailto:1191567189@qq.com" target="_blank" rel="noopener" title="1191567189@qq.com" class="mail">1191567189@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/index.html"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/CupsWen" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://cupswen.github.io/hyperlink"  >
                <i class="icon icon-lg icon-link"></i>
                Link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">合同存证</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">合同存证</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-10-05T12:14:10.000Z" itemprop="datePublished" class="page-time">
  2020-10-05
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（一）业务流程"><span class="post-toc-text">（一）业务流程</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（二）组织、域名、ip匹配表"><span class="post-toc-text">（二）组织、域名、ip匹配表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（三）网络"><span class="post-toc-text">（三）网络</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（四）虚拟机"><span class="post-toc-text">（四）虚拟机</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1、防火墙"><span class="post-toc-text">1、防火墙</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2、hosts文件"><span class="post-toc-text">2、hosts文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3、镜像1-4-3"><span class="post-toc-text">3、镜像1.4.3</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4、bin文件1-4-3"><span class="post-toc-text">4、bin文件1.4.3</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（五）CA"><span class="post-toc-text">（五）CA</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1、根证书"><span class="post-toc-text">1、根证书</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2、ca-root-com-192-168-30-2"><span class="post-toc-text">2、ca.root.com(192.168.30.2)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）ca-root-com-config-yaml"><span class="post-toc-text">（1）ca.root.com-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）ca-root-com-yaml"><span class="post-toc-text">（2）ca.root.com.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）启动ca-root-com"><span class="post-toc-text">（3）启动ca.root.com</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）登记注册"><span class="post-toc-text">（4）登记注册</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（5）fabric-ca-client-config-yaml"><span class="post-toc-text">（5）fabric-ca-client-config.yaml*</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3、ca-court-com-192-168-30-3"><span class="post-toc-text">3、ca.court.com(192.168.30.3)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）ca-court-com-config-yaml"><span class="post-toc-text">（1）ca.court.com-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）初始化"><span class="post-toc-text">（2）初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）ca-court-com-yaml"><span class="post-toc-text">（3）ca.court.com.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）启动ca-court-com"><span class="post-toc-text">（4）启动ca.court.com</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（5）登记注册"><span class="post-toc-text">（5）登记注册</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4、tls-court-com-192-168-30-3"><span class="post-toc-text">4、tls.court.com(192.168.30.3)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）ca-court-tls-com-config-yaml"><span class="post-toc-text">（1）ca.court.tls.com-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）初始化-1"><span class="post-toc-text">（2）初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）ca-court-tls-com-yaml"><span class="post-toc-text">（3）ca.court.tls.com.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）启动ca-court-tls-com"><span class="post-toc-text">（4）启动ca.court.tls.com</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（5）登记注册-1"><span class="post-toc-text">（5）登记注册</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5、ca-user-com-192-168-30-4"><span class="post-toc-text">5、ca.user.com(192.168.30.4)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）ca-user-com-config-yaml"><span class="post-toc-text">（1）ca.user.com-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）初始化-2"><span class="post-toc-text">（2）初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）ca-user-com-yaml"><span class="post-toc-text">（3）ca.user.com.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）启动ca-user-com"><span class="post-toc-text">（4）启动ca.user.com</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（5）登记注册-2"><span class="post-toc-text">（5）登记注册</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6、tls-user-com-192-168-30-4"><span class="post-toc-text">6、tls.user.com(192.168.30.4)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）ca-user-tls-com-config-yaml"><span class="post-toc-text">（1）ca.user.tls.com-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）初始化-3"><span class="post-toc-text">（2）初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）ca-court-tls-com-yaml-1"><span class="post-toc-text">（3）ca.court.tls.com.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）启动ca-court-tls-com-1"><span class="post-toc-text">（4）启动ca.court.tls.com</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（5）登记注册-3"><span class="post-toc-text">（5）登记注册</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#6、组织证书"><span class="post-toc-text">6、组织证书</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）登记配置文件编写"><span class="post-toc-text">（1）登记配置文件编写</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）登记"><span class="post-toc-text">（2）登记</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）组织证书"><span class="post-toc-text">（3）组织证书</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（六）准备相关文件"><span class="post-toc-text">（六）准备相关文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1、configtx-yaml"><span class="post-toc-text">1、configtx.yaml</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2、创世区块、通道文件"><span class="post-toc-text">2、创世区块、通道文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3、docker-compose配置文件"><span class="post-toc-text">3、docker-compose配置文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4、复制文件"><span class="post-toc-text">4、复制文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#（七）依次启动各节点"><span class="post-toc-text">（七）依次启动各节点</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1、orderer"><span class="post-toc-text">1、orderer</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2、peer0-court-com"><span class="post-toc-text">2、peer0.court.com</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3、peer1-court-com"><span class="post-toc-text">3、peer1.court.com</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#4、peer0-user-com"><span class="post-toc-text">4、peer0.user.com</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#5、peer1-user-com"><span class="post-toc-text">5、peer1.user.com</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#常用命令"><span class="post-toc-text">常用命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#删除用户"><span class="post-toc-text">删除用户</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#证书链"><span class="post-toc-text">证书链</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有容器"><span class="post-toc-text">清空所有容器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有镜像"><span class="post-toc-text">清空所有镜像</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理挂载卷"><span class="post-toc-text">清理挂载卷</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理项目文件"><span class="post-toc-text">清理项目文件</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-2020/contract-deposit"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">合同存证</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-10-05 20:14:10" datetime="2020-10-05T12:14:10.000Z"  itemprop="datePublished">2020-10-05</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>下面的做法在一个只求跑通区块链的项目中是费时费力且不讨好。</p>
<p>1、orderer是一个单独的组织，有一套独立的证书（MSP），任何网络必不可少。对其在实际的组之间进行化分是没有意义的。该组织只提供排序，分发等服务。</p>
<p>2、需要配置的配置文件如果仔细追究的话，需要配置的东西是非常多的。</p>
<p>3、各组织之间不需要有共同的根ca。节点启动时从创世区块或者通道配置中读取被信任的根证书组。</p>
<p>4、cryptogen模块自动生成证书架构与下面的网络去除root.ca的架构相同。</p>
<p>去费时费力构建一个和cryptogen功能相同的证书分发架构，没有必要。</p>
<p>使用cryptogen模块生成证书后，需要动态的部分使用fabric-ca来动态分发即可。</p>
<p>见：</p>
</blockquote>
<h1 id="（一）业务流程"><a href="#（一）业务流程" class="headerlink" title="（一）业务流程"></a>（一）业务流程</h1><h1 id="（二）组织、域名、ip匹配表"><a href="#（二）组织、域名、ip匹配表" class="headerlink" title="（二）组织、域名、ip匹配表"></a>（二）组织、域名、ip匹配表</h1><table>
<thead>
<tr>
<th align="left">域名</th>
<th>ip地址</th>
<th align="center">组织</th>
<th align="center">内网ip</th>
</tr>
</thead>
<tbody><tr>
<td align="left">root.com</td>
<td>192.168.30.2:7054</td>
<td align="center"></td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">ca.court.com</td>
<td>192.168.30.2:7055</td>
<td align="center">court</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">tls.court.com</td>
<td>192.168.30.2:7056</td>
<td align="center">court</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">ca.user.com</td>
<td>192.168.30.2:7057</td>
<td align="center">user</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">tls.user.com</td>
<td>192.168.30.2:7058</td>
<td align="center">user</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">ca.order.com</td>
<td>192.168.30.2:7059</td>
<td align="center">order</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">tls.order.com</td>
<td>192.168.30.2:70510</td>
<td align="center">order</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer0.order.com</td>
<td>192.168.30.3</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer1.order.com</td>
<td>192.168.30.4</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer2.order.com</td>
<td>192.168.30.5</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.court.com</td>
<td>192.168.30.6</td>
<td align="center">court</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.court.com</td>
<td>192.168.30.7</td>
<td align="center">court</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.user.com</td>
<td>192.168.30.8</td>
<td align="center">user</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.user.com</td>
<td>192.168.30.9</td>
<td align="center">user</td>
<td align="center">123</td>
</tr>
</tbody></table>
<h1 id="（三）网络"><a href="#（三）网络" class="headerlink" title="（三）网络"></a>（三）网络</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/contract-deposit/map.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="（四）虚拟机"><a href="#（四）虚拟机" class="headerlink" title="（四）虚拟机"></a>（四）虚拟机</h1><h2 id="1、防火墙"><a href="#1、防火墙" class="headerlink" title="1、防火墙"></a>1、防火墙</h2><h2 id="2、hosts文件"><a href="#2、hosts文件" class="headerlink" title="2、hosts文件"></a>2、hosts文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">192.168.30.2 ca.platform.com</span><br><span class="line">192.168.30.2 ca.court.com</span><br><span class="line">192.168.30.2 tls.court.com</span><br><span class="line">192.168.30.2 ca.user.com</span><br><span class="line">192.168.30.2 tls.user.com</span><br><span class="line">192.168.30.3 orderer0.order.com</span><br><span class="line">192.168.30.4 orderer1.order.com</span><br><span class="line">192.168.30.5 orderer2.order.com</span><br><span class="line">192.168.30.6 peer0.court.com</span><br><span class="line">192.168.30.7 peer1.court.com</span><br><span class="line">192.168.30.8 peer0.user.com</span><br><span class="line">192.168.30.9 peer1.user.com</span><br></pre></td></tr></table></figure>

<h2 id="3、镜像1-4-3"><a href="#3、镜像1-4-3" class="headerlink" title="3、镜像1.4.3"></a>3、镜像1.4.3</h2><h2 id="4、bin文件1-4-3"><a href="#4、bin文件1-4-3" class="headerlink" title="4、bin文件1.4.3"></a>4、bin文件1.4.3</h2><h1 id="（五）CA"><a href="#（五）CA" class="headerlink" title="（五）CA"></a>（五）CA</h1><h2 id="1、根证书"><a href="#1、根证书" class="headerlink" title="1、根证书"></a>1、根证书</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成私钥</span></span><br><span class="line">openssl ecparam -genkey -name secp256r1 |openssl ec -out ca.key.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> 转换为pkcs8格式</span></span><br><span class="line">openssl pkcs8 -topk8 -inform PEM -in ca.key.pem -outform PEM -nocrypt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制输出到原私钥文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成自认证证书</span></span><br><span class="line">openssl req -config openssl.cnf -key ca.key.pem -new -x509 -days 7300 -sha256 -extensions v3_ca -out ca.cert.pem</span><br></pre></td></tr></table></figure>

<p>命令行输出如下：</p>
<p>最终生成ca.key.pem和ca.cert.pem。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\cups&gt;openssl ecparam -genkey -name secp256r1 |openssl ec -out ca.key.pem</span><br><span class="line">using curve name prime256v1 instead of secp256r1</span><br><span class="line">read EC key</span><br><span class="line">writing EC key</span><br><span class="line"></span><br><span class="line">C:\Users\cups&gt;openssl pkcs8 -topk8 -inform PEM -in ca.key.pem -outform PEM -nocrypt</span><br><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgJzm3ch3diRqrrH1V</span><br><span class="line">lyYGOuXTbiC3TSDmfZwj3k4EJwWhRANCAAR4GgdmlH+GWMZcnVQAvUTmbIBWIAz8</span><br><span class="line">dC0zuAhhWzfgmLq3UadZotEbvEv3S0vue9bF/+qBBxttSqnKv7Xsd9yG</span><br><span class="line">-----END PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">C:\Users\cups&gt;openssl req -config openssl.cnf -key ca.key.pem -new -x509 -days 7300 -sha256 -extensions v3_ca -out ca.cert.pem</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '.', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [CN]:CN</span><br><span class="line">State or Province Name [China]:HeNan</span><br><span class="line">Locality Name []:ZhengZhou</span><br><span class="line">Organization Name [Hyperledger]:ZUT</span><br><span class="line">Organizational Unit Name [Fabric]:QY</span><br><span class="line">Common Name [fabric-ca-server]:</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">C:\Users\cups&gt;</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/contract-deposit/pem.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h2 id="2、ca-root-com-192-168-30-2"><a href="#2、ca-root-com-192-168-30-2" class="headerlink" title="2、ca.root.com(192.168.30.2)"></a>2、ca.root.com(192.168.30.2)</h2><h3 id="（1）ca-root-com-config-yaml"><a href="#（1）ca-root-com-config-yaml" class="headerlink" title="（1）ca.root.com-config.yaml"></a>（1）ca.root.com-config.yaml</h3><blockquote>
<p>路径：contract-deposit/ca.root.com/ca.root.com-config.yaml。</p>
<p>功能：配置ca。</p>
<p>配置文件各部分含义见：<a href="https://blog.csdn.net/greedystar/article/details/80344984" target="_blank" rel="noopener">https://blog.csdn.net/greedystar/article/details/80344984</a></p>
<p>文档过长，下面列出修改的部分。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、指定证书位置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、指定affiliations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、指定csr</span></span><br></pre></td></tr></table></figure>

<h3 id="（2）ca-root-com-yaml"><a href="#（2）ca-root-com-yaml" class="headerlink" title="（2）ca.root.com.yaml"></a>（2）ca.root.com.yaml</h3><blockquote>
<p>Fabric环境变量请参考：<a href="http://cw.hubwiz.com/card/c/fabric-env-manual/" target="_blank" rel="noopener">http://cw.hubwiz.com/card/c/fabric-env-manual/</a></p>
<p>可以使用fabric-ca-server命令启动ca，后果是像win7上的某些软件试的，无法启动第二个。</p>
<p>我可不想单独拿出7台主机来做ca的PKI。</p>
<p>使用docker是最好的选择；一台主机个镜像；镜像之间端口、域名、配置文件不同；都提供ca服务。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line">services:</span><br><span class="line">  ca.root.com:</span><br><span class="line">    container_name: ca.root.com</span><br><span class="line">    hostname: ca.platform.com</span><br><span class="line">    image: hyperledger/fabric-ca:1.4.3</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca.platform.com</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_ENABLED=false</span><br><span class="line">    ports:</span><br><span class="line">      - "7054:7054"</span><br><span class="line">    command: sh -c 'fabric-ca-server start -c /etc/hyperledger/fabric-ca-server/ca.root.com-config.yaml --cfg.affiliations.allowremove --cfg.identities.allowremove -d'</span><br><span class="line">    volumes:</span><br><span class="line">      - ./ca-server/platform/ca.platform.com/:/etc/hyperledger/fabric-ca-server</span><br></pre></td></tr></table></figure>

<h3 id="（3）启动ca-root-com"><a href="#（3）启动ca-root-com" class="headerlink" title="（3）启动ca.root.com"></a>（3）启动ca.root.com</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker-compose -f ca.root.com.yaml up -d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看日志</span></span><br><span class="line">docker logs ca.root.com</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="（4）登记注册"><a href="#（4）登记注册" class="headerlink" title="（4）登记注册"></a>（4）登记注册</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引导账户</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/platform/platform-ca-admin</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7054 \</span><br><span class="line">-c ./ca-server/platform/platform-ca-admin/fabric-ca-client-config.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 ca.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/platform/platform-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name ca.court.com \</span><br><span class="line">--id.secret ca.court.com.pw \</span><br><span class="line">--id.affiliation court \</span><br><span class="line">--id.attrs 'hf.IntermediateCA=true:ecert'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 ca.court.tls.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/platform/platform-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name tls.court.com \</span><br><span class="line">--id.secret tls.court.com.pw \</span><br><span class="line">--id.affiliation court \</span><br><span class="line">--id.attrs 'hf.IntermediateCA=true:ecert'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 ca.user.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/platform/platform-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name ca.user.com \</span><br><span class="line">--id.secret ca.user.com.pw  \</span><br><span class="line">--id.affiliation user \</span><br><span class="line">--id.attrs 'hf.IntermediateCA=true:ecert'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 ca.user.tls.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/platform/platform-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name tls.user.com \</span><br><span class="line">--id.secret tls.user.com.pw  \</span><br><span class="line">--id.affiliation user \</span><br><span class="line">--id.attrs 'hf.IntermediateCA=true:ecert'</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（5）fabric-ca-client-config-yaml"><a href="#（5）fabric-ca-client-config-yaml" class="headerlink" title="（5）fabric-ca-client-config.yaml*"></a>（5）fabric-ca-client-config.yaml*</h3><blockquote>
<p>如果不想被发证书上的信息是Fabric默认的，最好配置客户端的配置文件。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">url: http://192.168.30.2:7054</span><br><span class="line">mspdir: AdminMSP</span><br><span class="line">csr:</span><br><span class="line">  cn: admin@ca.root.com</span><br><span class="line">  serialnumber:</span><br><span class="line">  names:</span><br><span class="line">    - C: CN</span><br><span class="line">      ST: HeNan</span><br><span class="line">      L: ZhengZhou</span><br><span class="line">      O:</span><br><span class="line">      OU:</span><br><span class="line">  hosts:</span><br><span class="line">    - localhost</span><br></pre></td></tr></table></figure>

<h2 id="3、ca-court-com-192-168-30-3"><a href="#3、ca-court-com-192-168-30-3" class="headerlink" title="3、ca.court.com(192.168.30.3)"></a>3、ca.court.com(192.168.30.3)</h2><h3 id="（1）ca-court-com-config-yaml"><a href="#（1）ca-court-com-config-yaml" class="headerlink" title="（1）ca.court.com-config.yaml"></a>（1）ca.court.com-config.yaml</h3><blockquote>
<p>路径：contract-deposit/ca.court.com/ca.court.com-config.yaml。</p>
<p>功能：配置ca。</p>
<p>配置文件各部分含义见：<a href="https://blog.csdn.net/greedystar/article/details/80344984" target="_blank" rel="noopener">https://blog.csdn.net/greedystar/article/details/80344984</a></p>
<p>文档过长，下面列出修改的部分。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 版本</span></span><br><span class="line">version: 1.4.3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 组织</span></span><br><span class="line">affiliations:</span><br><span class="line">   court:</span><br><span class="line">      - department1</span><br><span class="line">      - department2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 签名请求</span></span><br><span class="line">csr:</span><br><span class="line">   cn:</span><br><span class="line">   keyrequest:</span><br><span class="line">     algo: ecdsa</span><br><span class="line">     size: 256</span><br><span class="line">   names:</span><br><span class="line">      - C: CN</span><br><span class="line">        ST: HeNan</span><br><span class="line">        L: ZhengZhou</span><br><span class="line">        O: Court</span><br><span class="line">        OU: CA</span><br><span class="line">   hosts:</span><br><span class="line">     - ca.court.com</span><br><span class="line">     - localhost</span><br><span class="line">   ca:</span><br><span class="line">      expiry: 131400h</span><br><span class="line">      pathlength: 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 中间ca</span></span><br><span class="line">intermediate:</span><br><span class="line">  parentserver:</span><br><span class="line">    url: ca.root.com:7054</span><br><span class="line">    caname: ca.root.com</span><br></pre></td></tr></table></figure>

<h3 id="（2）初始化"><a href="#（2）初始化" class="headerlink" title="（2）初始化"></a>（2）初始化</h3><blockquote>
<p>使用fabric-ca-server按照ca.court.com-config.yaml对当前ca进行初始化；</p>
<p>指定引导用户为admin:adminpw；</p>
<p>指定ca证书来自<a href="http://ca.court.com:ca.court.com.pw@192.168.30.2:7054。" target="_blank" rel="noopener">http://ca.court.com:ca.court.com.pw@192.168.30.2:7054。</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登记 + 初始化</span></span><br><span class="line">fabric-ca-server init \</span><br><span class="line">-b admin:adminpw \</span><br><span class="line">-u http://ca.court.com:ca.court.com.pw@192.168.30.2:7054 \</span><br><span class="line">-c ./ca.court.com-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（3）ca-court-com-yaml"><a href="#（3）ca-court-com-yaml" class="headerlink" title="（3）ca.court.com.yaml"></a>（3）ca.court.com.yaml</h3><blockquote>
<p>Fabric环境变量请参考：<a href="http://cw.hubwiz.com/card/c/fabric-env-manual/" target="_blank" rel="noopener">http://cw.hubwiz.com/card/c/fabric-env-manual/</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  ca.court.com:</span><br><span class="line">    container_name: ca.court.com</span><br><span class="line">    hostname: ca.court.com</span><br><span class="line">    image: hyperledger/fabric-ca:1.4.3</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca.court.com</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_ENABLED=false</span><br><span class="line">    ports:</span><br><span class="line">      - "7054:7054"</span><br><span class="line">    command: sh -c 'fabric-ca-server start -c /etc/hyperledger/fabric-ca-server/ca.court.com-config.yaml --cfg.affiliations.allowremove --cfg.identities.allowremove -d'</span><br><span class="line">    volumes:</span><br><span class="line">      - ./ca-server/court/ca.court.com/:/etc/hyperledger/fabric-ca-server</span><br></pre></td></tr></table></figure>

<h3 id="（4）启动ca-court-com"><a href="#（4）启动ca-court-com" class="headerlink" title="（4）启动ca.court.com"></a>（4）启动ca.court.com</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker-compose -f ca.court.com.yaml up -d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看日志</span></span><br><span class="line">docker logs ca.root.com</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="（5）登记注册"><a href="#（5）登记注册" class="headerlink" title="（5）登记注册"></a>（5）登记注册</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引导账户</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7055 \</span><br><span class="line">-c ./ca-server/court/msp/court-ca-admin/fabric-ca-client-config.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册court-admin</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name court-admin \</span><br><span class="line">--id.secret court-admin.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation court</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order0.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order0.court.com \</span><br><span class="line">--id.secret order0.court.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation court.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order1.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order1.court.com \</span><br><span class="line">--id.secret order1.court.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation court.department1 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册peer0.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name peer0.court.com \</span><br><span class="line">--id.secret peer0.court.com.pw \</span><br><span class="line">--id.type peer \</span><br><span class="line">--id.affiliation court.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册court-user</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/msp/court-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name court-user \</span><br><span class="line">--id.secret court-user.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation court.department1</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、tls-court-com-192-168-30-3"><a href="#4、tls-court-com-192-168-30-3" class="headerlink" title="4、tls.court.com(192.168.30.3)"></a>4、tls.court.com(192.168.30.3)</h2><h3 id="（1）ca-court-tls-com-config-yaml"><a href="#（1）ca-court-tls-com-config-yaml" class="headerlink" title="（1）ca.court.tls.com-config.yaml"></a>（1）ca.court.tls.com-config.yaml</h3><h3 id="（2）初始化-1"><a href="#（2）初始化-1" class="headerlink" title="（2）初始化"></a>（2）初始化</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-server init \</span><br><span class="line">-b admin:adminpw \</span><br><span class="line">-u http://tls.court.com:tls.court.com.pw@192.168.30.2:7054 \</span><br><span class="line">-c ./tls.court.com-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="（3）ca-court-tls-com-yaml"><a href="#（3）ca-court-tls-com-yaml" class="headerlink" title="（3）ca.court.tls.com.yaml"></a>（3）ca.court.tls.com.yaml</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（4）启动ca-court-tls-com"><a href="#（4）启动ca-court-tls-com" class="headerlink" title="（4）启动ca.court.tls.com"></a>（4）启动ca.court.tls.com</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f tls.court.com.yaml up -d</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（5）登记注册-1"><a href="#（5）登记注册-1" class="headerlink" title="（5）登记注册"></a>（5）登记注册</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引导账户</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7056 \</span><br><span class="line">-c ./ca-server/court/tls/court-tls-admin/fabric-ca-client-config.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册court-admin</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name court-admin \</span><br><span class="line">--id.secret court-admin.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation court</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order0.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order0.court.com \</span><br><span class="line">--id.secret order0.court.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation court.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order1.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order1.court.com \</span><br><span class="line">--id.secret order1.court.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation court.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册peer0.court.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name peer0.court.com \</span><br><span class="line">--id.secret peer0.court.com.pw \</span><br><span class="line">--id.type peer \</span><br><span class="line">--id.affiliation court.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册court-user</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/court/tls/court-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name court-user \</span><br><span class="line">--id.secret court-user.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation court.department1</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5、ca-user-com-192-168-30-4"><a href="#5、ca-user-com-192-168-30-4" class="headerlink" title="5、ca.user.com(192.168.30.4)"></a>5、ca.user.com(192.168.30.4)</h2><h3 id="（1）ca-user-com-config-yaml"><a href="#（1）ca-user-com-config-yaml" class="headerlink" title="（1）ca.user.com-config.yaml"></a>（1）ca.user.com-config.yaml</h3><blockquote>
<p>路径：contract-deposit/ca.user.com/ca.user.com-config.yaml。</p>
<p>功能：配置ca.user.com。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（2）初始化-2"><a href="#（2）初始化-2" class="headerlink" title="（2）初始化"></a>（2）初始化</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登记 + 初始化</span></span><br><span class="line">fabric-ca-server init \</span><br><span class="line">-b admin:adminpw \</span><br><span class="line">-u http://ca.user.com:ca.user.com.pw@192.168.30.2:7054 \</span><br><span class="line">-c ./ca.user.com-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（3）ca-user-com-yaml"><a href="#（3）ca-user-com-yaml" class="headerlink" title="（3）ca.user.com.yaml"></a>（3）ca.user.com.yaml</h3><blockquote>
<p>Fabric环境变量请参考：<a href="http://cw.hubwiz.com/card/c/fabric-env-manual/" target="_blank" rel="noopener">http://cw.hubwiz.com/card/c/fabric-env-manual/</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（4）启动ca-user-com"><a href="#（4）启动ca-user-com" class="headerlink" title="（4）启动ca.user.com"></a>（4）启动ca.user.com</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker-compose按ca.user.com.yaml启动容器</span></span><br><span class="line">docker-compose -f ca.user.com.yaml up -d</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询正在工作的容器</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看日志</span></span><br><span class="line">docker logs ca.user.com</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（5）登记注册-2"><a href="#（5）登记注册-2" class="headerlink" title="（5）登记注册"></a>（5）登记注册</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引导账户</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/msp/user-ca-admin</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7057 \</span><br><span class="line">-c ./ca-server/user/msp/user-ca-admin/fabric-ca-client-config.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 user-admin</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/msp/user-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name user-admin \</span><br><span class="line">--id.secret user-admin.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation user</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order.user.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/msp/user-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order.user.com \</span><br><span class="line">--id.secret order.user.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation user.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 peer0.user.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/msp/user-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name peer0.user.com \</span><br><span class="line">--id.secret peer0.user.com.pw \</span><br><span class="line">--id.type peer \</span><br><span class="line">--id.affiliation user.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 user-user</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/msp/user-ca-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name user-user \</span><br><span class="line">--id.secret user-user.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation user.department1</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="6、tls-user-com-192-168-30-4"><a href="#6、tls-user-com-192-168-30-4" class="headerlink" title="6、tls.user.com(192.168.30.4)"></a>6、tls.user.com(192.168.30.4)</h2><h3 id="（1）ca-user-tls-com-config-yaml"><a href="#（1）ca-user-tls-com-config-yaml" class="headerlink" title="（1）ca.user.tls.com-config.yaml"></a>（1）ca.user.tls.com-config.yaml</h3><h3 id="（2）初始化-3"><a href="#（2）初始化-3" class="headerlink" title="（2）初始化"></a>（2）初始化</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-server init \</span><br><span class="line">-b admin:adminpw \</span><br><span class="line">-u http://tls.user.com:tls.user.com.pw@192.168.30.2:7054 \</span><br><span class="line">-c ./tls.user.com-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（3）ca-court-tls-com-yaml-1"><a href="#（3）ca-court-tls-com-yaml-1" class="headerlink" title="（3）ca.court.tls.com.yaml"></a>（3）ca.court.tls.com.yaml</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（4）启动ca-court-tls-com-1"><a href="#（4）启动ca-court-tls-com-1" class="headerlink" title="（4）启动ca.court.tls.com"></a>（4）启动ca.court.tls.com</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f tls.user.com.yaml up -d</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（5）登记注册-3"><a href="#（5）登记注册-3" class="headerlink" title="（5）登记注册"></a>（5）登记注册</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引导账户</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/tls/user-tls-admin</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7058 \</span><br><span class="line">-c ./ca-server/user/tls/user-tls-admin/fabric-ca-client-config.yaml</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 user-admin</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/tls/user-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name user-admin \</span><br><span class="line">--id.secret user-admin.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation user</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 order.user.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/tls/user-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name order.user.com \</span><br><span class="line">--id.secret order.user.com.pw \</span><br><span class="line">--id.type orderer \</span><br><span class="line">--id.affiliation user.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 peer0.user.com</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/tls/user-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name peer0.user.com \</span><br><span class="line">--id.secret peer0.user.com.pw \</span><br><span class="line">--id.type peer \</span><br><span class="line">--id.affiliation user.department1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注册 user-user</span></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./ca-server/user/tls/user-tls-admin</span><br><span class="line">fabric-ca-client register \</span><br><span class="line">--id.name user-user \</span><br><span class="line">--id.secret user-user.pw \</span><br><span class="line">--id.type client \</span><br><span class="line">--id.affiliation user.department1</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="6、组织证书"><a href="#6、组织证书" class="headerlink" title="6、组织证书"></a>6、组织证书</h2><blockquote>
<p>有两种方法：</p>
<p>1、所有证书，在需要使用这些证书的节点上进行登记；管理员证书组织在一起初始化网络（创世区块、通道文件、锚节点文件）。</p>
<p>2、所有证书在一台机器上进行登记；管理员证书组织在一起初始化网络（创世区块、通道文件、锚节点文件）。</p>
<p>毫无疑问把所有证书都在一个地方进行登记是最省事的办法。</p>
<p>优点如下：</p>
<p>1、下边的网络搭建过程还不知道会出现什么问题；这样可以在三个ca不动的前提下随便折腾网络搭建部分。</p>
<p>2、简化文件组织；或者说这样文件组织更容易操作。</p>
<p>下面是上面5个ca的配置文件，搞的太晕了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── 192.168.30.2</span><br><span class="line">│   ├── ca.root.com</span><br><span class="line">│   │   ├── ca.root.com-config.yaml</span><br><span class="line">│   │   └── msp</span><br><span class="line">│   │       ├── ca.cert.pem</span><br><span class="line">│   │       └── ca.key.pem</span><br><span class="line">│   ├── ca.root.com.yaml</span><br><span class="line">│   ├── fabric-ca-client-config.yaml</span><br><span class="line">│   └── root-ca-admin</span><br><span class="line">│       └── fabric-ca-client-config.yaml</span><br><span class="line">├── 192.168.30.3</span><br><span class="line">│   ├── ca.court.com</span><br><span class="line">│   │   └── ca.court.com-config.yaml</span><br><span class="line">│   ├── ca.court.com.yaml</span><br><span class="line">│   ├── ca.court.tls.com</span><br><span class="line">│   │   ├── ca.court.com.tls-config.yaml</span><br><span class="line">│   │   └── ca.court.tls.com-config.yaml</span><br><span class="line">│   ├── ca.court.tls.com.yaml</span><br><span class="line">│   ├── court-ca-admin</span><br><span class="line">│   │   └── fabric-ca-client-config.yaml</span><br><span class="line">│   └── court-ca-tls-admin</span><br><span class="line">│       └── fabric-ca-client-config.yaml</span><br><span class="line">└── 192.168.30.4</span><br><span class="line">    ├── ca.user.com</span><br><span class="line">    │   └── ca.user.com-config.yaml</span><br><span class="line">    ├── ca.user.com.yaml</span><br><span class="line">    ├── ca.user.tls.com</span><br><span class="line">    │   └── ca.user.tls.com-config.yaml</span><br><span class="line">    ├── ca.user.tls.com.yaml</span><br><span class="line">    ├── user-ca-admin</span><br><span class="line">    │   └── fabric-ca-client-config.yaml</span><br><span class="line">    └── user-ca-tls-admin</span><br><span class="line">        └── fabric-ca-client-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="（1）登记配置文件编写"><a href="#（1）登记配置文件编写" class="headerlink" title="（1）登记配置文件编写"></a>（1）登记配置文件编写</h3><blockquote>
<p>主要是证书签名请求和证书存放路径部分。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">url: http://192.168.30.3:7054</span><br><span class="line">mspdir: /root/contract-deposit/crypto/crypto/court/court-admin/</span><br><span class="line">tls:</span><br><span class="line">  certfiles:</span><br><span class="line">  client:</span><br><span class="line">    certfile:</span><br><span class="line">    keyfile:</span><br><span class="line">csr:</span><br><span class="line">  cn: </span><br><span class="line">  serialnumber:</span><br><span class="line">  names:</span><br><span class="line">    - C: CN</span><br><span class="line">      ST: HeNan</span><br><span class="line">      L: ZhengZhou</span><br><span class="line">      O: Court</span><br><span class="line">      OU: Admin</span><br><span class="line">  hosts:</span><br><span class="line">    - home</span><br><span class="line">id:</span><br><span class="line">  name:</span><br><span class="line">  type:</span><br><span class="line">  affiliation:</span><br><span class="line">  maxenrollments: 0</span><br><span class="line">  attributes:</span><br><span class="line">enrollment:</span><br><span class="line">  profile:</span><br><span class="line">  label:</span><br><span class="line">caname:</span><br><span class="line">bccsp:</span><br><span class="line">    default: SW</span><br><span class="line">    sw:</span><br><span class="line">        hash: SHA2</span><br><span class="line">        security: 256</span><br><span class="line">        filekeystore:</span><br><span class="line">            keystore: msp/keystore</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="（2）登记"><a href="#（2）登记" class="headerlink" title="（2）登记"></a>（2）登记</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################court msp(7055)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://court-admin:court-admin.pw@192.168.30.2:7055 \</span><br><span class="line">-c court-admin-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://order0.court.com:order0.court.com.pw@192.168.30.2:7055 \</span><br><span class="line">-c order0.court.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://order1.court.com:order1.court.com.pw@192.168.30.2:7055 \</span><br><span class="line">-c order1.court.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://peer0.court.com:peer0.court.com.pw@192.168.30.2:7055 \</span><br><span class="line">-c peer0.court.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://court-user:court-user.pw@192.168.30.2:7055 \</span><br><span class="line">-c court-user-config.yaml </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################court tls(7056)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://court-admin:court-admin.pw@192.168.30.2:7056 \</span><br><span class="line">-c court-admin-tls-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://order0.court.com:order0.court.com.pw@192.168.30.2:7056 \</span><br><span class="line">-c order0.court.tls.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://order1.court.com:order1.court.com.pw@192.168.30.2:7056 \</span><br><span class="line">-c order1.court.tls.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://peer0.court.com:peer0.court.com.pw@192.168.30.2:7056 \</span><br><span class="line">-c peer0.court.tls.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://court-user:court-user.pw@192.168.30.2:7056 \</span><br><span class="line">-c court-user-tls-config.yaml </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################user msp(7057)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://user-admin:user-admin.pw@192.168.30.2:7057 \</span><br><span class="line">-c user-admin-config.yaml</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://order.user.com:order.user.com.pw@192.168.30.2:7057 \</span><br><span class="line">-c order.user.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://peer0.user.com:peer0.user.com.pw@192.168.30.2:7057 \</span><br><span class="line">-c peer0.user.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://user-user:user-user.pw@192.168.30.2:7057 \</span><br><span class="line">-c user-user-config.yaml </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################user msp(7058)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################################</span></span></span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://user-admin:user-admin.pw@192.168.30.2:7058 \</span><br><span class="line">-c user-admin-tls-config.yaml</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://order.user.com:order.user.com.pw@192.168.30.2:7058 \</span><br><span class="line">-c order.user.tls.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://peer0.user.com:peer0.user.com.pw@192.168.30.2:7058 \</span><br><span class="line">-c peer0.user.tls.com-config.yaml </span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-d --enrollment.profile tls \</span><br><span class="line">-u http://user-user:user-user.pw@192.168.30.2:7058 \</span><br><span class="line">-c user-user-tls-config.yaml </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="（3）组织证书"><a href="#（3）组织证书" class="headerlink" title="（3）组织证书"></a>（3）组织证书</h3><blockquote>
<p>管理员：court-admin和user-admin。</p>
<p>下面是一个完整的MSP，TLS我们暂且不用，需要组织admincerts。</p>
<p>即为每个证书目录创建admincerts并放入管理员的证书。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── admincerts</span><br><span class="line">│?? └── User1@org1.example.com-cert.pem</span><br><span class="line">├── cacerts</span><br><span class="line">│?? └── ca.org1.example.com-cert.pem</span><br><span class="line">├── keystore</span><br><span class="line">│?? └── 7365294a1793d88ab82ce6d825bb5fd8e828deed402e25e37f0e2999e9d68278_sk</span><br><span class="line">├── signcerts</span><br><span class="line">│?? └── User1@org1.example.com-cert.pem</span><br><span class="line">└── tlscacerts</span><br><span class="line">    └── tlsca.org1.example.com-cert.pem</span><br></pre></td></tr></table></figure>

<p>整理后：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168305 order0.court.com]# tree</span><br><span class="line">.</span><br><span class="line">├── admincerts							# 管理员证书</span><br><span class="line">│   └── cert.pem</span><br><span class="line">├── cacerts								# ca证书</span><br><span class="line">│   └── 192-168-30-3-7054.pem</span><br><span class="line">├── intermediatecerts					# 中间ca证书</span><br><span class="line">│   └── 192-168-30-3-7054.pem</span><br><span class="line">├── IssuerPublicKey</span><br><span class="line">├── IssuerRevocationPublicKey</span><br><span class="line">├── keystore							# 私钥</span><br><span class="line">│   └── 5511b3b11c0c9e9dba80bd94b84f9dfd634d798c0a3116a4e6906ec9b6a4fe66_sk</span><br><span class="line">├── signcerts							# 证书</span><br><span class="line">│   └── cert.pem</span><br><span class="line">└── user</span><br><span class="line"></span><br><span class="line">6 directories, 7 files</span><br><span class="line">[root@vm192168305 order0.court.com]# </span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="（六）准备相关文件"><a href="#（六）准备相关文件" class="headerlink" title="（六）准备相关文件"></a>（六）准备相关文件</h1><h2 id="1、configtx-yaml"><a href="#1、configtx-yaml" class="headerlink" title="1、configtx.yaml"></a>1、configtx.yaml</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2、创世区块、通道文件"><a href="#2、创世区块、通道文件" class="headerlink" title="2、创世区块、通道文件"></a>2、创世区块、通道文件</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建存放文件</span></span><br><span class="line">mkdir channel-artifacts</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成创世区块</span></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsOrdererGenesis \</span><br><span class="line">-outputBlock ./channel-artifacts/genesis.block</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成通道文件</span></span><br><span class="line">configtxgen \</span><br><span class="line">-profile TwoOrgsChannel \</span><br><span class="line">-outputCreateChannelTx ./channel-artifacts/mychannel.tx \</span><br><span class="line">-channelID mychannel</span><br></pre></td></tr></table></figure>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptogen generate --config=./crypto-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3、docker-compose配置文件"><a href="#3、docker-compose配置文件" class="headerlink" title="3、docker-compose配置文件"></a>3、docker-compose配置文件</h2><blockquote>
<p>a</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、复制文件"><a href="#4、复制文件" class="headerlink" title="4、复制文件"></a>4、复制文件</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">scp -r contract-deposit/ root@192.168.30.6:/root/</span><br><span class="line">scp -r contract-deposit/ root@192.168.30.7:/root/</span><br><span class="line">scp -r contract-deposit/ root@192.168.30.8:/root/</span><br><span class="line">scp -r contract-deposit/ root@192.168.30.9:/root/</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="（七）依次启动各节点"><a href="#（七）依次启动各节点" class="headerlink" title="（七）依次启动各节点"></a>（七）依次启动各节点</h1><h2 id="1、orderer"><a href="#1、orderer" class="headerlink" title="1、orderer"></a>1、orderer</h2><blockquote>
<p>order0.court.com.yaml=============&gt;192.168.30.5</p>
<p>order1.court.com.yaml=============&gt;192.168.30.6</p>
<p>order.user.com.yaml===============&gt;192.168.30.7</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f order0.court.com.yaml up -d</span><br><span class="line">docker-compose -f order1.court.com.yaml up -d</span><br><span class="line">docker-compose -f order.user.com.yaml up -d</span><br></pre></td></tr></table></figure>


</blockquote>
<h2 id="2、peer0-court-com"><a href="#2、peer0-court-com" class="headerlink" title="2、peer0.court.com"></a>2、peer0.court.com</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############启动容器</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker-compose -f peer0.court.com.yaml up -d</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############创建并加入通道</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建通道</span></span><br><span class="line">-o order0.court.com:7050 \</span><br><span class="line">-c mychannel \</span><br><span class="line">-f ./channel-artifacts/mychannel.tx \</span><br><span class="line">–tls \</span><br><span class="line">–cafile $COURT_CA \</span><br><span class="line">-o order1.court.com:7050 \</span><br><span class="line">-c mychannel \</span><br><span class="line">-f ./channel-artifacts/mychannel.tx \</span><br><span class="line">–tls \</span><br><span class="line">–cafile $COURT_CA \</span><br><span class="line"></span><br><span class="line">COURT_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/court.com/peers/order0.court.com/msp/tlscacerts/tlsca.court.com-cert.pem</span><br><span class="line">USER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/user.com/peers/order.user.com/msp/tlscacerts/tlsca.user.com-cert.pem</span><br><span class="line">peer channel create \</span><br><span class="line">-o order.user.com:7050 \</span><br><span class="line">-c mychannel \</span><br><span class="line">-f ./channel-artifacts/mychannel.tx \</span><br><span class="line">–tls \</span><br><span class="line">–cafile $USER_CA</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入通道</span></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############实例化智能合约</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装智能合约</span></span><br><span class="line">peer chaincode install -n mycc -p github.com/hyperledger/fabric/chaincode/chaincode_example02 -v 1.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 实例化智能合约</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer chaincode instantiate -o orderer0.example.com:7050 –tls –cafile $ORDERER_CA -C mychannel -n mycc -v 1.0 -c ‘&#123;“Args”:[“init”,”a”,”200”,”b”,”400”]&#125;’ -P “OR (‘Org1MSP.peer’,’Org2MSP.peer’)”</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询a</span></span><br><span class="line">peer chaincode query -C mychannel -n mycc -c ‘&#123;“Args”:[“query”,”a”]&#125;’</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出容器</span></span><br><span class="line">ctrl+D</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############复制通道文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从镜像复制到本地</span></span><br><span class="line">docker cp cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block ./</span><br><span class="line"><span class="meta">#</span><span class="bash"> 传输给另外3台peer</span></span><br><span class="line">scp ./mychannel.block root@192.168.30.7:/root/kafka</span><br><span class="line">scp ./mychannel.block root@192.168.30.8:/root/kafka</span><br><span class="line">scp ./mychannel.block root@192.168.30.9:/root/kafka</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############查看chaincode容器</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>


</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3、peer1-court-com"><a href="#3、peer1-court-com" class="headerlink" title="3、peer1.court.com"></a>3、peer1.court.com</h2><blockquote>
<p>a</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、peer0-user-com"><a href="#4、peer0-user-com" class="headerlink" title="4、peer0.user.com"></a>4、peer0.user.com</h2><blockquote>
<p>a</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5、peer1-user-com"><a href="#5、peer1-user-com" class="headerlink" title="5、peer1.user.com"></a>5、peer1.user.com</h2><blockquote>
<p>a</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><blockquote>
<h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client identity remove ca.court.com</span><br><span class="line"></span><br><span class="line">export FABRIC_CA_CLIENT_HOME=./tls-msp</span><br><span class="line">fabric-ca-client enroll \</span><br><span class="line">-u http://admin:adminpw@192.168.30.2:7054 \</span><br><span class="line">--enrollment.profile tls -d</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="证书链"><a href="#证书链" class="headerlink" title="证书链"></a>证书链</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fabric-ca-client getcainfo -u http://192.168.30.2:7054</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清空所有容器"><a href="#清空所有容器" class="headerlink" title="清空所有容器"></a>清空所有容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop $(docker ps -a -q)</span><br><span class="line">sudo docker ps -qa|xargs docker rm</span><br><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清空所有镜像"><a href="#清空所有镜像" class="headerlink" title="清空所有镜像"></a>清空所有镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker image rm $(docker images -a -q)</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理挂载卷"><a href="#清理挂载卷" class="headerlink" title="清理挂载卷"></a>清理挂载卷</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理项目文件"><a href="#清理项目文件" class="headerlink" title="清理项目文件"></a>清理项目文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">rm -rf raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-10-12T12:27:54.087Z" itemprop="dateUpdated">2020-10-12 20:27:54</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://cupswen.github.io">
            <img src="/img/the_Huanghe_River.png" alt="CupsWen">
            CupsWen
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fabric/" rel="tag">Fabric</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&title=《合同存证》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&title=《合同存证》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/10/05/2020/contract-deposit/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《合同存证》 — Cups&url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/10/12/2020/raft(1.4.3)/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Raft集群部署(Fabric1.4.3)</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/10/03/2020/knowledge-point-1/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">一些知识点</h4>
      </a>
    </div>
  
</nav>



    

</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>CupsWen &copy; 2019 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme indigo.</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&title=《合同存证》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&title=《合同存证》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/10/05/2020/contract-deposit/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《合同存证》 — Cups&url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/10/05/2020/contract-deposit/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://cupswen.github.io/2020/10/05/2020/contract-deposit/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Cups';
            clearTimeout(titleTime);
        } else {
            document.title = 'Cups';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
