<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Raft集群部署(Fabric1.4.3) | Cups</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Fabric,Raft">
    <meta name="description" content="参考博客：  https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;6844904187285749767 材料包所在地（实验系统）： IP：192.168.30.9 账号：root 密码：123456 大小18.5G 占时先不做。 先看看Fabric-CA和论文。  虚拟机资源">
<meta name="keywords" content="Fabric,Raft">
<meta property="og:type" content="article">
<meta property="og:title" content="Raft集群部署(Fabric1.4.3)">
<meta property="og:url" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;2020&#x2F;10&#x2F;03&#x2F;2020&#x2F;raft(1.4.3)&#x2F;index.html">
<meta property="og:site_name" content="Cups">
<meta property="og:description" content="参考博客：  https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;6844904187285749767 材料包所在地（实验系统）： IP：192.168.30.9 账号：root 密码：123456 大小18.5G 占时先不做。 先看看Fabric-CA和论文。  虚拟机资源">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;kafka&#x2F;virtual-machine.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;raft&#x2F;map.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;raft&#x2F;ip.png">
<meta property="og:updated_time" content="2020-10-03T06:36:55.917Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;kafka&#x2F;virtual-machine.png">
    
    <link rel="shortcut icon" href="/img/brand.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/the_Huanghe_River.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">CupsWen</h5>
          <a href="mailto:1191567189@qq.com" target="_blank" rel="noopener" title="1191567189@qq.com" class="mail">1191567189@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/index.html"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/CupsWen" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://cupswen.github.io/hyperlink"  >
                <i class="icon icon-lg icon-link"></i>
                Link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Raft集群部署(Fabric1.4.3)</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Raft集群部署(Fabric1.4.3)</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-10-03T06:36:10.000Z" itemprop="datePublished" class="page-time">
  2020-10-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#虚拟机资源"><span class="post-toc-text">虚拟机资源</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#组织、域名、ip匹配表"><span class="post-toc-text">组织、域名、ip匹配表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#网络拓扑"><span class="post-toc-text">网络拓扑</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置这些虚拟机"><span class="post-toc-text">配置这些虚拟机</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）虚拟机基础环境配置"><span class="post-toc-text">（一）虚拟机基础环境配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、防火墙"><span class="post-toc-text">1、防火墙</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、更改hosts文件"><span class="post-toc-text">2、更改hosts文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）Fabric基础环境配置"><span class="post-toc-text">（二）Fabric基础环境配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、bin"><span class="post-toc-text">1、bin</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、images"><span class="post-toc-text">2、images</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、fabric-samples"><span class="post-toc-text">3、fabric-samples</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Fabric相关操作"><span class="post-toc-text">Fabric相关操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）准备相关文件"><span class="post-toc-text">（一）准备相关文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、crypto-config-yaml"><span class="post-toc-text">1、crypto-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、configtx-yaml"><span class="post-toc-text">2、configtx.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、生成公私钥和证书"><span class="post-toc-text">3、生成公私钥和证书</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、生成创世区块"><span class="post-toc-text">4、生成创世区块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、生成通道配置区块"><span class="post-toc-text">5、生成通道配置区块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、智能合约"><span class="post-toc-text">6、智能合约</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7、docker-compose-orderer-yaml"><span class="post-toc-text">7、docker-compose-orderer.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10、docker-compose-peer-yaml"><span class="post-toc-text">10、docker-compose-peer.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#11、复制文件"><span class="post-toc-text">11、复制文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#12、文件目录"><span class="post-toc-text">12、文件目录*</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）启动网络"><span class="post-toc-text">（二）启动网络</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、orderer节点"><span class="post-toc-text">1、orderer节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、peer节点"><span class="post-toc-text">2、peer节点</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（1）peer01-192-168-30-5"><span class="post-toc-text">（1）peer01-192.168.30.5</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（2）peer01-192-168-30-7"><span class="post-toc-text">（2）peer01-192.168.30.7</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（3）peer01-192-168-30-8"><span class="post-toc-text">（3）peer01-192.168.30.8</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（4）peer01-192-168-30-9"><span class="post-toc-text">（4）peer01-192.168.30.9</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#常用命令"><span class="post-toc-text">常用命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有容器"><span class="post-toc-text">清空所有容器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有镜像"><span class="post-toc-text">清空所有镜像</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理挂载卷"><span class="post-toc-text">清理挂载卷</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理项目文件"><span class="post-toc-text">清理项目文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#相关知识"><span class="post-toc-text">相关知识</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）Raft"><span class="post-toc-text">（一）Raft</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）背书策略"><span class="post-toc-text">（二）背书策略</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、背书策略定义"><span class="post-toc-text">1、背书策略定义</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、背书策略语法"><span class="post-toc-text">2、背书策略语法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、设置背书策略"><span class="post-toc-text">3、设置背书策略</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、我的思考"><span class="post-toc-text">4、我的思考</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-2020/raft(1.4.3)"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Raft集群部署(Fabric1.4.3)</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-10-03 14:36:10" datetime="2020-10-03T06:36:10.000Z"  itemprop="datePublished">2020-10-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>参考博客：  <a href="https://juejin.im/post/6844904187285749767" target="_blank" rel="noopener">https://juejin.im/post/6844904187285749767</a></p>
<p>材料包所在地（实验系统）：</p>
<p>IP：192.168.30.9</p>
<p>账号：root</p>
<p>密码：123456</p>
<p>大小18.5G</p>
<p>占时先不做。</p>
<p>先看看Fabric-CA和论文。</p>
</blockquote>
<h1 id="虚拟机资源"><a href="#虚拟机资源" class="headerlink" title="虚拟机资源"></a>虚拟机资源</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/kafka/virtual-machine.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="组织、域名、ip匹配表"><a href="#组织、域名、ip匹配表" class="headerlink" title="组织、域名、ip匹配表"></a>组织、域名、ip匹配表</h1><table>
<thead>
<tr>
<th align="left">域名</th>
<th>ip地址</th>
<th align="center">组织</th>
<th align="center">内网ip</th>
</tr>
</thead>
<tbody><tr>
<td align="left">orderer0.example.com</td>
<td>192.168.30.2</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer1.example.com</td>
<td>192.168.30.3</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer2.example.com</td>
<td>192.168.30.4</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.org1.example.com</td>
<td>192.168.30.5</td>
<td align="center">org1</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.org2.example.com</td>
<td>192.168.30.6</td>
<td align="center">org1</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.org1.example.com</td>
<td>192.168.30.7</td>
<td align="center">org2</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.org2.example.com</td>
<td>192.168.30.8</td>
<td align="center">org2</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">nfs-server</td>
<td>192.168.30.9</td>
<td align="center"></td>
<td align="center">123</td>
</tr>
</tbody></table>
<h1 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/raft/map.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="配置这些虚拟机"><a href="#配置这些虚拟机" class="headerlink" title="配置这些虚拟机"></a>配置这些虚拟机</h1><p>由于虚拟机在不和本电脑在一个网段，若要通信需要配一个静态的本地IP（192.168.1.x）和一个虚拟机所在网段的IP地址（192.168.30.x）。</p>
<blockquote>
<p>ip配置如下。</p>
<p>192.168.1.200（路由器下的ip，供上网使用）</p>
<p>192.168.30.200（192.168.30.x，供连接虚拟机使用）</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/raft/ip.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<blockquote>
<p>注意保存。</p>
</blockquote>
<blockquote>
<p>win10下打开命令行，ping 一下虚拟机的ip测试连接情况。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\cups&gt;ping 192.168.30.18</span><br><span class="line"></span><br><span class="line">正在 Ping 192.168.30.18 具有 32 字节的数据:</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line"></span><br><span class="line">192.168.30.18 的 Ping 统计信息:</span><br><span class="line">    数据包: 已发送 = 3，已接收 = 3，丢失 = 0 (0% 丢失)，</span><br><span class="line">往返行程的估计时间(以毫秒为单位):</span><br><span class="line">    最短 = 0ms，最长 = 0ms，平均 = 0ms</span><br><span class="line">Control-C</span><br><span class="line">^C</span><br><span class="line">C:\Users\cups&gt;</span><br></pre></td></tr></table></figure>

<h2 id="（一）虚拟机基础环境配置"><a href="#（一）虚拟机基础环境配置" class="headerlink" title="（一）虚拟机基础环境配置"></a>（一）虚拟机基础环境配置</h2><h3 id="1、防火墙"><a href="#1、防火墙" class="headerlink" title="1、防火墙"></a>1、防火墙</h3><p>关闭防火墙</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：</p>
<p>1)设置防火墙</p>
<p><code>firewall-cmd --zone=public --permanent --add-port=5984/tcp --add-port=7050/tcp --add-port=7051/tcp --add-port=7052/tcp --add-port=7053/tcp --add-port=7054/tcp --add-port=8053/tcp --add-port=9053/tcp --add-port=10053/tcp</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168302 ~]# firewall-cmd --zone=public --permanent --add-port=5984/tcp --add-port=7050/tcp --add-port=7051/tcp --add-port=7052/tcp --add-port=7053/tcp --add-port=7054/tcp --add-port=8053/tcp --add-port=9053/tcp --add-port=10053/tcp</span><br><span class="line">success</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>

<p>2)重新载入</p>
<p><code>firewall-cmd --reload</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[root@vm192168302 ~]<span class="comment"># firewall-cmd --reload </span></span></span><br><span class="line">success</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>

<p>3)查看开放的端口</p>
<p> <code>firewall-cmd --zone=public --list-ports</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[root@vm192168302 ~]<span class="comment"># firewall-cmd --zone=public --list-ports </span></span></span><br><span class="line">5984/tcp 7050/tcp 7051/tcp 7052/tcp 7053/tcp 7054/tcp 8053/tcp 9053/tcp 10053/tcp</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2、更改hosts文件"><a href="#2、更改hosts文件" class="headerlink" title="2、更改hosts文件"></a>2、更改hosts文件</h3><blockquote>
<p>默认域名IP的对应关系。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.30.2 orderer0.example.com</span><br><span class="line">192.168.30.3 orderer1.example.com</span><br><span class="line">192.168.30.4 orderer2.example.com</span><br><span class="line">192.168.30.5 peer0.org1.example.com</span><br><span class="line">192.168.30.6 peer1.org1.example.com</span><br><span class="line">192.168.30.7 peer0.org2.example.com</span><br><span class="line">192.168.30.8 peer1.org2.example.com</span><br></pre></td></tr></table></figure>

<h2 id="（二）Fabric基础环境配置"><a href="#（二）Fabric基础环境配置" class="headerlink" title="（二）Fabric基础环境配置"></a>（二）Fabric基础环境配置</h2><blockquote>
<p>切换基础环境为1.4.3，主要是更换镜像和二进制文件。</p>
<p>路径：fabric-tools/fabric-1.4.3</p>
</blockquote>
<h3 id="1、bin"><a href="#1、bin" class="headerlink" title="1、bin"></a>1、bin</h3><blockquote>
<p>Fabric可执行二进制文件。</p>
</blockquote>
<p>命令行切换到bin目录下：<code>cd /root/fabric-tools/fabric-1.4.3/bin</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置当前目录下文件可读可写可执行</span></span><br><span class="line">chmod 777 -R ./*</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除原有的二进制文件</span></span><br><span class="line">rm -rf /usr/local/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 移动到/usr/<span class="built_in">local</span>/bin</span></span><br><span class="line">cp ./* /usr/local/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看二进制文件版本</span></span><br><span class="line">peer version</span><br></pre></td></tr></table></figure>

<h3 id="2、images"><a href="#2、images" class="headerlink" title="2、images"></a>2、images</h3><blockquote>
<p>Fabric镜像。</p>
</blockquote>
<blockquote>
<p>fabric-tools是本地客户端镜像，主要用来执行peer节点中的相关操作，如频道、智能合约等。</p>
<p>fabric-peer是fabric中网络节点的镜像。peer节点会对客户端提交的数据进行提交前的验证和背书。</p>
<p>fabric-orderer是fabric中网络节点的镜像。orderer节点会对客户单提交的数据进行校验、打包和分发。</p>
<p>fabric-ccenv是chaincode的运行环境。</p>
<p>fabric-baseos是chaincode编译环境里的一个os的基础 。</p>
<p>fabric-couchdb是第三方可插拔式数据库镜像。</p>
<p>fabric-kafka是供分布式基于发布/订阅的消息系统的镜像。</p>
<p>fabric-zookeeper提供高可用、高性能且一致的开源协调服务 。</p>
<p>fabric-ca是服务器本地CA Server，可以执行fabric-ca-client中的相关操作，实现登录、注册以及注销等操作。</p>
</blockquote>
<p>docker镜像下载地址：<a href="https://hub.docker.com/t/hyperledger" target="_blank" rel="noopener">https://hub.docker.com/t/hyperledger</a></p>
<p>命令行切换到images目录下：<code>cd /root/fabric-tools/fabric-1.4.3/images</code></p>
<p>按readme.txt中的进行迁移操作即可。readme.txt内容如下：</p>
<blockquote>
<p>目前机器中的镜像有1.4.0（kafka）、2.0.1（raft）、现在又1.4.3（raft）。</p>
<p>tag要做的容易区分。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line">打包</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打包镜像</span></span><br><span class="line">docker save 18ed4db0cd57&gt; /home/cups/images/fabric-tools-1.4.3.tar</span><br><span class="line">docker save c18a0d3cc958&gt; /home/cups/images/fabric-ca-1.4.3.tar</span><br><span class="line">docker save 3d31661a812a&gt; /home/cups/images/fabric-ccenv-1.4.3.tar</span><br><span class="line">docker save b666a6ebbe09&gt; /home/cups/images/fabric-orderer-1.4.3.tar</span><br><span class="line">docker save fa87ccaed0ef&gt; /home/cups/images/fabric-peer-1.4.3.tar</span><br><span class="line">docker save 20c6045930c8&gt; /home/cups/images/fabric-zookeeper-0.4.15.tar</span><br><span class="line">docker save b4ab82bbaf2f&gt; /home/cups/images/fabric-kafka-0.4.15.tar</span><br><span class="line">docker save 8de128a55539&gt; /home/cups/images/fabric-couchdb-0.4.15.tar</span><br><span class="line">docker save 9d6ec11c60ff&gt; /home/cups/images/fabric-baseos-amd64-0.4.15.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line">迁移</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载+标记</span></span><br><span class="line">docker load &lt; fabric-tools-1.4.3.tar</span><br><span class="line">docker tag 18ed4db0cd57 hyperledger/fabric-tools:1.4.3</span><br><span class="line">docker load &lt; fabric-ca-1.4.3.tar</span><br><span class="line">docker tag c18a0d3cc958 hyperledger/fabric-ca:1.4.3</span><br><span class="line">docker load &lt; fabric-ccenv-1.4.3.tar</span><br><span class="line">docker tag 3d31661a812a hyperledger/fabric-ccenv:1.4.3</span><br><span class="line">docker load &lt; fabric-orderer-1.4.3.tar</span><br><span class="line">docker tag b666a6ebbe09 hyperledger/fabric-orderer:1.4.3</span><br><span class="line">docker load &lt; fabric-peer-1.4.3.tar</span><br><span class="line">docker tag fa87ccaed0ef hyperledger/fabric-peer:1.4.3</span><br><span class="line">docker load &lt; fabric-zookeeper-0.4.15.tar</span><br><span class="line">docker tag 20c6045930c8 hyperledger/fabric-zookeeper:1.4.3</span><br><span class="line">docker load &lt; fabric-kafka-0.4.15.tar</span><br><span class="line">docker tag b4ab82bbaf2f hyperledger/fabric-kafka:1.4.3</span><br><span class="line">docker load &lt; fabric-couchdb-0.4.15.tar</span><br><span class="line">docker tag 8de128a55539 hyperledger/fabric-couchdb:1.4.3</span><br><span class="line">docker load &lt; fabric-baseos-amd64-0.4.15.tar</span><br><span class="line">docker tag 9d6ec11c60ff hyperledger/fabric-baseos-amd64-0.4.15:1.4.3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h3 id="3、fabric-samples"><a href="#3、fabric-samples" class="headerlink" title="3、fabric-samples"></a>3、fabric-samples</h3><blockquote>
<p>这个也不用试了，虚拟机都跑了多少回了。</p>
</blockquote>
<h1 id="Fabric相关操作"><a href="#Fabric相关操作" class="headerlink" title="Fabric相关操作"></a>Fabric相关操作</h1><h2 id="（一）准备相关文件"><a href="#（一）准备相关文件" class="headerlink" title="（一）准备相关文件"></a>（一）准备相关文件</h2><h3 id="1、crypto-config-yaml"><a href="#1、crypto-config-yaml" class="headerlink" title="1、crypto-config.yaml"></a>1、crypto-config.yaml</h3><blockquote>
<p>供cryptogen模块解释执行生成相关证书。</p>
<p>这些证书一部分用以网络节点的启动，另一部分用作客户端证书。</p>
<p> 更多内容请参考： <a href="https://hyperledgercn.github.io/hyperledgerDocs/" target="_blank" rel="noopener">https://hyperledgercn.github.io/hyperledgerDocs/</a> </p>
</blockquote>
<p>建立文件夹kafka用于存储相关文件:<code>mkdir raft</code></p>
<p>进入生成的文件夹：<code>cd raft</code></p>
<p>新建crypto-config.yaml并写入如下内容：<code>vim crypto-config.yaml</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">OrdererOrgs:</span><br><span class="line">  - Name: Orderer</span><br><span class="line">    Domain: example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Specs:</span><br><span class="line">      - Hostname: orderer0</span><br><span class="line">      - Hostname: orderer1</span><br><span class="line">      - Hostname: orderer2</span><br><span class="line"></span><br><span class="line">PeerOrgs:</span><br><span class="line">  - Name: Org1</span><br><span class="line">    Domain: org1.example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br><span class="line"></span><br><span class="line">  - Name: Org2</span><br><span class="line">    Domain: org2.example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br></pre></td></tr></table></figure>

<h3 id="2、configtx-yaml"><a href="#2、configtx-yaml" class="headerlink" title="2、configtx.yaml"></a>2、configtx.yaml</h3><blockquote>
<p> configtx.yaml是Hyperledger Fabric区块链网络运维工具configtxgen用于生成通道创世块或通道交易的配置文件，configtx.yaml的内容直接决定了所生成的创世区块的内容。 </p>
<p>更多内容请参考： <a href="https://segmentfault.com/a/1190000018990043?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018990043?utm_source=tag-newest</a> </p>
</blockquote>
<p>新建configtx.yaml 并写入如下内容：<code>vim configtx.yaml</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">Organizations:</span><br><span class="line">    - &amp;OrdererOrg</span><br><span class="line">        Name: OrdererOrg</span><br><span class="line">        ID: OrdererMSP</span><br><span class="line">        MSPDir: crypto-config/ordererOrganizations/example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.member')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.member')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.admin')"</span><br><span class="line"></span><br><span class="line">    - &amp;Org1</span><br><span class="line">        Name: Org1MSP</span><br><span class="line">        ID: Org1MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org1.example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin', 'Org1MSP.peer', 'Org1MSP.client')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin', 'Org1MSP.client')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin')"</span><br><span class="line">            Endorsement:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.peer')"</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org1.example.com</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">    - &amp;Org2</span><br><span class="line">        Name: Org2MSP</span><br><span class="line">        ID: Org2MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org2.example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin', 'Org2MSP.peer', 'Org2MSP.client')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin', 'Org2MSP.client')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin')"</span><br><span class="line">            Endorsement:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.peer')"</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org2.example.com</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">Capabilities:</span><br><span class="line">    Channel: &amp;ChannelCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line">    Orderer: &amp;OrdererCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line">    Application: &amp;ApplicationCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line"></span><br><span class="line">Application: &amp;ApplicationDefaults</span><br><span class="line">    Organizations:</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">        LifecycleEndorsement:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Endorsement"</span><br><span class="line">        Endorsement:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Endorsement"</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ApplicationCapabilities</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Orderer: &amp;OrdererDefaults</span><br><span class="line">    OrdererType: etcdraft</span><br><span class="line">    Addresses:</span><br><span class="line">        - orderer0.example.com:7050</span><br><span class="line">        - orderer1.example.com:7050</span><br><span class="line">        - orderer2.example.com:7050</span><br><span class="line">    BatchTimeout: 2s</span><br><span class="line">    BatchSize:</span><br><span class="line">        MaxMessageCount: 10</span><br><span class="line">        AbsoluteMaxBytes: 99 MB</span><br><span class="line">        PreferredMaxBytes: 512 KB</span><br><span class="line">    Kafka:</span><br><span class="line">        Brokers:</span><br><span class="line">            - 127.0.0.1:9092</span><br><span class="line">    EtcdRaft:</span><br><span class="line">        Consenters:</span><br><span class="line">            - Host: orderer0.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br><span class="line">            - Host: orderer1.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br><span class="line">            - Host: orderer2.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><span class="line">    Organizations:</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">        BlockValidation:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Channel: &amp;ChannelDefaults</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ChannelCapabilities</span><br><span class="line"></span><br><span class="line">Profiles:</span><br><span class="line"></span><br><span class="line">    TwoOrgsOrdererGenesis:</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Orderer:</span><br><span class="line">            &lt;&lt;: *OrdererDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *OrdererOrg</span><br><span class="line">            Capabilities:</span><br><span class="line">                &lt;&lt;: *OrdererCapabilities</span><br><span class="line">        Consortiums:</span><br><span class="line">            SampleConsortium:</span><br><span class="line">                Organizations:</span><br><span class="line">                    - *Org1</span><br><span class="line">                    - *Org2</span><br><span class="line">    TwoOrgsChannel:</span><br><span class="line">        Consortium: SampleConsortium</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Application:</span><br><span class="line">            &lt;&lt;: *ApplicationDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *Org1</span><br><span class="line">                - *Org2</span><br><span class="line">            Capabilities:</span><br><span class="line">                &lt;&lt;: *ApplicationCapabilities</span><br></pre></td></tr></table></figure>

<h3 id="3、生成公私钥和证书"><a href="#3、生成公私钥和证书" class="headerlink" title="3、生成公私钥和证书"></a>3、生成公私钥和证书</h3><blockquote>
<p>生成公私钥以及证书。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptogen generate --config=./crypto-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4、生成创世区块"><a href="#4、生成创世区块" class="headerlink" title="4、生成创世区块"></a>4、生成创世区块</h3><blockquote>
<p>创世区块中包含有网络信息。</p>
<p><strong>有区别：-channelID system</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir channel-artifacts</span><br><span class="line">configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block -channelID system</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="5、生成通道配置区块"><a href="#5、生成通道配置区块" class="headerlink" title="5、生成通道配置区块"></a>5、生成通道配置区块</h3><blockquote>
<p>通道文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6、智能合约"><a href="#6、智能合约" class="headerlink" title="6、智能合约"></a>6、智能合约</h3><blockquote>
<p>在通道内安装的智能合约。</p>
<p>以chaincode_example02.go为例。</p>
</blockquote>
<p>智能合约代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	"errors"</span><br><span class="line">	"fmt"</span><br><span class="line">	"strconv"</span><br><span class="line"></span><br><span class="line">	"github.com/hyperledger/fabric-contract-api-go/contractapi"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// ABstore Chaincode implementation</span><br><span class="line">type ABstore struct &#123;</span><br><span class="line">	contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (t *ABstore) Init(ctx contractapi.TransactionContextInterface, A string, Aval int, B string, Bval int) error &#123;</span><br><span class="line">	fmt.Println("ABstore Init")</span><br><span class="line">	var err error</span><br><span class="line">	// Initialize the chaincode</span><br><span class="line">	fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval)</span><br><span class="line">	// Write the state to the ledger</span><br><span class="line">	err = ctx.GetStub().PutState(A, []byte(strconv.Itoa(Aval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ctx.GetStub().PutState(B, []byte(strconv.Itoa(Bval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Transaction makes payment of X units from A to B</span><br><span class="line">func (t *ABstore) Invoke(ctx contractapi.TransactionContextInterface, A, B string, X int) error &#123;</span><br><span class="line">	var err error</span><br><span class="line">	var Aval int</span><br><span class="line">	var Bval int</span><br><span class="line">	// Get the state from the ledger</span><br><span class="line">	// TODO: will be nice to have a GetAllState call to ledger</span><br><span class="line">	Avalbytes, err := ctx.GetStub().GetState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to get state")</span><br><span class="line">	&#125;</span><br><span class="line">	if Avalbytes == nil &#123;</span><br><span class="line">		return fmt.Errorf("Entity not found")</span><br><span class="line">	&#125;</span><br><span class="line">	Aval, _ = strconv.Atoi(string(Avalbytes))</span><br><span class="line"></span><br><span class="line">	Bvalbytes, err := ctx.GetStub().GetState(B)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to get state")</span><br><span class="line">	&#125;</span><br><span class="line">	if Bvalbytes == nil &#123;</span><br><span class="line">		return fmt.Errorf("Entity not found")</span><br><span class="line">	&#125;</span><br><span class="line">	Bval, _ = strconv.Atoi(string(Bvalbytes))</span><br><span class="line"></span><br><span class="line">	// Perform the execution</span><br><span class="line">	Aval = Aval - X</span><br><span class="line">	Bval = Bval + X</span><br><span class="line">	fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval)</span><br><span class="line"></span><br><span class="line">	// Write the state back to the ledger</span><br><span class="line">	err = ctx.GetStub().PutState(A, []byte(strconv.Itoa(Aval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ctx.GetStub().PutState(B, []byte(strconv.Itoa(Bval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Delete  an entity from state</span><br><span class="line">func (t *ABstore) Delete(ctx contractapi.TransactionContextInterface, A string) error &#123;</span><br><span class="line"></span><br><span class="line">	// Delete the key from the state in ledger</span><br><span class="line">	err := ctx.GetStub().DelState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to delete state")</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Query callback representing the query of a chaincode</span><br><span class="line">func (t *ABstore) Query(ctx contractapi.TransactionContextInterface, A string) (string, error) &#123;</span><br><span class="line">	var err error</span><br><span class="line">	// Get the state from the ledger</span><br><span class="line">	Avalbytes, err := ctx.GetStub().GetState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		jsonResp := "&#123;\"Error\":\"Failed to get state for " + A + "\"&#125;"</span><br><span class="line">		return "", errors.New(jsonResp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if Avalbytes == nil &#123;</span><br><span class="line">		jsonResp := "&#123;\"Error\":\"Nil amount for " + A + "\"&#125;"</span><br><span class="line">		return "", errors.New(jsonResp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jsonResp := "&#123;\"Name\":\"" + A + "\",\"Amount\":\"" + string(Avalbytes) + "\"&#125;"</span><br><span class="line">	fmt.Printf("Query Response:%s\n", jsonResp)</span><br><span class="line">	return string(Avalbytes), nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	cc, err := contractapi.NewChaincode(new(ABstore))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	if err := cc.Start(); err != nil &#123;</span><br><span class="line">		fmt.Printf("Error starting ABstore chaincode: %s", err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、docker-compose-orderer-yaml"><a href="#7、docker-compose-orderer-yaml" class="headerlink" title="7、docker-compose-orderer.yaml"></a>7、docker-compose-orderer.yaml</h3><blockquote>
<p>启动orderer节点的配置文件。</p>
<p>docker-compose-orderer0.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.18</p>
<p>docker-compose-orderer1.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.19</p>
<p>docker-compose-orderer2.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.20</p>
</blockquote>
<p><code>docker-compose-orderer0.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer0.example.com:</span><br><span class="line">    container_name: orderer0.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-orderer1.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer1.example.com:</span><br><span class="line">    container_name: orderer1.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-orderer2.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer2.example.com:</span><br><span class="line">    container_name: orderer2.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<h3 id="10、docker-compose-peer-yaml"><a href="#10、docker-compose-peer-yaml" class="headerlink" title="10、docker-compose-peer.yaml"></a>10、docker-compose-peer.yaml</h3><blockquote>
<p>启动peer节点的配置文件。</p>
<p>docker-compose-peer01.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.21</p>
<p>docker-compose-peer11.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.22</p>
<p>docker-compose-peer02.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.23</p>
<p>docker-compose-peer12.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.24</p>
</blockquote>
<p><code>docker-compose-peer01.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer0.org1.example.com:</span><br><span class="line">    container_name: peer0.org1.example.com</span><br><span class="line">    hostname: peer0.org1.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer0.org1.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer11.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer1.org1.example.com:</span><br><span class="line">    container_name: peer1.org1.example.com</span><br><span class="line">    hostname: peer1.org1.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer1.org1.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer1.org1.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer02.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer0.org2.example.com:</span><br><span class="line">    container_name: peer0.org2.example.com</span><br><span class="line">    hostname: peer0.org2.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer0.org2.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer12.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer1.org2.example.com:</span><br><span class="line">    container_name: peer1.org2.example.com</span><br><span class="line">    hostname: peer1.org2.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer1.org2.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer1.org2.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<h3 id="11、复制文件"><a href="#11、复制文件" class="headerlink" title="11、复制文件"></a>11、复制文件</h3><blockquote>
<p>直接全部复制。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">scp -r raft/ root@192.168.30.3:/root/</span><br><span class="line">...</span><br><span class="line">scp -r raft/ root@192.168.30.9:/root/</span><br></pre></td></tr></table></figure>

<h3 id="12、文件目录"><a href="#12、文件目录" class="headerlink" title="12、文件目录*"></a>12、文件目录*</h3><blockquote>
<p>最终目录结构如下所示。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168302 raft]# tree -L 3</span><br><span class="line">.</span><br><span class="line">├── chaincode</span><br><span class="line">│   └── abstore</span><br><span class="line">│       ├── abstore.go</span><br><span class="line">│       ├── go.mod</span><br><span class="line">│       └── go.sum</span><br><span class="line">├── channel-artifacts</span><br><span class="line">│   ├── genesis.block</span><br><span class="line">│   └── mychannel.tx</span><br><span class="line">├── configtx.yaml</span><br><span class="line">├── crypto-config</span><br><span class="line">│   ├── ordererOrganizations</span><br><span class="line">│   │   └── example.com</span><br><span class="line">│   └── peerOrganizations</span><br><span class="line">│       ├── org1.example.com</span><br><span class="line">│       └── org2.example.com</span><br><span class="line">├── crypto-config.yaml</span><br><span class="line">├── docker-compose-orderer0.yaml</span><br><span class="line">├── docker-compose-orderer1.yaml</span><br><span class="line">├── docker-compose-orderer2.yaml</span><br><span class="line">├── docker-compose-peer01.yaml</span><br><span class="line">├── docker-compose-peer02.yaml</span><br><span class="line">├── docker-compose-peer11.yaml</span><br><span class="line">└── docker-compose-peer12.yaml</span><br><span class="line"></span><br><span class="line">9 directories, 14 files</span><br><span class="line">[root@vm192168302 raft]#</span><br></pre></td></tr></table></figure>

<h2 id="（二）启动网络"><a href="#（二）启动网络" class="headerlink" title="（二）启动网络"></a>（二）启动网络</h2><h3 id="1、orderer节点"><a href="#1、orderer节点" class="headerlink" title="1、orderer节点"></a>1、orderer节点</h3><blockquote>
<p>docker-compose -f docker-compose-orderer0.yaml up -d</p>
<p>docker-compose -f docker-compose-orderer1.yaml up -d</p>
<p>docker-compose -f docker-compose-orderer2.yaml up -d</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.2</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168302 raft]# docker-compose -f docker-compose-orderer0.yaml up -d</span><br><span class="line">Creating network "raft_default" with the default driver</span><br><span class="line">Creating orderer0.example.com ... done</span><br><span class="line">[root@vm192168302 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">abda5bdce50d        hyperledger/fabric-orderer   "orderer"           14 seconds ago      Up 14 seconds       0.0.0.0:7050-&gt;7050/tcp   orderer0.example.com</span><br><span class="line">[root@vm192168302 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.3</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168303 raft]# docker-compose -f docker-compose-orderer1.yaml up -d</span><br><span class="line">Recreating orderer1.example.com ... done</span><br><span class="line">[root@vm192168303 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">536cd9d8a64a        hyperledger/fabric-orderer   "orderer"           15 seconds ago      Up 9 seconds        0.0.0.0:7050-&gt;7050/tcp   orderer1.example.com</span><br><span class="line">[root@vm192168303 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.4</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168304 raft]# docker-compose -f docker-compose-orderer2.yaml up -d</span><br><span class="line">Creating orderer2.example.com ... done</span><br><span class="line">[root@vm192168304 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">6b5d1db775e2        hyperledger/fabric-orderer   "orderer"           8 seconds ago       Up 7 seconds        0.0.0.0:7050-&gt;7050/tcp   orderer2.example.com</span><br><span class="line">[root@vm192168304 raft]#</span><br></pre></td></tr></table></figure>

<h3 id="2、peer节点"><a href="#2、peer节点" class="headerlink" title="2、peer节点"></a>2、peer节点</h3><blockquote>
<p>docker-compose -f docker-compose-peer01.yaml up -d</p>
<p>docker-compose -f docker-compose-peer11.yaml up -d</p>
<p>docker-compose -f docker-compose-peer02.yaml up -d</p>
<p>docker-compose -f docker-compose-peer12.yaml up -d</p>
<blockquote>
<p>启动peer节点和后面的加入通道、打包链码、安装链码是可以做到一块的，而且呢样对于操作来说更顺畅。之所以把这几块分开，是因为2.0的链码操作有点迷（让人疑惑）且复杂，各部分分开来做容易理解且不容易出错。</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168305 raft]# docker-compose -f docker-compose-peer01.yaml up -d</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">[root@vm192168305 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">b57883b993ca        hyperledger/fabric-tools   "/bin/sh"           12 minutes ago      Up 12 minutes                                          cli</span><br><span class="line">003fd775dc2b        hyperledger/fabric-peer    "peer node start"   12 minutes ago      Up 12 minutes       0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org1.example.com</span><br><span class="line">[root@vm192168305 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168306 raft]# docker-compose -f docker-compose-peer02.yaml up -d</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">[root@vm192168306 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">679ad519dec1        hyperledger/fabric-tools   "/bin/sh"           4 minutes ago       Up 4 minutes                                           cli</span><br><span class="line">94760cadc526        hyperledger/fabric-peer    "peer node start"   4 minutes ago       Up 4 minutes        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org2.example.com</span><br><span class="line">[root@vm192168306 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168307 raft]# docker-compose -f docker-compose-peer02.yaml up -d</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">[root@vm192168307 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">5c7e8c6dbc8a        hyperledger/fabric-peer    "peer node start"   4 seconds ago       Up 3 seconds        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org2.example.com</span><br><span class="line">2d412e5672b2        hyperledger/fabric-tools   "/bin/sh"           4 seconds ago       Up 3 seconds                                           cli</span><br><span class="line">[root@vm192168307 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.8</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168308 raft]# docker-compose -f docker-compose-peer12.yaml up -d</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">Creating peer1.org2.example.com ... done</span><br><span class="line">[root@vm192168308 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">d9bcf06e2640        hyperledger/fabric-peer    "peer node start"   4 seconds ago       Up 2 seconds        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer1.org2.example.com</span><br><span class="line">2e537f7b6659        hyperledger/fabric-tools   "/bin/sh"           4 seconds ago       Up 2 seconds                                           cli</span><br><span class="line">[root@vm192168308 raft]#</span><br></pre></td></tr></table></figure>

<h2 id="（1）peer01-192-168-30-5"><a href="#（1）peer01-192-168-30-5" class="headerlink" title="（1）peer01-192.168.30.5"></a>（1）peer01-192.168.30.5</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

</blockquote>
<h2 id="（2）peer01-192-168-30-7"><a href="#（2）peer01-192-168-30-7" class="headerlink" title="（2）peer01-192.168.30.7"></a>（2）peer01-192.168.30.7</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

</blockquote>
<h2 id="（3）peer01-192-168-30-8"><a href="#（3）peer01-192-168-30-8" class="headerlink" title="（3）peer01-192.168.30.8"></a>（3）peer01-192.168.30.8</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="（4）peer01-192-168-30-9"><a href="#（4）peer01-192-168-30-9" class="headerlink" title="（4）peer01-192.168.30.9"></a>（4）peer01-192.168.30.9</h2><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>


</blockquote>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><blockquote>
<h2 id="清空所有容器"><a href="#清空所有容器" class="headerlink" title="清空所有容器"></a>清空所有容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop $(docker ps -a -q)</span><br><span class="line">sudo docker ps -qa|xargs docker rm</span><br><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br><span class="line">cd /root/raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清空所有镜像"><a href="#清空所有镜像" class="headerlink" title="清空所有镜像"></a>清空所有镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker image rm $(docker images -a -q)</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理挂载卷"><a href="#清理挂载卷" class="headerlink" title="清理挂载卷"></a>清理挂载卷</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br><span class="line">cd /root/raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理项目文件"><a href="#清理项目文件" class="headerlink" title="清理项目文件"></a>清理项目文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">rm -rf raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h1><h2 id="（一）Raft"><a href="#（一）Raft" class="headerlink" title="（一）Raft"></a>（一）Raft</h2><blockquote>
<p>参考文献：</p>
<p>算法基础：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft.html</a> </p>
<p>选举和日志复制：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_2.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_2.html</a></p>
<p>安全性：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_3.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_3.html</a></p>
<p>节点变更：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_4.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_4.html</a></p>
<p>唐伯虎点秋香：<a href="https://blog.csdn.net/qq_28540443/article/details/105092746" target="_blank" rel="noopener">https://blog.csdn.net/qq_28540443/article/details/105092746</a></p>
<p>raft动画：<a href="http://thesecretlivesofdata.com/raft/" target="_blank" rel="noopener">http://thesecretlivesofdata.com/raft/</a></p>
<p>raft论文：<a href="https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md" target="_blank" rel="noopener">https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md</a></p>
</blockquote>
<h2 id="（二）背书策略"><a href="#（二）背书策略" class="headerlink" title="（二）背书策略"></a>（二）背书策略</h2><h3 id="1、背书策略定义"><a href="#1、背书策略定义" class="headerlink" title="1、背书策略定义"></a>1、背书策略定义</h3><p>智能合约背书策略用来定义交易是否合法的判断条件，策略以主体的形式表示。主体格式为’MSP.ROLE’， MSP代表所要求的MSPID， ROLE表示角色，一共有四种合法角色：member, admin, client, peer。</p>
<h3 id="2、背书策略语法"><a href="#2、背书策略语法" class="headerlink" title="2、背书策略语法"></a>2、背书策略语法</h3><p>背书策略的语法如下：<br>EXPR(E[, E…])<br>EXPR可以是AND、OR、OutOf，E可以是一个上面示例的主体或者是另一个嵌套的EXPR策略。示例如下：<br>AND(‘Org1.member’, ‘Org2.member’, ‘Org3.member’) ：要求三个主体中每一个主体都要签名。<br>OR(‘Org1.member’, ‘Org2.member’) ：要求三个主体中至少有一个主体签名。<br>OR(‘Org1.member’, AND(‘Org2.member’, ‘Org3.member’))：要求满足有主体Org1.member的签名或者同时有主体Org2.member与Org3.member 2个主体的签名。<br>OutOf(2, ‘Org1.member’, ‘Org2.member’, ‘Org3.member’) ：要求三个主体中，至少有两个主体签名。</p>
<h3 id="3、设置背书策略"><a href="#3、设置背书策略" class="headerlink" title="3、设置背书策略"></a>3、设置背书策略</h3><p>fabric2.0智能合约设置背书策略得方式主要有两种，一种是通过提交合约的时候设置，我们称之为合约级别的背书策略，一种是直接通过合约动态设置，我们称之为键级别背书策略。</p>
<p>合约级别背书策略上边讲过了。</p>
<p>键级别背书策略可以看这里：<a href="https://blog.csdn.net/qq_28540443/article/details/104379132。" target="_blank" rel="noopener">https://blog.csdn.net/qq_28540443/article/details/104379132。</a></p>
<h3 id="4、我的思考"><a href="#4、我的思考" class="headerlink" title="4、我的思考"></a>4、我的思考</h3><blockquote>
<p>fabric合法角色：member、admin、client、peer。</p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-10-03T06:36:55.917Z" itemprop="dateUpdated">2020-10-03 14:36:55</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://cupswen.github.io">
            <img src="/img/the_Huanghe_River.png" alt="CupsWen">
            CupsWen
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fabric/" rel="tag">Fabric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raft/" rel="tag">Raft</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&title=《Raft集群部署(Fabric1.4.3)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&title=《Raft集群部署(Fabric1.4.3)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Raft集群部署(Fabric1.4.3)》 — Cups&url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/10/03/2020/knowledge-point-1/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">一些知识点</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/09/27/2020/raft(2.0.1)/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Raft集群部署(Fabric2.0)</h4>
      </a>
    </div>
  
</nav>



    

</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>CupsWen &copy; 2019 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme indigo.</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&title=《Raft集群部署(Fabric1.4.3)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&title=《Raft集群部署(Fabric1.4.3)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Raft集群部署(Fabric1.4.3)》 — Cups&url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://cupswen.github.io/2020/10/03/2020/raft(1.4.3)/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Cups';
            clearTimeout(titleTime);
        } else {
            document.title = 'Cups';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
