<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Raft集群部署(Fabric2.0) | Cups</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Fabric,Raft">
    <meta name="description" content="参考博客：  https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;6844904187285749767 材料包所在地（实验系统）： IP：192.168.30.9 账号：root 密码：123456 大小18.5G  虚拟机资源">
<meta name="keywords" content="Fabric,Raft">
<meta property="og:type" content="article">
<meta property="og:title" content="Raft集群部署(Fabric2.0)">
<meta property="og:url" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;2020&#x2F;09&#x2F;27&#x2F;2020&#x2F;raft(2.0.1)&#x2F;index.html">
<meta property="og:site_name" content="Cups">
<meta property="og:description" content="参考博客：  https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;6844904187285749767 材料包所在地（实验系统）： IP：192.168.30.9 账号：root 密码：123456 大小18.5G  虚拟机资源">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;kafka&#x2F;virtual-machine.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;raft&#x2F;map.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;raft&#x2F;ip.png">
<meta property="og:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;raft&#x2F;chaincode.png">
<meta property="og:updated_time" content="2020-10-03T08:55:31.573Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;img&#x2F;kafka&#x2F;virtual-machine.png">
    
    <link rel="shortcut icon" href="/img/brand.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/the_Huanghe_River.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">CupsWen</h5>
          <a href="mailto:1191567189@qq.com" target="_blank" rel="noopener" title="1191567189@qq.com" class="mail">1191567189@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/index.html"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/CupsWen" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://cupswen.github.io/hyperlink"  >
                <i class="icon icon-lg icon-link"></i>
                Link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Raft集群部署(Fabric2.0)</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Raft集群部署(Fabric2.0)</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-09-27T13:43:10.000Z" itemprop="datePublished" class="page-time">
  2020-09-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#虚拟机资源"><span class="post-toc-text">虚拟机资源</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#组织、域名、ip匹配表"><span class="post-toc-text">组织、域名、ip匹配表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#网络拓扑"><span class="post-toc-text">网络拓扑</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#配置这些虚拟机"><span class="post-toc-text">配置这些虚拟机</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）虚拟机基础环境配置"><span class="post-toc-text">（一）虚拟机基础环境配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、Xshell登录"><span class="post-toc-text">1、Xshell登录</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、使虚拟机可以上网"><span class="post-toc-text">2、使虚拟机可以上网</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、防火墙"><span class="post-toc-text">3、防火墙</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、设置Selinux"><span class="post-toc-text">4、设置Selinux</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、设置时间同步"><span class="post-toc-text">5、设置时间同步</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、安装常用工具"><span class="post-toc-text">6、安装常用工具</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7、更换软件源"><span class="post-toc-text">7、更换软件源</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8、更改hosts文件"><span class="post-toc-text">8、更改hosts文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）Fabric基础环境配置"><span class="post-toc-text">（二）Fabric基础环境配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、go"><span class="post-toc-text">1、go</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、docker-ce"><span class="post-toc-text">2、docker-ce</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、docker-compose"><span class="post-toc-text">3、docker-compose</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、bin"><span class="post-toc-text">4、bin</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、images"><span class="post-toc-text">5、images</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、fabric-samples"><span class="post-toc-text">6、fabric-samples</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7、nodejs"><span class="post-toc-text">7、nodejs*</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Fabric相关操作"><span class="post-toc-text">Fabric相关操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）准备相关文件"><span class="post-toc-text">（一）准备相关文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、crypto-config-yaml"><span class="post-toc-text">1、crypto-config.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、configtx-yaml"><span class="post-toc-text">2、configtx.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、生成公私钥和证书"><span class="post-toc-text">3、生成公私钥和证书</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、生成创世区块"><span class="post-toc-text">4、生成创世区块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、生成通道配置区块"><span class="post-toc-text">5、生成通道配置区块</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、智能合约"><span class="post-toc-text">6、智能合约</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7、docker-compose-orderer-yaml"><span class="post-toc-text">7、docker-compose-orderer.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10、docker-compose-peer-yaml"><span class="post-toc-text">10、docker-compose-peer.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#11、复制文件"><span class="post-toc-text">11、复制文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#12、文件目录"><span class="post-toc-text">12、文件目录*</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）启动网络"><span class="post-toc-text">（二）启动网络</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、orderer节点"><span class="post-toc-text">1、orderer节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、peer节点"><span class="post-toc-text">2、peer节点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、通道"><span class="post-toc-text">3、通道</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）peer01-192-168-30-5"><span class="post-toc-text">（1）peer01-192.168.30.5</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）peer01-192-168-30-7"><span class="post-toc-text">（2）peer01-192.168.30.7</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）peer01-192-168-30-8"><span class="post-toc-text">（3）peer01-192.168.30.8</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）peer01-192-168-30-9"><span class="post-toc-text">（4）peer01-192.168.30.9</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（三）链码"><span class="post-toc-text">（三）链码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、打包链码"><span class="post-toc-text">1、打包链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、安装链码"><span class="post-toc-text">2、安装链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）peer01-192-168-30-5-1"><span class="post-toc-text">（1）peer01-192.168.30.5</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）peer11-192-168-30-6"><span class="post-toc-text">（2）peer11-192.168.30.6</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（3）peer02-192-168-30-7"><span class="post-toc-text">（3）peer02-192.168.30.7</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（4）peer12-192-168-30-8"><span class="post-toc-text">（4）peer12-192.168.30.8</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、批准链码"><span class="post-toc-text">3、批准链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、提交链码"><span class="post-toc-text">4、提交链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、初始化链码"><span class="post-toc-text">5、初始化链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、测试链码"><span class="post-toc-text">6、测试链码</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（四）更改背书策略"><span class="post-toc-text">（四）更改背书策略</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、批准链码"><span class="post-toc-text">1、批准链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、提交链码"><span class="post-toc-text">2、提交链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、测试链码"><span class="post-toc-text">3、测试链码</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（五）链码升级"><span class="post-toc-text">（五）链码升级</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、打包链码-1"><span class="post-toc-text">1、打包链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、安装链码-1"><span class="post-toc-text">2、安装链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、批准链码-1"><span class="post-toc-text">3、批准链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、提交链码-1"><span class="post-toc-text">4、提交链码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、测试链码-1"><span class="post-toc-text">6、测试链码</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#常用命令"><span class="post-toc-text">常用命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有容器"><span class="post-toc-text">清空所有容器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清空所有镜像"><span class="post-toc-text">清空所有镜像</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理挂载卷"><span class="post-toc-text">清理挂载卷</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#清理项目文件"><span class="post-toc-text">清理项目文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#相关知识"><span class="post-toc-text">相关知识</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（一）Raft"><span class="post-toc-text">（一）Raft</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#（二）背书策略"><span class="post-toc-text">（二）背书策略</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、背书策略定义"><span class="post-toc-text">1、背书策略定义</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、背书策略语法"><span class="post-toc-text">2、背书策略语法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、设置背书策略"><span class="post-toc-text">3、设置背书策略</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、我的思考"><span class="post-toc-text">4、我的思考</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-2020/raft(2.0.1)"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Raft集群部署(Fabric2.0)</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-09-27 21:43:10" datetime="2020-09-27T13:43:10.000Z"  itemprop="datePublished">2020-09-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>参考博客：  <a href="https://juejin.im/post/6844904187285749767" target="_blank" rel="noopener">https://juejin.im/post/6844904187285749767</a></p>
<p>材料包所在地（实验系统）：</p>
<p>IP：192.168.30.9</p>
<p>账号：root</p>
<p>密码：123456</p>
<p>大小18.5G</p>
</blockquote>
<h1 id="虚拟机资源"><a href="#虚拟机资源" class="headerlink" title="虚拟机资源"></a>虚拟机资源</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/kafka/virtual-machine.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="组织、域名、ip匹配表"><a href="#组织、域名、ip匹配表" class="headerlink" title="组织、域名、ip匹配表"></a>组织、域名、ip匹配表</h1><table>
<thead>
<tr>
<th align="left">域名</th>
<th>ip地址</th>
<th align="center">组织</th>
<th align="center">内网ip</th>
</tr>
</thead>
<tbody><tr>
<td align="left">orderer0.example.com</td>
<td>192.168.30.2</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer1.example.com</td>
<td>192.168.30.3</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">orderer2.example.com</td>
<td>192.168.30.4</td>
<td align="center">orderer</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.org1.example.com</td>
<td>192.168.30.5</td>
<td align="center">org1</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.org2.example.com</td>
<td>192.168.30.6</td>
<td align="center">org1</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer0.org1.example.com</td>
<td>192.168.30.7</td>
<td align="center">org2</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">peer1.org2.example.com</td>
<td>192.168.30.8</td>
<td align="center">org2</td>
<td align="center">123</td>
</tr>
<tr>
<td align="left">nfs-server</td>
<td>192.168.30.9</td>
<td align="center"></td>
<td align="center">123</td>
</tr>
</tbody></table>
<h1 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/raft/map.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h1 id="配置这些虚拟机"><a href="#配置这些虚拟机" class="headerlink" title="配置这些虚拟机"></a>配置这些虚拟机</h1><p>由于虚拟机在不和本电脑在一个网段，若要通信需要配一个静态的本地IP（192.168.1.x）和一个虚拟机所在网段的IP地址（192.168.30.x）。</p>
<blockquote>
<p>ip配置如下。</p>
<p>192.168.1.200（路由器下的ip，供上网使用）</p>
<p>192.168.30.200（192.168.30.x，供连接虚拟机使用）</p>
</blockquote>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/raft/ip.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<blockquote>
<p>注意保存。</p>
</blockquote>
<blockquote>
<p>win10下打开命令行，ping 一下虚拟机的ip测试连接情况。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\cups&gt;ping 192.168.30.18</span><br><span class="line"></span><br><span class="line">正在 Ping 192.168.30.18 具有 32 字节的数据:</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line">来自 192.168.30.18 的回复: 字节=32 时间&lt;1ms TTL=64</span><br><span class="line"></span><br><span class="line">192.168.30.18 的 Ping 统计信息:</span><br><span class="line">    数据包: 已发送 = 3，已接收 = 3，丢失 = 0 (0% 丢失)，</span><br><span class="line">往返行程的估计时间(以毫秒为单位):</span><br><span class="line">    最短 = 0ms，最长 = 0ms，平均 = 0ms</span><br><span class="line">Control-C</span><br><span class="line">^C</span><br><span class="line">C:\Users\cups&gt;</span><br></pre></td></tr></table></figure>

<h2 id="（一）虚拟机基础环境配置"><a href="#（一）虚拟机基础环境配置" class="headerlink" title="（一）虚拟机基础环境配置"></a>（一）虚拟机基础环境配置</h2><h3 id="1、Xshell登录"><a href="#1、Xshell登录" class="headerlink" title="1、Xshell登录"></a>1、Xshell登录</h3><p>Xshell下载地址： <a href="https://www.netsarang.com/zh/xshell/" target="_blank" rel="noopener">https://www.netsarang.com/zh/xshell/</a> </p>
<p>Xshell登录流程： <a href="https://jingyan.baidu.com/article/624e7459032b4334e8ba5a33.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/624e7459032b4334e8ba5a33.html</a> </p>
<p>登录后输出如下所示。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Connecting to 192.168.30.18:22...</span><br><span class="line">Connection established.</span><br><span class="line">To escape to local shell, press 'Ctrl+Alt+]'.</span><br><span class="line">Last login: Sun Sep 27 20:31:53 2020 from 192.168.30.200</span><br><span class="line">[root@vm1921683018 ~]#</span><br></pre></td></tr></table></figure>

<h3 id="2、使虚拟机可以上网"><a href="#2、使虚拟机可以上网" class="headerlink" title="2、使虚拟机可以上网"></a>2、使虚拟机可以上网</h3><blockquote>
<p>原因：生成的虚拟机（内网）在192.168.30.x网段，无法上网。需要配置一个192.168.1.x网段的的ip地址才能上网。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到网络配置文件所在的路径</span></span><br><span class="line">cd /etc/sysconfig/network-scripts/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 备份文件</span></span><br><span class="line">cp ifcfg-ens160  ifcfg-ens160.bat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内容示例如下所示</span></span><br><span class="line">vim ifcfg-ens160</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启虚拟机使更改生效；重启网络服务总是失败(.........)</span></span><br><span class="line">reboot</span><br><span class="line"><span class="meta">#</span><span class="bash"> 等待片刻从新连接虚拟机</span></span><br><span class="line">ping www.baidu.com</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################配置文件示例</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###################################################</span></span></span><br><span class="line">HWADDR=00:50:56:B8:D7:DC</span><br><span class="line">NAME=ens160</span><br><span class="line">GATEWAY=192.168.1.1			# 网关需要改为192.168.1.1</span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line">DNS2=114.114.114.114</span><br><span class="line">DEVICE=ens160</span><br><span class="line">ONBOOT=yes</span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">IPADDR=192.168.30.18</span><br><span class="line">PEERDNS=no</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注销结束的标志</span></span><br><span class="line"><span class="meta">#</span><span class="bash">NM: <span class="function"><span class="title">check_link_down</span></span>() &#123;	</span></span><br><span class="line"><span class="meta">#</span><span class="bash">NM:  <span class="built_in">return</span> 1; </span></span><br><span class="line"><span class="meta">#</span><span class="bash">NM: &#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加新的IP地址192.168.1.x</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">PREFIX=24</span><br><span class="line">IPADDR1=192.168.1.123</span><br><span class="line">PREFIX1=24</span><br><span class="line">NETMASK1=255.255.255.0</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=no</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#################################################</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3、防火墙"><a href="#3、防火墙" class="headerlink" title="3、防火墙"></a>3、防火墙</h3><p>关闭防火墙</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：</p>
<p>1)设置防火墙</p>
<p><code>firewall-cmd --zone=public --permanent --add-port=5984/tcp --add-port=7050/tcp --add-port=7051/tcp --add-port=7052/tcp --add-port=7053/tcp --add-port=7054/tcp --add-port=8053/tcp --add-port=9053/tcp --add-port=10053/tcp</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168302 ~]# firewall-cmd --zone=public --permanent --add-port=5984/tcp --add-port=7050/tcp --add-port=7051/tcp --add-port=7052/tcp --add-port=7053/tcp --add-port=7054/tcp --add-port=8053/tcp --add-port=9053/tcp --add-port=10053/tcp</span><br><span class="line">success</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>

<p>2)重新载入</p>
<p><code>firewall-cmd --reload</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[root@vm192168302 ~]<span class="comment"># firewall-cmd --reload </span></span></span><br><span class="line">success</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>

<p>3)查看开放的端口</p>
<p> <code>firewall-cmd --zone=public --list-ports</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[root@vm192168302 ~]<span class="comment"># firewall-cmd --zone=public --list-ports </span></span></span><br><span class="line">5984/tcp 7050/tcp 7051/tcp 7052/tcp 7053/tcp 7054/tcp 8053/tcp 9053/tcp 10053/tcp</span><br><span class="line">[root@vm192168302 ~]# </span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4、设置Selinux"><a href="#4、设置Selinux" class="headerlink" title="4、设置Selinux"></a>4、设置Selinux</h3><blockquote>
<p> SELinux(Security-Enhanced Linux) 是美国国家安全局（NSA）对于强制访问控制的实现，是 Linux历史上最杰出的新安全子系统。NSA是在Linux社区的帮助下开发了一种访问控制体系，在这种访问控制体系的限制下，进程只能访问那些在他的任务中所需要文件。SELinux 默认安装在 Fedora 和 Red Hat Enterprise Linux 上，也可以作为其他发行版上容易安装的包得到。 </p>
<p> 博客上都这么做，暂时不清楚为啥做。理解上就是关闭了这样个安全子系统。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过命令获取状态 </span></span><br><span class="line">getenforce </span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令行设置selinux，enforcing,permissive 或者 1,0。 </span></span><br><span class="line">etenforce 0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看selinux的信息 </span></span><br><span class="line">sestatus -v </span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑配置 </span></span><br><span class="line">vi /etc/selinux/config</span><br><span class="line"><span class="meta">#</span><span class="bash">将配置中的 SELINUX=enforcing 改为 SELINUX=disabled</span></span><br></pre></td></tr></table></figure>

<h3 id="5、设置时间同步"><a href="#5、设置时间同步" class="headerlink" title="5、设置时间同步"></a>5、设置时间同步</h3><blockquote>
<p>进行时间同步</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 移除本地时间</span></span><br><span class="line">rm -rf /etc/localtime</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改时区</span></span><br><span class="line">ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置系统时钟</span></span><br><span class="line">echo "ZONE="Asia/Shanghai"</span><br><span class="line">UTC=false</span><br><span class="line">ARC=false"&gt;&gt;/etc/sysconfig/clock</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装时间服务</span></span><br><span class="line">yum install -y ntp</span><br><span class="line">systemctl start ntpd</span><br><span class="line">systemctl enable ntpd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 时间同步指向阿里云时间服务器</span></span><br><span class="line">echo "/usr/sbin/ntpdate ntp1.aliyun.com &gt; /dev/null 2&gt;&amp;1; /sbin/hwclock -w"&gt;&gt;/etc/rc.d/rc.local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 定时任务，每分钟同步一次</span></span><br><span class="line">echo "0 */1 * * * ntpdate ntp1.aliyun.com &gt; /dev/null 2&gt;&amp;1; /sbin/hwclock -w"&gt;&gt;/etc/cro</span><br></pre></td></tr></table></figure>

<h3 id="6、安装常用工具"><a href="#6、安装常用工具" class="headerlink" title="6、安装常用工具"></a>6、安装常用工具</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y curl \</span><br><span class="line">wget \</span><br><span class="line">tree \</span><br><span class="line">lrzsz \</span><br><span class="line">dos2unix \</span><br><span class="line">git</span><br></pre></td></tr></table></figure>

<h3 id="7、更换软件源"><a href="#7、更换软件源" class="headerlink" title="7、更换软件源"></a>7、更换软件源</h3><blockquote>
<p>提升相关软件包下载速度</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用网易的镜像源</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 源存储目录</span></span><br><span class="line">cd /etc/yum.repos.d/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改名称进行备份</span></span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.ori</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载文件</span></span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改名称</span></span><br><span class="line">mv CentOS6-Base-163.repo CentOS-Base.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 清空缓存</span></span><br><span class="line">yum -y clean all</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新 </span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h3 id="8、更改hosts文件"><a href="#8、更改hosts文件" class="headerlink" title="8、更改hosts文件"></a>8、更改hosts文件</h3><blockquote>
<p>默认域名IP的对应关系。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.30.2 orderer0.example.com</span><br><span class="line">192.168.30.3 orderer1.example.com</span><br><span class="line">192.168.30.4 orderer2.example.com</span><br><span class="line">192.168.30.5 peer0.org1.example.com</span><br><span class="line">192.168.30.6 peer1.org1.example.com</span><br><span class="line">192.168.30.7 peer0.org2.example.com</span><br><span class="line">192.168.30.8 peer1.org2.example.com</span><br></pre></td></tr></table></figure>

<h2 id="（二）Fabric基础环境配置"><a href="#（二）Fabric基础环境配置" class="headerlink" title="（二）Fabric基础环境配置"></a>（二）Fabric基础环境配置</h2><blockquote>
<p>我们做了一个基础环境包，按照基础环境包进行讲解。</p>
<p>基础环境包目录如下：</p>
<p>每个子目录下的readme.txt文件中都写入有：</p>
<p>（1）该文件夹下文件的下载路径。</p>
<p>（2）在该文件夹下需要进行的操作。</p>
<p>注：system中的配置在（一）虚拟机基础环境配置中都介绍，不再赘述。</p>
</blockquote>
<blockquote>
<p>这个材料包通过Xftp传输到虚拟机虚拟机的/root目录下。</p>
<p>Xftp下载地址： <a href="https://www.netsarang.com/zh/xshell/" target="_blank" rel="noopener">https://www.netsarang.com/zh/xshell/</a> </p>
<p>Xftp登录流程： <a href="https://jingyan.baidu.com/article/19020a0a64d941529c284279.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/19020a0a64d941529c284279.html</a> </p>
</blockquote>
<h3 id="1、go"><a href="#1、go" class="headerlink" title="1、go"></a>1、go</h3><blockquote>
<p>Fabric代码是go写的，需要go环境才能运行。</p>
</blockquote>
<p>GO安装包下载路径：<a href="https://studygolang.com/dl/golang/go1.11.linux-amd64.tar.gz" target="_blank" rel="noopener">https://studygolang.com/dl/golang/go1.11.linux-amd64.tar.gz</a></p>
<p>命令行切换到go目录下：<code>cd /root/fabric-tools/go</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">https://studygolang.com/dl/golang/go1.11.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到安装包到/usr/<span class="built_in">local</span></span></span><br><span class="line">tar -C /usr/local -xzf go1.13.linux-amd64.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开/etc/profile</span></span><br><span class="line">sudo vim /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加下列内容</span></span><br><span class="line">export  PATH=$PATH:/usr/local/go/bin</span><br><span class="line">export  GOROOT=/usr/local/go</span><br><span class="line">export  GOPATH=$HOME/go</span><br><span class="line">export  PATH=$PATH:$HOME/go/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新/etc/profile</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看go版本</span></span><br><span class="line">go version</span><br></pre></td></tr></table></figure>

<h3 id="2、docker-ce"><a href="#2、docker-ce" class="headerlink" title="2、docker-ce"></a>2、docker-ce</h3><blockquote>
<p>安装社区版dokcer。</p>
</blockquote>
<p>docker-ce安装包下载路径：<a href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</a></p>
<p>命令行切换到docker-ce目录下：<code>cd /root/fabric-tools/docker-ce</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###############(1)在线安装</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清理旧版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">             docker-client \</span><br><span class="line">             docker-client-latest \</span><br><span class="line">             docker-common \</span><br><span class="line">             docker-latest \</span><br><span class="line">             docker-latest-logrotate \</span><br><span class="line">             docker-logrotate \</span><br><span class="line">             docker-selinux \</span><br><span class="line">             docker-engine-selinux \</span><br><span class="line">             docker-engine</span><br><span class="line">rm -rf /var/lib/docker/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装相关依赖</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定镜像为阿里云</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装docker-ce</span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动docker-ce</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看docker版本</span></span><br><span class="line">docker --version</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置开机启动</span></span><br><span class="line">chkconfig docker on</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############(2)离线安装</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清理旧版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">             docker-client \</span><br><span class="line">             docker-client-latest \</span><br><span class="line">             docker-common \</span><br><span class="line">             docker-latest \</span><br><span class="line">             docker-latest-logrotate \</span><br><span class="line">             docker-logrotate \</span><br><span class="line">             docker-selinux \</span><br><span class="line">             docker-engine-selinux \</span><br><span class="line">             docker-engine</span><br><span class="line">rm -rf /var/lib/docker/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 强制组成docker的相关软件</span></span><br><span class="line">rpm -ivh containerd.io-1.2.6-3.3.el7.x86_64.rpm --force --nodeps</span><br><span class="line">rpm -ivh container-selinux-2.119.2-1.911c772.el7_8.noarch.rpm --force --nodeps</span><br><span class="line">rpm -ivh docker-ce-19.03.9-3.el7.x86_64.rpm --force --nodeps</span><br><span class="line">rpm -ivh docker-ce-cli-19.03.9-3.el7.x86_64.rpm --force --nodeps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动docker-ce</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看docker版本</span></span><br><span class="line">docker --version</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置开机启动</span></span><br><span class="line">chkconfig docker on</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#######################################################</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3、docker-compose"><a href="#3、docker-compose" class="headerlink" title="3、docker-compose"></a>3、docker-compose</h3><blockquote>
<p>docker镜像管理工具。</p>
</blockquote>
<p>docker-compose安装包下载路径：<a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">https://github.com/docker/compose/releases</a></p>
<p>命令行切换到docker-compose目录下：<code>cd /root/fabric-tools/docker-compose</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/docker/compose/releases</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 赋予docker-compose可执行</span></span><br><span class="line">chmod 777 docker-compose-Linux-x86_64</span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制到/usr/<span class="built_in">local</span>/bin</span></span><br><span class="line">sudo cp docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看版本</span></span><br><span class="line">docker-compose -v</span><br></pre></td></tr></table></figure>

<h3 id="4、bin"><a href="#4、bin" class="headerlink" title="4、bin"></a>4、bin</h3><blockquote>
<p>Fabric可执行二进制文件。</p>
</blockquote>
<p>命令行切换到bin目录下：<code>cd /root/fabric-tools/bin</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置当前目录下文件可读可写可执行</span></span><br><span class="line">chmod 777 -R ./*</span><br><span class="line"><span class="meta">#</span><span class="bash"> 移动到/usr/<span class="built_in">local</span>/bin</span></span><br><span class="line">cp ./* /usr/local/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看二进制文件版本</span></span><br><span class="line">peer version</span><br></pre></td></tr></table></figure>

<h3 id="5、images"><a href="#5、images" class="headerlink" title="5、images"></a>5、images</h3><blockquote>
<p>Fabric镜像。</p>
</blockquote>
<blockquote>
<p>fabric-tools是本地客户端镜像，主要用来执行peer节点中的相关操作，如频道、智能合约等。</p>
<p>fabric-peer是fabric中网络节点的镜像。peer节点会对客户端提交的数据进行提交前的验证和背书。</p>
<p>fabric-orderer是fabric中网络节点的镜像。orderer节点会对客户单提交的数据进行校验、打包和分发。</p>
<p>fabric-ccenv是chaincode的运行环境。</p>
<p>fabric-baseos是chaincode编译环境里的一个os的基础 。</p>
<p>fabric-couchdb是第三方可插拔式数据库镜像。</p>
<p>fabric-kafka是供分布式基于发布/订阅的消息系统的镜像。</p>
<p>fabric-zookeeper提供高可用、高性能且一致的开源协调服务 。</p>
<blockquote>
<p>注：1.4.0拉取的镜像中不包含fabric-ca。fabric-ca是服务器本地CA Server，可以执行fabric-ca-client中的相关操作，实现登录、注册以及注销等操作。在非自定义CA服务的情况下，可以不下载该镜像。</p>
</blockquote>
</blockquote>
<p>docker镜像下载地址：<a href="https://hub.docker.com/t/hyperledger" target="_blank" rel="noopener">https://hub.docker.com/t/hyperledger</a></p>
<p>命令行切换到images目录下：<code>cd /root/fabric-tools/images</code></p>
<p>按readme.txt中的进行迁移操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line">打包</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打包镜像</span></span><br><span class="line">docker save 18ed4db0cd57&gt; /home/cups/images/fabric-tools-1.4.3.tar</span><br><span class="line">docker save c18a0d3cc958&gt; /home/cups/images/fabric-ca-1.4.3.tar</span><br><span class="line">docker save 3d31661a812a&gt; /home/cups/images/fabric-ccenv-1.4.3.tar</span><br><span class="line">docker save b666a6ebbe09&gt; /home/cups/images/fabric-orderer-1.4.3.tar</span><br><span class="line">docker save fa87ccaed0ef&gt; /home/cups/images/fabric-peer-1.4.3.tar</span><br><span class="line">docker save 20c6045930c8&gt; /home/cups/images/fabric-zookeeper-0.4.15.tar</span><br><span class="line">docker save b4ab82bbaf2f&gt; /home/cups/images/fabric-kafka-0.4.15.tar</span><br><span class="line">docker save 8de128a55539&gt; /home/cups/images/fabric-couchdb-0.4.15.tar</span><br><span class="line">docker save 9d6ec11c60ff&gt; /home/cups/images/fabric-baseos-amd64-0.4.15.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line">迁移</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载+标记</span></span><br><span class="line">docker load &lt; fabric-tools-1.4.3.tar</span><br><span class="line">docker tag 18ed4db0cd57 hyperledger/fabric-tools:latest</span><br><span class="line">docker load &lt; fabric-ca-1.4.3.tar</span><br><span class="line">docker tag c18a0d3cc958 hyperledger/fabric-ca:latest</span><br><span class="line">docker load &lt; fabric-ccenv-1.4.3.tar</span><br><span class="line">docker tag 3d31661a812a hyperledger/fabric-ccenv:latest</span><br><span class="line">docker load &lt; fabric-orderer-1.4.3.tar</span><br><span class="line">docker tag b666a6ebbe09 hyperledger/fabric-orderer:latest</span><br><span class="line">docker load &lt; fabric-peer-1.4.3.tar</span><br><span class="line">docker tag fa87ccaed0ef hyperledger/fabric-peer:latest</span><br><span class="line">docker load &lt; fabric-zookeeper-0.4.15.tar</span><br><span class="line">docker tag 20c6045930c8 hyperledger/fabric-zookeeper:latest</span><br><span class="line">docker load &lt; fabric-kafka-0.4.15.tar</span><br><span class="line">docker tag b4ab82bbaf2f hyperledger/fabric-kafka:latest</span><br><span class="line">docker load &lt; fabric-couchdb-0.4.15.tar</span><br><span class="line">docker tag 8de128a55539 hyperledger/fabric-couchdb:latest</span><br><span class="line">docker load &lt; fabric-baseos-amd64-0.4.15.tar</span><br><span class="line">docker tag 9d6ec11c60ff hyperledger/fabric-baseos-amd64-0.4.15:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h3 id="6、fabric-samples"><a href="#6、fabric-samples" class="headerlink" title="6、fabric-samples"></a>6、fabric-samples</h3><blockquote>
<p>fabric示例代码，其中的first-network非常适合于测试Fabric基础环境是否配置完整。</p>
</blockquote>
<p>下载地址： <a href="https://github.com/hyperledger/fabric-samples" target="_blank" rel="noopener">https://github.com/hyperledger/fabric-samples</a> </p>
<p>命令行切换到fabric-samples目录下：<code>cd /root/fabric-tools/fabric-samples</code></p>
<p>进入first-network：<code>cd first-network</code></p>
<p>为目录下文件赋予可读可写可执行权限：<code>chmod 777 -R ./*</code></p>
<p>执行./byfn.sh启动示例网络：<code>./byfn.sh up</code></p>
<p>成功出现END表示Fabric基础环境没有问题。</p>
<p>执行./byfn关闭示例网络：<code>./byfn.sh down</code></p>
<h3 id="7、nodejs"><a href="#7、nodejs" class="headerlink" title="7、nodejs*"></a>7、nodejs*</h3><blockquote>
<p>nodejs是fabric-node-sdk的运行环境。fabric-node-sdk支持的nodejs版本为8.x.x到10.x.x。</p>
<p>该软件看情况而定，不一定需要装。</p>
</blockquote>
<p>nodejs安装包下载路径：<a href="https://nodejs.org/dist/v10.15.0/" target="_blank" rel="noopener">https://nodejs.org/dist/v10.15.0/</a></p>
<p>命令行切换到nodejs目录下：<code>cd /root/fabric-tools/nodejs</code></p>
<p>按readme.txt中的提示进行操作即可。readme.txt内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 解压</span><br><span class="line">tar -C /usr/local -xzf node-v10.15.0-linux-x64.tar.gz</span><br><span class="line">// 重命名</span><br><span class="line">cd /usr/local</span><br><span class="line">mv node-v10.15.0-linux-x64.tar.gz nodejs</span><br><span class="line">// 回到根目录</span><br><span class="line">cd ~</span><br><span class="line">// 打开环境变量配置文件</span><br><span class="line">sudo vim /ect/profile</span><br><span class="line">// 写入</span><br><span class="line">export PATH=$PATH:/usr/local/nodejs/bin</span><br><span class="line">// 更新</span><br><span class="line">source /etc/profile</span><br><span class="line">// 查看版本</span><br><span class="line">node -v</span><br></pre></td></tr></table></figure>

<h1 id="Fabric相关操作"><a href="#Fabric相关操作" class="headerlink" title="Fabric相关操作"></a>Fabric相关操作</h1><h2 id="（一）准备相关文件"><a href="#（一）准备相关文件" class="headerlink" title="（一）准备相关文件"></a>（一）准备相关文件</h2><h3 id="1、crypto-config-yaml"><a href="#1、crypto-config-yaml" class="headerlink" title="1、crypto-config.yaml"></a>1、crypto-config.yaml</h3><blockquote>
<p>供cryptogen模块解释执行生成相关证书。</p>
<p>这些证书一部分用以网络节点的启动，另一部分用作客户端证书。</p>
<p> 更多内容请参考： <a href="https://hyperledgercn.github.io/hyperledgerDocs/" target="_blank" rel="noopener">https://hyperledgercn.github.io/hyperledgerDocs/</a> </p>
</blockquote>
<p>建立文件夹kafka用于存储相关文件:<code>mkdir raft</code></p>
<p>进入生成的文件夹：<code>cd raft</code></p>
<p>新建crypto-config.yaml并写入如下内容：<code>vim crypto-config.yaml</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">OrdererOrgs:</span><br><span class="line">  - Name: Orderer</span><br><span class="line">    Domain: example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Specs:</span><br><span class="line">      - Hostname: orderer0</span><br><span class="line">      - Hostname: orderer1</span><br><span class="line">      - Hostname: orderer2</span><br><span class="line"></span><br><span class="line">PeerOrgs:</span><br><span class="line">  - Name: Org1</span><br><span class="line">    Domain: org1.example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br><span class="line"></span><br><span class="line">  - Name: Org2</span><br><span class="line">    Domain: org2.example.com</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">      Country: CN</span><br><span class="line">      Province: HeNan</span><br><span class="line">      Locality: ZhengZhou</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br></pre></td></tr></table></figure>

<h3 id="2、configtx-yaml"><a href="#2、configtx-yaml" class="headerlink" title="2、configtx.yaml"></a>2、configtx.yaml</h3><blockquote>
<p> configtx.yaml是Hyperledger Fabric区块链网络运维工具configtxgen用于生成通道创世块或通道交易的配置文件，configtx.yaml的内容直接决定了所生成的创世区块的内容。 </p>
<p>更多内容请参考： <a href="https://segmentfault.com/a/1190000018990043?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018990043?utm_source=tag-newest</a> </p>
</blockquote>
<p>新建configtx.yaml 并写入如下内容：<code>vim configtx.yaml</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">Organizations:</span><br><span class="line">    - &amp;OrdererOrg</span><br><span class="line">        Name: OrdererOrg</span><br><span class="line">        ID: OrdererMSP</span><br><span class="line">        MSPDir: crypto-config/ordererOrganizations/example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.member')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.member')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('OrdererMSP.admin')"</span><br><span class="line"></span><br><span class="line">    - &amp;Org1</span><br><span class="line">        Name: Org1MSP</span><br><span class="line">        ID: Org1MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org1.example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin', 'Org1MSP.peer', 'Org1MSP.client')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin', 'Org1MSP.client')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.admin')"</span><br><span class="line">            Endorsement:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org1MSP.peer')"</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org1.example.com</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">    - &amp;Org2</span><br><span class="line">        Name: Org2MSP</span><br><span class="line">        ID: Org2MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org2.example.com/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin', 'Org2MSP.peer', 'Org2MSP.client')"</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin', 'Org2MSP.client')"</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.admin')"</span><br><span class="line">            Endorsement:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: "OR('Org2MSP.peer')"</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org2.example.com</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">Capabilities:</span><br><span class="line">    Channel: &amp;ChannelCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line">    Orderer: &amp;OrdererCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line">    Application: &amp;ApplicationCapabilities</span><br><span class="line">        V2_0: true</span><br><span class="line"></span><br><span class="line">Application: &amp;ApplicationDefaults</span><br><span class="line">    Organizations:</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">        LifecycleEndorsement:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Endorsement"</span><br><span class="line">        Endorsement:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Endorsement"</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ApplicationCapabilities</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Orderer: &amp;OrdererDefaults</span><br><span class="line">    OrdererType: etcdraft</span><br><span class="line">    Addresses:</span><br><span class="line">        - orderer0.example.com:7050</span><br><span class="line">        - orderer1.example.com:7050</span><br><span class="line">        - orderer2.example.com:7050</span><br><span class="line">    BatchTimeout: 2s</span><br><span class="line">    BatchSize:</span><br><span class="line">        MaxMessageCount: 10</span><br><span class="line">        AbsoluteMaxBytes: 99 MB</span><br><span class="line">        PreferredMaxBytes: 512 KB</span><br><span class="line">    Kafka:</span><br><span class="line">        Brokers:</span><br><span class="line">            - 127.0.0.1:9092</span><br><span class="line">    EtcdRaft:</span><br><span class="line">        Consenters:</span><br><span class="line">            - Host: orderer0.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt</span><br><span class="line">            - Host: orderer1.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt</span><br><span class="line">            - Host: orderer2.example.com</span><br><span class="line">              Port: 7050</span><br><span class="line">              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><span class="line">              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt</span><br><span class="line">    Organizations:</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">        BlockValidation:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Channel: &amp;ChannelDefaults</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Readers"</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "ANY Writers"</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: "MAJORITY Admins"</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ChannelCapabilities</span><br><span class="line"></span><br><span class="line">Profiles:</span><br><span class="line"></span><br><span class="line">    TwoOrgsOrdererGenesis:</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Orderer:</span><br><span class="line">            &lt;&lt;: *OrdererDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *OrdererOrg</span><br><span class="line">            Capabilities:</span><br><span class="line">                &lt;&lt;: *OrdererCapabilities</span><br><span class="line">        Consortiums:</span><br><span class="line">            SampleConsortium:</span><br><span class="line">                Organizations:</span><br><span class="line">                    - *Org1</span><br><span class="line">                    - *Org2</span><br><span class="line">    TwoOrgsChannel:</span><br><span class="line">        Consortium: SampleConsortium</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Application:</span><br><span class="line">            &lt;&lt;: *ApplicationDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *Org1</span><br><span class="line">                - *Org2</span><br><span class="line">            Capabilities:</span><br><span class="line">                &lt;&lt;: *ApplicationCapabilities</span><br></pre></td></tr></table></figure>

<h3 id="3、生成公私钥和证书"><a href="#3、生成公私钥和证书" class="headerlink" title="3、生成公私钥和证书"></a>3、生成公私钥和证书</h3><blockquote>
<p>生成公私钥以及证书。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptogen generate --config=./crypto-config.yaml</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4、生成创世区块"><a href="#4、生成创世区块" class="headerlink" title="4、生成创世区块"></a>4、生成创世区块</h3><blockquote>
<p>创世区块中包含有网络信息。</p>
<p><strong>有区别：-channelID system</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir channel-artifacts</span><br><span class="line">configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block -channelID system</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="5、生成通道配置区块"><a href="#5、生成通道配置区块" class="headerlink" title="5、生成通道配置区块"></a>5、生成通道配置区块</h3><blockquote>
<p>通道文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/mychannel.tx -channelID mychannel</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6、智能合约"><a href="#6、智能合约" class="headerlink" title="6、智能合约"></a>6、智能合约</h3><blockquote>
<p>在通道内安装的智能合约。</p>
<p>以chaincode_example02.go为例。</p>
</blockquote>
<p>智能合约代码如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	"errors"</span><br><span class="line">	"fmt"</span><br><span class="line">	"strconv"</span><br><span class="line"></span><br><span class="line">	"github.com/hyperledger/fabric-contract-api-go/contractapi"</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// ABstore Chaincode implementation</span><br><span class="line">type ABstore struct &#123;</span><br><span class="line">	contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (t *ABstore) Init(ctx contractapi.TransactionContextInterface, A string, Aval int, B string, Bval int) error &#123;</span><br><span class="line">	fmt.Println("ABstore Init")</span><br><span class="line">	var err error</span><br><span class="line">	// Initialize the chaincode</span><br><span class="line">	fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval)</span><br><span class="line">	// Write the state to the ledger</span><br><span class="line">	err = ctx.GetStub().PutState(A, []byte(strconv.Itoa(Aval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ctx.GetStub().PutState(B, []byte(strconv.Itoa(Bval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Transaction makes payment of X units from A to B</span><br><span class="line">func (t *ABstore) Invoke(ctx contractapi.TransactionContextInterface, A, B string, X int) error &#123;</span><br><span class="line">	var err error</span><br><span class="line">	var Aval int</span><br><span class="line">	var Bval int</span><br><span class="line">	// Get the state from the ledger</span><br><span class="line">	// TODO: will be nice to have a GetAllState call to ledger</span><br><span class="line">	Avalbytes, err := ctx.GetStub().GetState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to get state")</span><br><span class="line">	&#125;</span><br><span class="line">	if Avalbytes == nil &#123;</span><br><span class="line">		return fmt.Errorf("Entity not found")</span><br><span class="line">	&#125;</span><br><span class="line">	Aval, _ = strconv.Atoi(string(Avalbytes))</span><br><span class="line"></span><br><span class="line">	Bvalbytes, err := ctx.GetStub().GetState(B)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to get state")</span><br><span class="line">	&#125;</span><br><span class="line">	if Bvalbytes == nil &#123;</span><br><span class="line">		return fmt.Errorf("Entity not found")</span><br><span class="line">	&#125;</span><br><span class="line">	Bval, _ = strconv.Atoi(string(Bvalbytes))</span><br><span class="line"></span><br><span class="line">	// Perform the execution</span><br><span class="line">	Aval = Aval - X</span><br><span class="line">	Bval = Bval + X</span><br><span class="line">	fmt.Printf("Aval = %d, Bval = %d\n", Aval, Bval)</span><br><span class="line"></span><br><span class="line">	// Write the state back to the ledger</span><br><span class="line">	err = ctx.GetStub().PutState(A, []byte(strconv.Itoa(Aval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = ctx.GetStub().PutState(B, []byte(strconv.Itoa(Bval)))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Delete  an entity from state</span><br><span class="line">func (t *ABstore) Delete(ctx contractapi.TransactionContextInterface, A string) error &#123;</span><br><span class="line"></span><br><span class="line">	// Delete the key from the state in ledger</span><br><span class="line">	err := ctx.GetStub().DelState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return fmt.Errorf("Failed to delete state")</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Query callback representing the query of a chaincode</span><br><span class="line">func (t *ABstore) Query(ctx contractapi.TransactionContextInterface, A string) (string, error) &#123;</span><br><span class="line">	var err error</span><br><span class="line">	// Get the state from the ledger</span><br><span class="line">	Avalbytes, err := ctx.GetStub().GetState(A)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		jsonResp := "&#123;\"Error\":\"Failed to get state for " + A + "\"&#125;"</span><br><span class="line">		return "", errors.New(jsonResp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if Avalbytes == nil &#123;</span><br><span class="line">		jsonResp := "&#123;\"Error\":\"Nil amount for " + A + "\"&#125;"</span><br><span class="line">		return "", errors.New(jsonResp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jsonResp := "&#123;\"Name\":\"" + A + "\",\"Amount\":\"" + string(Avalbytes) + "\"&#125;"</span><br><span class="line">	fmt.Printf("Query Response:%s\n", jsonResp)</span><br><span class="line">	return string(Avalbytes), nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	cc, err := contractapi.NewChaincode(new(ABstore))</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	if err := cc.Start(); err != nil &#123;</span><br><span class="line">		fmt.Printf("Error starting ABstore chaincode: %s", err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、docker-compose-orderer-yaml"><a href="#7、docker-compose-orderer-yaml" class="headerlink" title="7、docker-compose-orderer.yaml"></a>7、docker-compose-orderer.yaml</h3><blockquote>
<p>启动orderer节点的配置文件。</p>
<p>docker-compose-orderer0.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.18</p>
<p>docker-compose-orderer1.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.19</p>
<p>docker-compose-orderer2.yaml  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.20</p>
</blockquote>
<p><code>docker-compose-orderer0.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer0.example.com:</span><br><span class="line">    container_name: orderer0.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-orderer1.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer1.example.com:</span><br><span class="line">    container_name: orderer1.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-orderer2.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  orderer2.example.com:</span><br><span class="line">    container_name: orderer2.example.com</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">      - ORDERER_KAFKA_TOPIC_REPLICATIONFACTOR=1</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_CLUSTER_ROOTCAS=/var/hyperledger/orderer/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">      - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/genesis.block</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/msp:/var/hyperledger/orderer/msp</span><br><span class="line">      - ./crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br></pre></td></tr></table></figure>

<h3 id="10、docker-compose-peer-yaml"><a href="#10、docker-compose-peer-yaml" class="headerlink" title="10、docker-compose-peer.yaml"></a>10、docker-compose-peer.yaml</h3><blockquote>
<p>启动peer节点的配置文件。</p>
<p>docker-compose-peer01.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.21</p>
<p>docker-compose-peer11.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.22</p>
<p>docker-compose-peer02.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.23</p>
<p>docker-compose-peer12.yaml&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;192.168.30.24</p>
</blockquote>
<p><code>docker-compose-peer01.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer0.org1.example.com:</span><br><span class="line">    container_name: peer0.org1.example.com</span><br><span class="line">    hostname: peer0.org1.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer0.org1.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer11.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer1.org1.example.com:</span><br><span class="line">    container_name: peer1.org1.example.com</span><br><span class="line">    hostname: peer1.org1.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer1.org1.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer1.org1.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer02.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer0.org2.example.com:</span><br><span class="line">    container_name: peer0.org2.example.com</span><br><span class="line">    hostname: peer0.org2.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer0.org2.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<p><code>docker-compose-peer12.yaml</code> 内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">version: '2'</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  peer1.org2.example.com:</span><br><span class="line">    container_name: peer1.org2.example.com</span><br><span class="line">    hostname: peer1.org2.example.com</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">       - CORE_PEER_ID=peer1.org2.example.com</span><br><span class="line">       - CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_CHAINCODELISTENADDRESS=peer1.org2.example.com:7052</span><br><span class="line">       - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com:7051</span><br><span class="line">       - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">       - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">       - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=share_default</span><br><span class="line">       # the following setting starts chaincode containers on the same</span><br><span class="line">       # bridge network as the peers</span><br><span class="line">       # https://docs.docker.com/compose/networking/</span><br><span class="line">       #- CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">       - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">       - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">       - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">       - CORE_PEER_PROFILE_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">       - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">       - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">       - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    volumes:</span><br><span class="line">       - /var/run/:/host/var/run/</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">       - ./crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line"></span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./chaincode:/opt/gopath/src/github.com/hyperledger/fabric/chaincode</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - "orderer0.example.com:192.168.30.2"</span><br><span class="line">      - "orderer1.example.com:192.168.30.3"</span><br><span class="line">      - "orderer2.example.com:192.168.30.4"</span><br><span class="line">      - "peer0.org1.example.com:192.168.30.5"</span><br><span class="line">      - "peer1.org1.example.com:192.168.30.6"</span><br><span class="line">      - "peer0.org2.example.com:192.168.30.7"</span><br><span class="line">      - "peer1.org2.example.com:192.168.30.8"</span><br></pre></td></tr></table></figure>

<h3 id="11、复制文件"><a href="#11、复制文件" class="headerlink" title="11、复制文件"></a>11、复制文件</h3><blockquote>
<p>直接全部复制。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">scp -r raft/ root@192.168.30.3:/root/</span><br><span class="line">...</span><br><span class="line">scp -r raft/ root@192.168.30.9:/root/</span><br></pre></td></tr></table></figure>

<h3 id="12、文件目录"><a href="#12、文件目录" class="headerlink" title="12、文件目录*"></a>12、文件目录*</h3><blockquote>
<p>最终目录结构如下所示。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168302 raft]# tree -L 3</span><br><span class="line">.</span><br><span class="line">├── chaincode</span><br><span class="line">│   └── abstore</span><br><span class="line">│       ├── abstore.go</span><br><span class="line">│       ├── go.mod</span><br><span class="line">│       └── go.sum</span><br><span class="line">├── channel-artifacts</span><br><span class="line">│   ├── genesis.block</span><br><span class="line">│   └── mychannel.tx</span><br><span class="line">├── configtx.yaml</span><br><span class="line">├── crypto-config</span><br><span class="line">│   ├── ordererOrganizations</span><br><span class="line">│   │   └── example.com</span><br><span class="line">│   └── peerOrganizations</span><br><span class="line">│       ├── org1.example.com</span><br><span class="line">│       └── org2.example.com</span><br><span class="line">├── crypto-config.yaml</span><br><span class="line">├── docker-compose-orderer0.yaml</span><br><span class="line">├── docker-compose-orderer1.yaml</span><br><span class="line">├── docker-compose-orderer2.yaml</span><br><span class="line">├── docker-compose-peer01.yaml</span><br><span class="line">├── docker-compose-peer02.yaml</span><br><span class="line">├── docker-compose-peer11.yaml</span><br><span class="line">└── docker-compose-peer12.yaml</span><br><span class="line"></span><br><span class="line">9 directories, 14 files</span><br><span class="line">[root@vm192168302 raft]#</span><br></pre></td></tr></table></figure>

<h2 id="（二）启动网络"><a href="#（二）启动网络" class="headerlink" title="（二）启动网络"></a>（二）启动网络</h2><h3 id="1、orderer节点"><a href="#1、orderer节点" class="headerlink" title="1、orderer节点"></a>1、orderer节点</h3><blockquote>
<p>docker-compose -f docker-compose-orderer0.yaml up -d</p>
<p>docker-compose -f docker-compose-orderer1.yaml up -d</p>
<p>docker-compose -f docker-compose-orderer2.yaml up -d</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.2</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168302 raft]# docker-compose -f docker-compose-orderer0.yaml up -d</span><br><span class="line">Creating network "raft_default" with the default driver</span><br><span class="line">Creating orderer0.example.com ... done</span><br><span class="line">[root@vm192168302 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">abda5bdce50d        hyperledger/fabric-orderer   "orderer"           14 seconds ago      Up 14 seconds       0.0.0.0:7050-&gt;7050/tcp   orderer0.example.com</span><br><span class="line">[root@vm192168302 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.3</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168303 raft]# docker-compose -f docker-compose-orderer1.yaml up -d</span><br><span class="line">Recreating orderer1.example.com ... done</span><br><span class="line">[root@vm192168303 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">536cd9d8a64a        hyperledger/fabric-orderer   "orderer"           15 seconds ago      Up 9 seconds        0.0.0.0:7050-&gt;7050/tcp   orderer1.example.com</span><br><span class="line">[root@vm192168303 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.4</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168304 raft]# docker-compose -f docker-compose-orderer2.yaml up -d</span><br><span class="line">Creating orderer2.example.com ... done</span><br><span class="line">[root@vm192168304 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">6b5d1db775e2        hyperledger/fabric-orderer   "orderer"           8 seconds ago       Up 7 seconds        0.0.0.0:7050-&gt;7050/tcp   orderer2.example.com</span><br><span class="line">[root@vm192168304 raft]#</span><br></pre></td></tr></table></figure>

<h3 id="2、peer节点"><a href="#2、peer节点" class="headerlink" title="2、peer节点"></a>2、peer节点</h3><blockquote>
<p>docker-compose -f docker-compose-peer01.yaml up -d</p>
<p>docker-compose -f docker-compose-peer11.yaml up -d</p>
<p>docker-compose -f docker-compose-peer02.yaml up -d</p>
<p>docker-compose -f docker-compose-peer12.yaml up -d</p>
<blockquote>
<p>启动peer节点和后面的加入通道、打包链码、安装链码是可以做到一块的，而且呢样对于操作来说更顺畅。之所以把这几块分开，是因为2.0的链码操作有点迷（让人疑惑）且复杂，各部分分开来做容易理解且不容易出错。</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168305 raft]# docker-compose -f docker-compose-peer01.yaml up -d</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">[root@vm192168305 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">b57883b993ca        hyperledger/fabric-tools   "/bin/sh"           12 minutes ago      Up 12 minutes                                          cli</span><br><span class="line">003fd775dc2b        hyperledger/fabric-peer    "peer node start"   12 minutes ago      Up 12 minutes       0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org1.example.com</span><br><span class="line">[root@vm192168305 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168306 raft]# docker-compose -f docker-compose-peer02.yaml up -d</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">[root@vm192168306 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">679ad519dec1        hyperledger/fabric-tools   "/bin/sh"           4 minutes ago       Up 4 minutes                                           cli</span><br><span class="line">94760cadc526        hyperledger/fabric-peer    "peer node start"   4 minutes ago       Up 4 minutes        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org2.example.com</span><br><span class="line">[root@vm192168306 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168307 raft]# docker-compose -f docker-compose-peer02.yaml up -d</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">[root@vm192168307 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">5c7e8c6dbc8a        hyperledger/fabric-peer    "peer node start"   4 seconds ago       Up 3 seconds        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer0.org2.example.com</span><br><span class="line">2d412e5672b2        hyperledger/fabric-tools   "/bin/sh"           4 seconds ago       Up 3 seconds                                           cli</span><br><span class="line">[root@vm192168307 raft]# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.8</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">[root@vm192168308 raft]# docker-compose -f docker-compose-peer12.yaml up -d</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">Creating peer1.org2.example.com ... done</span><br><span class="line">[root@vm192168308 raft]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND             CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">d9bcf06e2640        hyperledger/fabric-peer    "peer node start"   4 seconds ago       Up 2 seconds        0.0.0.0:7051-7053-&gt;7051-7053/tcp   peer1.org2.example.com</span><br><span class="line">2e537f7b6659        hyperledger/fabric-tools   "/bin/sh"           4 seconds ago       Up 2 seconds                                           cli</span><br><span class="line">[root@vm192168308 raft]#</span><br></pre></td></tr></table></figure>

<h3 id="3、通道"><a href="#3、通道" class="headerlink" title="3、通道"></a>3、通道</h3><blockquote>
<p>peer01-192.168.30.5==========================&gt;创建通道、加入通道、将通道文件传输给其他节点</p>
<p>peer11-192.168.30.6==========================&gt;加入通道</p>
<p>peer02-192.168.30.7==========================&gt;加入通道</p>
<p>peer12-192.168.30.8==========================&gt;加入通道</p>
<blockquote>
<p>之所以把通道放到网络里边，是因为通道加入的完成标志着网络起来了。</p>
<p>为什么这样说呢？就是加入通道后，各节点创建账本，剩下的是智能合约部分。</p>
<p>值得为它分一个节。</p>
</blockquote>
<h3 id="（1）peer01-192-168-30-5"><a href="#（1）peer01-192-168-30-5" class="headerlink" title="（1）peer01-192.168.30.5"></a>（1）peer01-192.168.30.5</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############创建并加入通道</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建通道</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer channel create -o orderer0.example.com:7050 -c mychannel -f ./channel-artifacts/mychannel.tx --tls --cafile $ORDERER_CA </span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入通道</span></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############复制文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从镜像复制到本地</span></span><br><span class="line">docker cp cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block ./</span><br><span class="line"><span class="meta">#</span><span class="bash"> 传输给另外3台peer</span></span><br><span class="line">scp ./mychannel.block root@192.168.30.6:/root/raft</span><br><span class="line">scp ./mychannel.block root@192.168.30.7:/root/raft</span><br><span class="line">scp ./mychannel.block root@192.168.30.8:/root/raft</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168305 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer channel create -o orderer0.example.com:7050 -c mychannel -f ./channel-artifacts/mychannel.tx --tls --cafile $ORDERER_CA </span><br><span class="line">2020-10-02 08:19:53.937 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:19:53.940 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:19:53.947 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:53.982 UTC [cli.common] readBlock -&gt; INFO 004 Expect block, but got status: &amp;&#123;NOT_FOUND&#125;</span><br><span class="line">2020-10-02 08:19:53.988 UTC [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:54.189 UTC [cli.common] readBlock -&gt; INFO 006 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-10-02 08:19:54.195 UTC [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:54.396 UTC [cli.common] readBlock -&gt; INFO 008 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-10-02 08:19:54.405 UTC [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:54.607 UTC [cli.common] readBlock -&gt; INFO 00a Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-10-02 08:19:54.613 UTC [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:54.815 UTC [cli.common] readBlock -&gt; INFO 00c Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-10-02 08:19:54.821 UTC [channelCmd] InitCmdFactory -&gt; INFO 00d Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:55.022 UTC [cli.common] readBlock -&gt; INFO 00e Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-10-02 08:19:55.028 UTC [channelCmd] InitCmdFactory -&gt; INFO 00f Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:19:55.231 UTC [cli.common] readBlock -&gt; INFO 010 Received block: 0</span><br><span class="line">bash-5.0# peer channel join -b mychannel.block</span><br><span class="line">2020-10-02 08:20:00.843 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:20:00.851 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:20:00.856 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:20:00.888 UTC [channelCmd] executeJoin -&gt; INFO 004 Successfully submitted proposal to join channel</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168305 raft]# docker cp cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/mychannel.block ./</span><br><span class="line">[root@vm192168305 raft]# scp ./mychannel.block root@192.168.30.6:/root/raft</span><br><span class="line">root@192.168.30.6's password: </span><br><span class="line">mychannel.block                                                                                                                                                                                                100%   21KB  10.1MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]# scp ./mychannel.block root@192.168.30.7:/root/raft</span><br><span class="line">root@192.168.30.7's password: </span><br><span class="line">mychannel.block                                                                                                                                                                                                100%   21KB  25.9MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]# scp ./mychannel.block root@192.168.30.8:/root/raft</span><br><span class="line">root@192.168.30.8's password: </span><br><span class="line">mychannel.block                                                                                                                                                                                                100%   21KB  15.5MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]# </span><br></pre></td></tr></table></figure>

<h3 id="（2）peer01-192-168-30-7"><a href="#（2）peer01-192-168-30-7" class="headerlink" title="（2）peer01-192.168.30.7"></a>（2）peer01-192.168.30.7</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############加入通道</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入通道</span></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询已经加入的通道</span></span><br><span class="line">peer channel list</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168306 raft]# docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168306 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer channel join -b mychannel.block</span><br><span class="line">2020-10-02 08:21:10.295 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:10.298 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:10.303 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:21:10.346 UTC [channelCmd] executeJoin -&gt; INFO 004 Successfully submitted proposal to join channel</span><br><span class="line">bash-5.0# peer channel list</span><br><span class="line">2020-10-02 08:21:15.089 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:15.092 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:15.098 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined: </span><br><span class="line">mychannel</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168306 raft]# </span><br></pre></td></tr></table></figure>

<h3 id="（3）peer01-192-168-30-8"><a href="#（3）peer01-192-168-30-8" class="headerlink" title="（3）peer01-192.168.30.8"></a>（3）peer01-192.168.30.8</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############加入通道</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入通道</span></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询已经加入的通道</span></span><br><span class="line">peer channel list</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168307 raft]# docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168307 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer channel join -b mychannel.block</span><br><span class="line">2020-10-02 08:21:40.974 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:40.977 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:40.982 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:21:41.014 UTC [channelCmd] executeJoin -&gt; INFO 004 Successfully submitted proposal to join channel</span><br><span class="line">bash-5.0# peer channel list</span><br><span class="line">2020-10-02 08:21:47.005 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:47.008 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:21:47.012 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined: </span><br><span class="line">mychannel</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168307 raft]# </span><br></pre></td></tr></table></figure>

<h3 id="（4）peer01-192-168-30-9"><a href="#（4）peer01-192-168-30-9" class="headerlink" title="（4）peer01-192.168.30.9"></a>（4）peer01-192.168.30.9</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############加入通道</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入通道</span></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询已经加入的通道</span></span><br><span class="line">peer channel list</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168308 raft]# docker cp /root/raft/mychannel.block cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168308 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer channel join -b mychannel.block</span><br><span class="line">2020-10-02 08:22:19.566 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:22:19.569 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:22:19.574 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-10-02 08:22:19.602 UTC [channelCmd] executeJoin -&gt; INFO 004 Successfully submitted proposal to join channel</span><br><span class="line">bash-5.0# peer channel list</span><br><span class="line">2020-10-02 08:22:24.561 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:22:24.563 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:22:24.568 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined: </span><br><span class="line">mychannel</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168308 raft]# </span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="（三）链码"><a href="#（三）链码" class="headerlink" title="（三）链码"></a>（三）链码</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/raft/chaincode.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="1、打包链码"><a href="#1、打包链码" class="headerlink" title="1、打包链码"></a>1、打包链码</h3><blockquote>
<p>链码的打包在哪个客户端上都行。只要链码内容相同，打包后的package-id也就相同。</p>
<p>很多教程都是在一个节点的客户端上打包安装后发送给其它节点。目的在于确保链码相同，避免出现其他问题。</p>
<p>这部分放在下面与安装链码一块做，操作命令如下。</p>
<blockquote>
<p>2.0中的链码用来和1.0中不一样的接口：1.0中是fabric/core/chaincode/shim，2.0中用的是fabric-contract-api-go/contractapi。</p>
<p>2.0中还需要使用go mod vendor 引入依赖module全部文件，给链码建一个环境使链码从GOPATH的强制依赖中独立出来。1.0中则没有这么多破事。</p>
</blockquote>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############打包链码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到链码目录</span></span><br><span class="line">cd chaincode/abstore</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置GOPROXY、GOSUMDB</span></span><br><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br><span class="line">go env GOSUMDB="sum.golang.google.cn"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载依赖文件</span></span><br><span class="line">go mod vendor</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回到初始目录(/opt/gopath/src/github.com/hyperledger/fabric/peer)</span></span><br><span class="line">cd ..</span><br><span class="line">cd ..</span><br><span class="line"><span class="meta">#</span><span class="bash">打包链码</span></span><br><span class="line">peer lifecycle chaincode package abstore.tar.gz \</span><br><span class="line">--path github.com/hyperledger/fabric/peer/chaincode/abstore \</span><br><span class="line">--lang golang \</span><br><span class="line">--label mycc</span><br></pre></td></tr></table></figure>

<h3 id="2、安装链码"><a href="#2、安装链码" class="headerlink" title="2、安装链码"></a>2、安装链码</h3><blockquote>
<h3 id="（1）peer01-192-168-30-5-1"><a href="#（1）peer01-192-168-30-5-1" class="headerlink" title="（1）peer01-192.168.30.5"></a>（1）peer01-192.168.30.5</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############打包链码并安装</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到链码目录</span></span><br><span class="line">cd chaincode/abstore</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置GOPROXY、GOSUMDB</span></span><br><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br><span class="line">go env GOSUMDB="sum.golang.google.cn"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载依赖文件</span></span><br><span class="line">go mod vendor</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回到初始目录(/opt/gopath/src/github.com/hyperledger/fabric/peer)</span></span><br><span class="line">cd ..</span><br><span class="line">cd ..</span><br><span class="line"><span class="meta">#</span><span class="bash">打包链码</span></span><br><span class="line">peer lifecycle chaincode package abstore.tar.gz \</span><br><span class="line">--path github.com/hyperledger/fabric/peer/chaincode/abstore \</span><br><span class="line">--lang golang \</span><br><span class="line">--label mycc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装链码</span></span><br><span class="line">peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############复制文件</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从镜像复制到本地</span></span><br><span class="line">docker cp cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/abstore.tar.gz ./</span><br><span class="line"><span class="meta">#</span><span class="bash"> 传输给另外3台peer</span></span><br><span class="line">scp ./abstore.tar.gz root@192.168.30.6:/root/raft</span><br><span class="line">scp ./abstore.tar.gz root@192.168.30.7:/root/raft</span><br><span class="line">scp ./abstore.tar.gz root@192.168.30.8:/root/raft</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168305 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# cd chaincode/abstore</span><br><span class="line">bash-5.0# go env -w GOPROXY=https://goproxy.cn,direct</span><br><span class="line">bash-5.0# go env GOSUMDB="sum.golang.google.cn"</span><br><span class="line"></span><br><span class="line">bash-5.0# go mod vendor</span><br><span class="line">go: downloading github.com/hyperledger/fabric-contract-api-go v1.1.0</span><br><span class="line">go: extracting github.com/hyperledger/fabric-contract-api-go v1.1.0</span><br><span class="line">go: downloading github.com/xeipuuv/gojsonschema v1.2.0</span><br><span class="line">go: downloading github.com/go-openapi/spec v0.19.4</span><br><span class="line">go: downloading github.com/hyperledger/fabric-chaincode-go v0.0.0-20200424173110-d7076418f212</span><br><span class="line">go: downloading github.com/hyperledger/fabric-protos-go v0.0.0-20200424173316-dd554ba3746e</span><br><span class="line">go: downloading github.com/gobuffalo/packr v1.30.1</span><br><span class="line">go: downloading github.com/xeipuuv/gojsonschema v1.2.0</span><br><span class="line">go: downloading github.com/hyperledger/fabric-protos-go v0.0.0-20200424173316-dd554ba3746e</span><br><span class="line">go: downloading github.com/hyperledger/fabric-chaincode-go v0.0.0-20200424173110-d7076418f212</span><br><span class="line">go: downloading github.com/go-openapi/spec v0.19.4</span><br><span class="line">go: downloading github.com/gobuffalo/packr v1.30.1</span><br><span class="line">go: extracting github.com/gobuffalo/packr v1.30.1</span><br><span class="line">go: downloading github.com/gobuffalo/packd v0.3.0</span><br><span class="line">go: downloading github.com/gobuffalo/envy v1.7.0</span><br><span class="line">go: extracting github.com/go-openapi/spec v0.19.4</span><br><span class="line">go: downloading github.com/go-openapi/swag v0.19.5</span><br><span class="line">go: downloading github.com/go-openapi/jsonpointer v0.19.3</span><br><span class="line">go: downloading github.com/go-openapi/jsonreference v0.19.2</span><br><span class="line">go: extracting github.com/xeipuuv/gojsonschema v1.2.0</span><br><span class="line">go: downloading github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415</span><br><span class="line">go: extracting github.com/gobuffalo/envy v1.7.0</span><br><span class="line">go: downloading github.com/rogpeppe/go-internal v1.3.0</span><br><span class="line">go: downloading github.com/joho/godotenv v1.3.0</span><br><span class="line">go: extracting github.com/gobuffalo/packd v0.3.0</span><br><span class="line">go: extracting github.com/hyperledger/fabric-chaincode-go v0.0.0-20200424173110-d7076418f212</span><br><span class="line">go: downloading github.com/golang/protobuf v1.3.2</span><br><span class="line">go: extracting github.com/go-openapi/jsonpointer v0.19.3</span><br><span class="line">go: extracting github.com/go-openapi/jsonreference v0.19.2</span><br><span class="line">go: downloading github.com/PuerkitoBio/purell v1.1.1</span><br><span class="line">go: extracting github.com/go-openapi/swag v0.19.5</span><br><span class="line">go: extracting github.com/hyperledger/fabric-protos-go v0.0.0-20200424173316-dd554ba3746e</span><br><span class="line">go: downloading gopkg.in/yaml.v2 v2.2.8</span><br><span class="line">go: downloading google.golang.org/grpc v1.23.0</span><br><span class="line">go: downloading github.com/mailru/easyjson v0.0.0-20190626092158-b2ccc519800e</span><br><span class="line">go: extracting github.com/joho/godotenv v1.3.0</span><br><span class="line">go: extracting github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415</span><br><span class="line">go: extracting github.com/rogpeppe/go-internal v1.3.0</span><br><span class="line">go: extracting github.com/mailru/easyjson v0.0.0-20190626092158-b2ccc519800e</span><br><span class="line">go: downloading github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f</span><br><span class="line">go: extracting github.com/PuerkitoBio/purell v1.1.1</span><br><span class="line">go: downloading golang.org/x/net v0.0.0-20190827160401-ba9fcec4b297</span><br><span class="line">go: extracting gopkg.in/yaml.v2 v2.2.8</span><br><span class="line">go: downloading github.com/PuerkitoBio/urlesc v0.0.0-20170810143723-de5bf2ad4578</span><br><span class="line">go: extracting github.com/golang/protobuf v1.3.2</span><br><span class="line">go: downloading golang.org/x/text v0.3.2</span><br><span class="line">go: extracting github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f</span><br><span class="line">go: extracting github.com/PuerkitoBio/urlesc v0.0.0-20170810143723-de5bf2ad4578</span><br><span class="line">go: extracting golang.org/x/net v0.0.0-20190827160401-ba9fcec4b297</span><br><span class="line">go: downloading google.golang.org/genproto v0.0.0-20180831171423-11092d34479b</span><br><span class="line">go: downloading golang.org/x/sys v0.0.0-20190710143415-6ec70d6a5542</span><br><span class="line">go: extracting golang.org/x/sys v0.0.0-20190710143415-6ec70d6a5542</span><br><span class="line">go: extracting google.golang.org/genproto v0.0.0-20180831171423-11092d34479b</span><br><span class="line">go: extracting golang.org/x/text v0.3.2</span><br><span class="line">bash-5.0# cd ..</span><br><span class="line">bash-5.0# cd ..</span><br><span class="line">bash-5.0# peer lifecycle chaincode package abstore.tar.gz \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --path github.com/hyperledger/fabric/peer/chaincode/abstore \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --lang golang \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --label mycc</span></span><br><span class="line">2020-10-02 08:50:38.069 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:50:38.069 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">bash-5.0# peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line">2020-10-02 08:50:47.521 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:50:47.524 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:50:47.913 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 003 Installed remotely: response:&lt;status:200 payload:"\nEmycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0\022\004mycc" &gt; </span><br><span class="line">2020-10-02 08:50:47.913 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 004 Chaincode code package identifier: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 08:50:55.465 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:50:55.467 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168305 raft]# docker cp cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/abstore.tar.gz ./</span><br><span class="line">[root@vm192168305 raft]# scp ./abstore.tar.gz root@192.168.30.6:/root/raft</span><br><span class="line">root@192.168.30.6's password: </span><br><span class="line">abstore.tar.gz                                                                                                                                                                                                 100% 2327KB  67.0MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]# scp ./abstore.tar.gz root@192.168.30.7:/root/raft</span><br><span class="line">root@192.168.30.7's password: </span><br><span class="line">abstore.tar.gz                                                                                                                                                                                                 100% 2327KB  82.9MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]# scp ./abstore.tar.gz root@192.168.30.8:/root/raft</span><br><span class="line">root@192.168.30.8's password: </span><br><span class="line">abstore.tar.gz                                                                                                                                                                                                 100% 2327KB  80.9MB/s   00:00    </span><br><span class="line">[root@vm192168305 raft]#</span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="（2）peer11-192-168-30-6"><a href="#（2）peer11-192-168-30-6" class="headerlink" title="（2）peer11-192.168.30.6"></a>（2）peer11-192.168.30.6</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############安装链码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装链码</span></span><br><span class="line">peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168306 raft]# docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168306 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line">2020-10-02 08:53:55.505 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:53:55.508 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:53:55.899 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 003 Installed remotely: response:&lt;status:200 payload:"\nEmycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0\022\004mycc" &gt; </span><br><span class="line">2020-10-02 08:53:55.899 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 004 Chaincode code package identifier: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 08:54:00.854 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:54:00.857 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168306 raft]#</span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="（3）peer02-192-168-30-7"><a href="#（3）peer02-192-168-30-7" class="headerlink" title="（3）peer02-192.168.30.7"></a>（3）peer02-192.168.30.7</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############安装链码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装链码</span></span><br><span class="line">peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168306 raft]# docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168306 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line">2020-10-02 08:53:55.505 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:53:55.508 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:53:55.899 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 003 Installed remotely: response:&lt;status:200 payload:"\nEmycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0\022\004mycc" &gt; </span><br><span class="line">2020-10-02 08:53:55.899 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 004 Chaincode code package identifier: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 08:54:00.854 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:54:00.857 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168307 raft]#</span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="（4）peer12-192-168-30-8"><a href="#（4）peer12-192-168-30-8" class="headerlink" title="（4）peer12-192.168.30.8"></a>（4）peer12-192.168.30.8</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############安装链码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器</span></span><br><span class="line">docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装链码</span></span><br><span class="line">peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl+D(退出客户端)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@vm192168308 raft]# docker cp /root/raft/abstore.tar.gz cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/</span><br><span class="line">[root@vm192168308 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer lifecycle chaincode install abstore.tar.gz</span><br><span class="line">2020-10-02 08:55:00.259 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:55:00.263 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:55:00.662 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 003 Installed remotely: response:&lt;status:200 payload:"\nEmycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0\022\004mycc" &gt; </span><br><span class="line">2020-10-02 08:55:00.663 UTC [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 004 Chaincode code package identifier: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 08:55:06.840 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 08:55:06.843 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# exit</span><br><span class="line">[root@vm192168308 raft]#</span><br></pre></td></tr></table></figure>

<h3 id="3、批准链码"><a href="#3、批准链码" class="headerlink" title="3、批准链码"></a>3、批准链码</h3><blockquote>
<p>org1中的任意节点和org2中的任意节点批准链码。</p>
<blockquote>
<p>背书策略： –signature-policy “AND(‘Org1MSP.peer’,’Org2MSP.peer’)”  \</p>
<p>要求交易必须由org1和org2的peer节点签名。</p>
<p>需要注意的是2.0链码的批准只有默认的背书策略（通道内过半组织同意）在会在查询的时候显示如下（org1批准链码）。</p>
<p>{<br>    “approvals”: {<br>        “Org1MSP”: true,<br>        “Org2MSP”: false<br>    }<br>}</p>
<p>其他背书策略都是查不到的，可能以后这个bug会修复，目前就是这样个情况。</p>
<p>只要批准的时候不报错，就默认批准成功了；只要链码能提交上去，就算成功。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询已安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准链码</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">--signature-policy "AND('Org1MSP.peer','Org2MSP.peer')"  \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">--name mycc \</span><br><span class="line">--version 1 \</span><br><span class="line">--init-required \</span><br><span class="line">--package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span><br><span class="line">--sequence 1 \</span><br><span class="line">--waitForEvent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看批准情况</span></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 1 \</span><br><span class="line">--output json \</span><br><span class="line">--init-required</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入客户端</span></span><br><span class="line">docker exec -it cli bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询已安装的链码</span></span><br><span class="line">peer lifecycle chaincode queryinstalled</span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准链码</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">--signature-policy "AND('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">--name mycc \</span><br><span class="line">--version 1 \</span><br><span class="line">--init-required \</span><br><span class="line">--package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span><br><span class="line">--sequence 1 \</span><br><span class="line">--waitForEvent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看批准情况</span></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 1 \</span><br><span class="line">--output json \</span><br><span class="line">--init-required</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line">[root@vm192168305 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 09:07:53.390 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:07:53.393 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer lifecycle chaincode approveformyorg \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"AND('Org1MSP.peer','Org2MSP.peer')"</span>  \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --name mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --version 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --waitForEvent</span></span><br><span class="line">2020-10-02 09:08:02.674 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:08:02.676 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:08:04.722 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [c1add52e8d93149a9af590d0abdbb5865e7628806604f4906ad3a27ab486d185] committed with status (VALID) at </span><br><span class="line">bash-5.0# peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --output json \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required</span></span><br><span class="line">2020-10-02 09:08:13.679 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:08:13.682 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">&#123;</span><br><span class="line">	"approvals": &#123;</span><br><span class="line">		"Org1MSP": false,</span><br><span class="line">		"Org2MSP": false</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line">[root@vm192168307 raft]# docker exec -it cli bash</span><br><span class="line">bash-5.0# peer lifecycle chaincode queryinstalled</span><br><span class="line">2020-10-02 09:14:10.911 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:14:10.914 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0, Label: mycc</span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer lifecycle chaincode approveformyorg \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"AND('Org1MSP.peer','Org2MSP.peer')"</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --name mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --version 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --waitForEvent</span></span><br><span class="line">2020-10-02 09:14:17.131 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:14:17.134 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:14:19.188 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [16e05083992244af8b2f0975defa3b01e6257a818796524b330e7cb7bcbb0d49] committed with status (VALID) at </span><br><span class="line">bash-5.0# peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --output json \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required</span></span><br><span class="line">2020-10-02 09:14:24.907 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:14:24.910 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">&#123;</span><br><span class="line">	"approvals": &#123;</span><br><span class="line">		"Org1MSP": false,</span><br><span class="line">		"Org2MSP": false</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h3 id="4、提交链码"><a href="#4、提交链码" class="headerlink" title="4、提交链码"></a>4、提交链码</h3><blockquote>
<p>任意一个节点提交链码。=====================&gt;peer01-192.168.30.5</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 提交链码</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode commit \</span><br><span class="line">--signature-policy "AND('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 1 \</span><br><span class="line">--init-required \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看已提交链码</span></span><br><span class="line">peer lifecycle chaincode querycommitted -C mychannel -n mycc</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer lifecycle chaincode commit \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"AND('Org1MSP.peer','Org2MSP.peer')"</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -C mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org1.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org2.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span></span><br><span class="line">2020-10-02 09:16:05.646 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:16:05.649 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:16:07.819 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [ed00380daf25ba8e6041056c81d026148d630472de5b457a901091a6641fe55e] committed with status (VALID) at peer0.org1.example.com:7051</span><br><span class="line">2020-10-02 09:16:07.845 UTC [chaincodeCmd] ClientWait -&gt; INFO 004 txid [ed00380daf25ba8e6041056c81d026148d630472de5b457a901091a6641fe55e] committed with status (VALID) at peer0.org2.example.com:7051</span><br><span class="line">bash-5.0# peer lifecycle chaincode querycommitted -C mychannel -n mycc</span><br><span class="line">2020-10-02 09:16:17.652 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:16:17.654 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">Committed chaincode definition for chaincode 'mycc' on channel 'mychannel':</span><br><span class="line">Version: 1, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h3 id="5、初始化链码"><a href="#5、初始化链码" class="headerlink" title="5、初始化链码"></a>5、初始化链码</h3><blockquote>
<p>og1、org2任意节点初始化链码。</p>
<p>需要制定每个组织内批准智能合约的节点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer chaincode invoke \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true --cafile $ORDERER_CA \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt  \</span><br><span class="line">--isInit -c '&#123;"Args":["Init","a","100","b","100"]&#125;'</span><br></pre></td></tr></table></figure>

</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#############peer01-192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#########################################################################</span></span></span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer chaincode invoke \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -C mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org1.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org2.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt  \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --isInit -c <span class="string">'&#123;"Args":["Init","a","100","b","100"]&#125;'</span></span></span><br><span class="line">2020-10-02 09:20:01.818 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:20:01.821 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:20:01.856 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 003 Chaincode invoke successful. result: status:200 </span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h3 id="6、测试链码"><a href="#6、测试链码" class="headerlink" title="6、测试链码"></a>6、测试链码</h3><blockquote>
<p>测试链码：</p>
<p>peer01-192.168.30.5===================================&gt;查询a</p>
<p>peer11-192.168.30.6===================================&gt;查询a</p>
<p>peer02-192.168.30.7===================================&gt;查询a</p>
<p>peer12-192.168.30.8===================================&gt;查询a</p>
<p>peer01-192.168.30.5===================================&gt;提交交易</p>
<p>peer01-192.168.30.5===================================&gt;查询a,b</p>
<p>peer11-192.168.30.6===================================&gt;查询a,b</p>
<p>peer02-192.168.30.7===================================&gt;查询a,b</p>
<p>peer12-192.168.30.8===================================&gt;查询a,b</p>
<p>相关命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询a、b的值</span></span><br><span class="line">peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行交易</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer chaincode invoke \</span><br><span class="line">--tls \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-c '&#123;"Args":["invoke","b","a","20"]&#125;'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询a、b的值</span></span><br><span class="line">peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:17.129 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:17.132 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:18.031 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:18.034 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer chaincode invoke \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org1.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org2.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -C mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -c <span class="string">'&#123;"Args":["invoke","b","a","20"]&#125;'</span></span></span><br><span class="line">2020-10-02 09:24:37.376 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:37.379 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:37.403 UTC [chaincodeCmd] InitCmdFactory -&gt; INFO 003 Retrieved channel (mychannel) orderer endpoint: orderer0.example.com:7050</span><br><span class="line">2020-10-02 09:24:37.413 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 004 Chaincode invoke successful. result: status:200 </span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:47.316 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:47.319 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:47.550 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:47.553 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:20.743 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:20.745 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:21.016 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:21.020 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:50.358 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:50.360 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:50.673 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:50.675 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:23.127 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:23.130 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:23.616 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:23.619 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:53.441 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:53.444 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:54.016 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:54.019 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.8</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:25.647 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:25.650 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:26.153 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:26.156 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">100</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 09:24:56.088 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:56.092 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 09:24:56.814 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:24:56.817 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h2 id="（四）更改背书策略"><a href="#（四）更改背书策略" class="headerlink" title="（四）更改背书策略"></a>（四）更改背书策略</h2><blockquote>
<p>–sequence 2</p>
<p>值+1。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交链码</span></span><br><span class="line">peer lifecycle chaincode commit \</span><br><span class="line">--signature-policy "OR('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--init-required \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看提交的链码</span></span><br><span class="line">peer lifecycle chaincode querycommitted -C mychannel -n mycc</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############测试链码</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br></pre></td></tr></table></figure>

<h3 id="1、批准链码"><a href="#1、批准链码" class="headerlink" title="1、批准链码"></a>1、批准链码</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准链码</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">--signature-policy "OR('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">--name mycc \</span><br><span class="line">--version 1 \</span><br><span class="line">--init-required \</span><br><span class="line">--package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--waitForEvent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看批准情况</span></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--output json \</span><br><span class="line">--init-required</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准链码</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer lifecycle chaincode approveformyorg \</span><br><span class="line">--signature-policy "OR('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">--name mycc \</span><br><span class="line">--version 1 \</span><br><span class="line">--init-required \</span><br><span class="line">--package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--waitForEvent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看批准情况</span></span><br><span class="line">peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line">--channelID mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--output json \</span><br><span class="line">--init-required</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer lifecycle chaincode approveformyorg \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"OR('Org1MSP.peer','Org2MSP.peer')"</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --name mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --version 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 2 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --waitForEvent</span></span><br><span class="line">2020-10-02 09:29:49.536 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:29:49.538 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:29:51.579 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [2ce901cff06783ae54d4b5586ea848703bd5ac4b0077882abf6c227242412192] committed with status (VALID) at </span><br><span class="line">bash-5.0# peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 2 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --output json \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required</span></span><br><span class="line">2020-10-02 09:29:59.443 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:29:59.445 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">&#123;</span><br><span class="line">	"approvals": &#123;</span><br><span class="line">		"Org1MSP": false,</span><br><span class="line">		"Org2MSP": false</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer lifecycle chaincode approveformyorg \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"OR('Org1MSP.peer','Org2MSP.peer')"</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --name mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --version 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --package-id mycc:babd5d24db5ca3e0d62a222b56eed8a8a1a548c0d1bc86753fa0570d167993a0 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 2 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --waitForEvent</span></span><br><span class="line">2020-10-02 09:30:58.633 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:30:58.636 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:31:00.676 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [4f3527e1b416ac875da877d0b83e88fddff62b3b2b05a4913e17ea51b865ea24] committed with status (VALID) at </span><br><span class="line">bash-5.0# peer lifecycle chaincode checkcommitreadiness \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --channelID mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 2 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --output json \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required</span></span><br><span class="line">2020-10-02 09:31:06.270 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:31:06.273 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">&#123;</span><br><span class="line">	"approvals": &#123;</span><br><span class="line">		"Org1MSP": false,</span><br><span class="line">		"Org2MSP": false</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h3 id="2、提交链码"><a href="#2、提交链码" class="headerlink" title="2、提交链码"></a>2、提交链码</h3><blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交链码</span></span><br><span class="line">peer lifecycle chaincode commit \</span><br><span class="line">--signature-policy "OR('Org1MSP.peer','Org2MSP.peer')" \</span><br><span class="line">-o orderer0.example.com:7050 \</span><br><span class="line">--tls true \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-v 1 \</span><br><span class="line">--sequence 2 \</span><br><span class="line">--init-required \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bash-5.0# peer lifecycle chaincode commit \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --signature-policy <span class="string">"OR('Org1MSP.peer','Org2MSP.peer')"</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -o orderer0.example.com:7050 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls <span class="literal">true</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -C mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line">e.com:7051 \</span><br><span class="line"><span class="meta">--tlsRootCer&gt;</span><span class="bash"> -v 1 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --sequence 2 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --init-required \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org1.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org2.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span></span><br><span class="line">2020-10-02 09:32:14.987 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:32:14.991 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 09:32:17.179 UTC [chaincodeCmd] ClientWait -&gt; INFO 003 txid [0daaf9983b21539c20eee3081ea1869199330ea77292b5d3ba249ade5e1c185e] committed with status (VALID) at peer0.org2.example.com:7051</span><br><span class="line">2020-10-02 09:32:17.182 UTC [chaincodeCmd] ClientWait -&gt; INFO 004 txid [0daaf9983b21539c20eee3081ea1869199330ea77292b5d3ba249ade5e1c185e] committed with status (VALID) at peer0.org1.example.com:7051</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h3 id="3、测试链码"><a href="#3、测试链码" class="headerlink" title="3、测试链码"></a>3、测试链码</h3><blockquote>
<p>测试链码：</p>
<p>peer01-192.168.30.5===================================&gt;查询a</p>
<p>peer11-192.168.30.6===================================&gt;查询a</p>
<p>peer02-192.168.30.7===================================&gt;查询a</p>
<p>peer12-192.168.30.8===================================&gt;查询a</p>
<p>peer01-192.168.30.5===================================&gt;提交交易</p>
<p>peer01-192.168.30.5===================================&gt;查询a,b</p>
<p>peer11-192.168.30.6===================================&gt;查询a,b</p>
<p>peer02-192.168.30.7===================================&gt;查询a,b</p>
<p>peer12-192.168.30.8===================================&gt;查询a,b</p>
<p>注意：</p>
<p>当背书策略为”AND(‘Org1MSP.peer’,’Org2MSP.peer’)”时，提交交易的命令指向两个组织的锚节点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer chaincode invoke \</span><br><span class="line">--tls \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">--peerAddresses peer0.org2.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-c '&#123;"Args":["invoke","b","a","20"]&#125;'</span><br></pre></td></tr></table></figure>

<p>当背书策略为”OR(‘Org1MSP.peer’,’Org2MSP.peer’)”时，提交交易的命令指向本组织的锚节点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">peer chaincode invoke \</span><br><span class="line">--tls \</span><br><span class="line">--cafile $ORDERER_CA \</span><br><span class="line">--peerAddresses peer0.org1.example.com:7051 \</span><br><span class="line">--tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span><br><span class="line">-C mychannel \</span><br><span class="line">-n mycc \</span><br><span class="line">-c '&#123;"Args":["invoke","b","a","20"]&#125;'</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:01:19.791 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:19.793 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:01:21.591 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:21.594 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">bash-5.0# peer chaincode invoke \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tls \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --cafile <span class="variable">$ORDERER_CA</span> \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --peerAddresses peer0.org1.example.com:7051 \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -C mychannel \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -n mycc \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -c <span class="string">'&#123;"Args":["invoke","b","a","20"]&#125;'</span></span></span><br><span class="line">2020-10-02 11:01:54.701 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:54.704 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:54.720 UTC [chaincodeCmd] InitCmdFactory -&gt; INFO 003 Retrieved channel (mychannel) orderer endpoint: orderer0.example.com:7050</span><br><span class="line">2020-10-02 11:01:54.732 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 004 Chaincode invoke successful. result: status:200 </span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:02:15.831 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:15.834 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">140</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:02:16.201 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:16.204 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">60</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:01:24.763 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:24.765 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:01:25.321 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:25.324 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:02:18.520 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:18.523 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">140</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:02:18.816 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:18.819 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">60</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.7</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:01:27.535 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:27.539 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:01:27.786 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:27.789 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:02:23.438 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:23.441 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">140</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:02:24.260 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:24.263 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">60</span><br><span class="line">bash-5.0# </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##############192.168.30.8</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###########################################################################</span></span></span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:01:30.771 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:30.775 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">120</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:01:30.941 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:01:30.944 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">80</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","a"]&#125;'</span><br><span class="line">2020-10-02 11:02:27.263 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:27.266 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">140</span><br><span class="line">bash-5.0# peer chaincode query -C mychannel -n mycc -c '&#123;"Args":["query","b"]&#125;'</span><br><span class="line">2020-10-02 11:02:27.773 UTC [main] InitCmd -&gt; WARN 001 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">2020-10-02 11:02:27.776 UTC [main] SetOrdererEnv -&gt; WARN 002 CORE_LOGGING_LEVEL is no longer supported, please use the FABRIC_LOGGING_SPEC environment variable</span><br><span class="line">60</span><br><span class="line">bash-5.0#</span><br></pre></td></tr></table></figure>

<h2 id="（五）链码升级"><a href="#（五）链码升级" class="headerlink" title="（五）链码升级"></a>（五）链码升级</h2><blockquote>
<p>请参考：<a href="https://blog.csdn.net/qq_28540443/article/details/104335498" target="_blank" rel="noopener">https://blog.csdn.net/qq_28540443/article/details/104335498</a></p>
<p>从新编写智能合约，打包、安装、批准、提交就完事。</p>
</blockquote>
<h3 id="1、打包链码-1"><a href="#1、打包链码-1" class="headerlink" title="1、打包链码"></a>1、打包链码</h3><h3 id="2、安装链码-1"><a href="#2、安装链码-1" class="headerlink" title="2、安装链码"></a>2、安装链码</h3><h3 id="3、批准链码-1"><a href="#3、批准链码-1" class="headerlink" title="3、批准链码"></a>3、批准链码</h3><h3 id="4、提交链码-1"><a href="#4、提交链码-1" class="headerlink" title="4、提交链码"></a>4、提交链码</h3><h3 id="6、测试链码-1"><a href="#6、测试链码-1" class="headerlink" title="6、测试链码"></a>6、测试链码</h3><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><blockquote>
<h2 id="清空所有容器"><a href="#清空所有容器" class="headerlink" title="清空所有容器"></a>清空所有容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stop $(docker ps -a -q)</span><br><span class="line">sudo docker ps -qa|xargs docker rm</span><br><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br><span class="line">cd /root/raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清空所有镜像"><a href="#清空所有镜像" class="headerlink" title="清空所有镜像"></a>清空所有镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker image rm $(docker images -a -q)</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理挂载卷"><a href="#清理挂载卷" class="headerlink" title="清理挂载卷"></a>清理挂载卷</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/docker/volumes</span><br><span class="line">rm -rf ./*</span><br><span class="line">cd /root/raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h2 id="清理项目文件"><a href="#清理项目文件" class="headerlink" title="清理项目文件"></a>清理项目文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">rm -rf raft</span><br><span class="line">rm -rf /root/.local/share/Trash/files</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h1><h2 id="（一）Raft"><a href="#（一）Raft" class="headerlink" title="（一）Raft"></a>（一）Raft</h2><blockquote>
<p>参考文献：</p>
<p>算法基础：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft.html</a> </p>
<p>选举和日志复制：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_2.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_2.html</a></p>
<p>安全性：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_3.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_3.html</a></p>
<p>节点变更：<a href="https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_4.html" target="_blank" rel="noopener">https://www.cnblogs.com/hzmark/archive/2004/01/13/raft_4.html</a></p>
<p>唐伯虎点秋香：<a href="https://blog.csdn.net/qq_28540443/article/details/105092746" target="_blank" rel="noopener">https://blog.csdn.net/qq_28540443/article/details/105092746</a></p>
<p>raft动画：<a href="http://thesecretlivesofdata.com/raft/" target="_blank" rel="noopener">http://thesecretlivesofdata.com/raft/</a></p>
<p>raft论文：<a href="https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md" target="_blank" rel="noopener">https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md</a></p>
</blockquote>
<h2 id="（二）背书策略"><a href="#（二）背书策略" class="headerlink" title="（二）背书策略"></a>（二）背书策略</h2><h3 id="1、背书策略定义"><a href="#1、背书策略定义" class="headerlink" title="1、背书策略定义"></a>1、背书策略定义</h3><p>智能合约背书策略用来定义交易是否合法的判断条件，策略以主体的形式表示。主体格式为’MSP.ROLE’， MSP代表所要求的MSPID， ROLE表示角色，一共有四种合法角色：member, admin, client, peer。</p>
<h3 id="2、背书策略语法"><a href="#2、背书策略语法" class="headerlink" title="2、背书策略语法"></a>2、背书策略语法</h3><p>背书策略的语法如下：<br>EXPR(E[, E…])<br>EXPR可以是AND、OR、OutOf，E可以是一个上面示例的主体或者是另一个嵌套的EXPR策略。示例如下：<br>AND(‘Org1.member’, ‘Org2.member’, ‘Org3.member’) ：要求三个主体中每一个主体都要签名。<br>OR(‘Org1.member’, ‘Org2.member’) ：要求三个主体中至少有一个主体签名。<br>OR(‘Org1.member’, AND(‘Org2.member’, ‘Org3.member’))：要求满足有主体Org1.member的签名或者同时有主体Org2.member与Org3.member 2个主体的签名。<br>OutOf(2, ‘Org1.member’, ‘Org2.member’, ‘Org3.member’) ：要求三个主体中，至少有两个主体签名。</p>
<h3 id="3、设置背书策略"><a href="#3、设置背书策略" class="headerlink" title="3、设置背书策略"></a>3、设置背书策略</h3><p>fabric2.0智能合约设置背书策略得方式主要有两种，一种是通过提交合约的时候设置，我们称之为合约级别的背书策略，一种是直接通过合约动态设置，我们称之为键级别背书策略。</p>
<p>合约级别背书策略上边讲过了。</p>
<p>键级别背书策略可以看这里：<a href="https://blog.csdn.net/qq_28540443/article/details/104379132。" target="_blank" rel="noopener">https://blog.csdn.net/qq_28540443/article/details/104379132。</a></p>
<h3 id="4、我的思考"><a href="#4、我的思考" class="headerlink" title="4、我的思考"></a>4、我的思考</h3><blockquote>
<p>fabric合法角色：member、admin、client、peer。</p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-10-03T08:55:31.573Z" itemprop="dateUpdated">2020-10-03 16:55:31</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://cupswen.github.io">
            <img src="/img/the_Huanghe_River.png" alt="CupsWen">
            CupsWen
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fabric/" rel="tag">Fabric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raft/" rel="tag">Raft</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&title=《Raft集群部署(Fabric2.0)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&title=《Raft集群部署(Fabric2.0)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Raft集群部署(Fabric2.0)》 — Cups&url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/10/03/2020/knowledge-point-1/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">一些知识点</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/09/24/2020/blockchain-explorer/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Hyperledger Explorer</h4>
      </a>
    </div>
  
</nav>



    

</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>CupsWen &copy; 2019 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme indigo.</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&title=《Raft集群部署(Fabric2.0)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&title=《Raft集群部署(Fabric2.0)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Raft集群部署(Fabric2.0)》 — Cups&url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://cupswen.github.io/2020/09/27/2020/raft(2.0.1)/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Cups';
            clearTimeout(titleTime);
        } else {
            document.title = 'Cups';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
