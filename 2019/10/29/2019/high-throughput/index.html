<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>fabric-samples之High-Throughput Network(高通量网络) | Cups</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Fabric,fabric-samples">
    <meta name="description" content="High-Throughput Network .├── chaincode│   └── high-throughput.go├── README.md└── scripts    ├── channel-setup.sh    ├── delete-invoke.sh    ├── get-invoke.sh    ├── get-traditional.sh    ├── install-c">
<meta name="keywords" content="Fabric,fabric-samples">
<meta property="og:type" content="article">
<meta property="og:title" content="fabric-samples之High-Throughput Network(高通量网络)">
<meta property="og:url" content="http:&#x2F;&#x2F;cupswen.github.io&#x2F;2019&#x2F;10&#x2F;29&#x2F;2019&#x2F;high-throughput&#x2F;index.html">
<meta property="og:site_name" content="Cups">
<meta property="og:description" content="High-Throughput Network .├── chaincode│   └── high-throughput.go├── README.md└── scripts    ├── channel-setup.sh    ├── delete-invoke.sh    ├── get-invoke.sh    ├── get-traditional.sh    ├── install-c">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-10-31T01:51:32.000Z">
<meta name="twitter:card" content="summary">
    
    <link rel="shortcut icon" href="/img/brand.jpg">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/the_Huanghe_River.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">CupsWen</h5>
          <a href="mailto:1191567189@qq.com" target="_blank" rel="noopener" title="1191567189@qq.com" class="mail">1191567189@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/index.html"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/CupsWen" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://cupswen.github.io/hyperlink"  >
                <i class="icon icon-lg icon-link"></i>
                Link
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">fabric-samples之High-Throughput Network(高通量网络)</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">fabric-samples之High-Throughput Network(高通量网络)</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-10-29T08:36:00.000Z" itemprop="datePublished" class="page-time">
  2019-10-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#High-Throughput-Network"><span class="post-toc-text">High-Throughput Network</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#高通量网络"><span class="post-toc-text">高通量网络</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Purpose"><span class="post-toc-text">Purpose</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#目的"><span class="post-toc-text">目的</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Use-Case"><span class="post-toc-text">Use Case</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用例"><span class="post-toc-text">用例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Example-1-IOT-Boxer-Construction-Analysts"><span class="post-toc-text">Example 1 (IOT): Boxer Construction Analysts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#示例1（IOT）：Boxer-Construction-Analysts"><span class="post-toc-text">示例1（IOT）：Boxer Construction Analysts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Example-2-Balance-Transfer-Robinson-Credit-Co"><span class="post-toc-text">Example 2 (Balance Transfer): Robinson Credit Co.</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#示例2（余额转移）：Robinson-Credit-Co"><span class="post-toc-text">示例2（余额转移）：Robinson Credit Co.</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#How"><span class="post-toc-text">How</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Build-your-network"><span class="post-toc-text">Build your network</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#建立您的网络"><span class="post-toc-text">建立您的网络</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Install-and-instantiate-the-chaincode"><span class="post-toc-text">Install and instantiate the chaincode</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Invoke-the-chaincode"><span class="post-toc-text">Invoke the chaincode</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Update"><span class="post-toc-text">Update</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Get"><span class="post-toc-text">Get</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Delete"><span class="post-toc-text">Delete</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Prune"><span class="post-toc-text">Prune</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Test-the-Network"><span class="post-toc-text">Test the Network</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ChainCode"><span class="post-toc-text">ChainCode</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#scripts"><span class="post-toc-text">scripts</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#setclienv-sh"><span class="post-toc-text">setclienv.sh</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#channel-setup-sh"><span class="post-toc-text">channel-setup.sh</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-2019/high-throughput"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">fabric-samples之High-Throughput Network(高通量网络)</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-10-29 16:36:00" datetime="2019-10-29T08:36:00.000Z"  itemprop="datePublished">2019-10-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Fabric/">Fabric</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="High-Throughput-Network"><a href="#High-Throughput-Network" class="headerlink" title="High-Throughput Network"></a>High-Throughput Network</h1><blockquote>
<p>.<br>├── chaincode<br>│   └── high-throughput.go<br>├── README.md<br>└── scripts<br>    ├── channel-setup.sh<br>    ├── delete-invoke.sh<br>    ├── get-invoke.sh<br>    ├── get-traditional.sh<br>    ├── install-chaincode.sh<br>    ├── instantiate-chaincode.sh<br>    ├── many-updates.sh<br>    ├── many-updates-traditional.sh<br>    ├── prunefast-invoke.sh<br>    ├── prunesafe-invoke.sh<br>    ├── setclienv.sh<br>    ├── update-invoke.sh<br>    └── upgrade-chaincode.sh</p>
</blockquote>
<h1 id="高通量网络"><a href="#高通量网络" class="headerlink" title="高通量网络"></a>高通量网络</h1><h2 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h2><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>This network is used to understand how to properly design the chaincode data model when handling thousands of transactions per second which all<br>update the same asset in the ledger. A naive implementation would use a single key to represent the data for the asset, and the chaincode would<br>then attempt to update this key every time a transaction involving it comes in. However, when many transactions all come in at once, in the time<br>between when the transaction is simulated on the peer (i.e. read-set is created) and it’s ready to be committed to the ledger, another transaction<br>may have already updated the same value. Thus, in the simple implementation, the read-set version will no longer match the version in the orderer,<br>and a large number of parallel transactions will fail. To solve this issue, the frequently updated value is instead stored as a series of deltas<br>which are aggregated when the value must be retrieved. In this way, no single row is frequently read and updated, but rather a collection of rows<br>is considered.</p>
<p><strong>该网络用于了解每秒处理数千笔交易时，如何正确设计chaincode数据模型。</strong><br><strong>更新分类帐中的相同资产。天真的实现将使用单个键来表示资产的数据，并且链码将</strong><br><strong>然后尝试在每次涉及它的事务进入时更新此密钥。但是，当许多事务一次全部进入时，</strong><br><strong>在对等对象上模拟交易（即创建读取集）与准备好将其提交到分类账之间，</strong><br><strong>可能已经更新了相同的值。因此，在简单的实现中，读取集版本将不再与订购者中的版本匹配，</strong><br><strong>并且大量并行事务将失败。为了解决此问题，经常将更新后的值存储为一系列增量</strong><br><strong>当必须检索值时，将汇总这些值。这样，就不会频繁读取和更新单个行，而是收集一行</strong><br><strong>被认为。</strong></p>
<h2 id="Use-Case"><a href="#Use-Case" class="headerlink" title="Use Case"></a>Use Case</h2><h2 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h2><p>The primary use case for this chaincode data model design is for applications in which a particular asset has an associated amount that is<br>frequently added to or removed from. For example, with a bank or credit card account, money is either paid to or paid out of it, and the amount<br>of money in the account is the result of all of these additions and subtractions aggregated together. A typical person’s bank account may not be<br>used frequently enough to require highly-parallel throughput, but an organizational account used to store the money collected from customers on an<br>e-commerce platform may very well receive a very high number of transactions from all over the world all at once. In fact, this use case is the only<br>use case for crypto currencies like Bitcoin: a user’s unspent transaction output (UTXO) is the result of all transactions he or she has been a part of<br>since joining the blockchain. Other use cases that can employ this technique might be IOT sensors which frequently update their sensed value in the<br>cloud.</p>
<p><strong>此chaincode数据模型设计的主要用例是用于特定资产的关联金额为</strong><br><strong>经常添加或删除。例如，在银行或信用卡帐户中，钱款已支付或已付清，金额</strong><br><strong>帐户中的金额是所有这些加法和减法加在一起的结果。典型人的银行帐户可能不是</strong><br><strong>使用频率足够高，需要高度并行的吞吐量，但是组织帐户用于将从客户处收取的钱存储在</strong><br><strong>电子商务平台很可能同时接收来自世界各地的大量交易。实际上，这种用例是唯一的</strong><br><strong>比特币等加密货币的用例：用户未使用的交易输出（UTXO）是他或她参与的所有交易的结果</strong><br><strong>自加入区块链以来。可以采用该技术的其他用例可能是物联网传感器，该传感器经常在传感器中更新其感测值。</strong><br><strong>云。</strong></p>
<p>By adopting this method of storing data, an organization can optimize their chaincode to store and record transactions as quickly as possible and can<br>aggregate ledger records into one value at the time of their choosing without sacrificing transaction performance. Given the state-machine design of<br>Hyperledger Fabric, however, careful considerations need to be given to the data model design for the chaincode.</p>
<p><strong>通过采用这种存储数据的方法，组织可以优化其链码以尽快存储和记录交易，并且可以</strong><br><strong>在选择分类帐记录时将其分类为一个值，而不会牺牲交易性能。 给定状态机的设计</strong><br><strong>但是，在Hyperledger Fabric中，需要仔细考虑链代码的数据模型设计。</strong></p>
<p>Let’s look at some concrete use cases and how an organization might implement high-throughput storage. These cases will try and explore some of the<br>advantages and disadvantages of such a system, and how to overcome them.</p>
<p><strong>让我们看一些具体的用例，以及组织如何实现高吞吐量存储。 这些案例将尝试探索一些</strong><br><strong>这种系统的优缺点，以及如何克服它们。</strong></p>
<h4 id="Example-1-IOT-Boxer-Construction-Analysts"><a href="#Example-1-IOT-Boxer-Construction-Analysts" class="headerlink" title="Example 1 (IOT): Boxer Construction Analysts"></a>Example 1 (IOT): Boxer Construction Analysts</h4><h4 id="示例1（IOT）：Boxer-Construction-Analysts"><a href="#示例1（IOT）：Boxer-Construction-Analysts" class="headerlink" title="示例1（IOT）：Boxer Construction Analysts"></a>示例1（IOT）：Boxer Construction Analysts</h4><p>Boxer Construction Analysts is an IOT company focused on enabling real-time monitoring of large, expensive assets (machinery) on commercial<br>construction projects. They’ve partnered with the only construction vehicle company in New York, Condor Machines Inc., to provide a reliable,<br>auditable, and replayable monitoring system on their machines. This allows Condor to monitor their machines and address problems as soon as<br>they occur while providing end-users with a transparent report on machine health, which helps keep the customers satisfied.</p>
<p><strong>Boxer Construction Analysts是一家物联网公司，致力于对商业上大型，昂贵的资产（机器）进行实时监控</strong><br><strong>建设项目。 他们已与纽约唯一的工程车辆公司Condor Machines Inc.合作，以提供可靠，</strong><br><strong>在其机器上具有可审核和可重播的监视系统。 这使Condor可以监视他们的机器并尽快解决问题</strong><br><strong>在向最终用户提供有关机器运行状况的透明报告时，它们会发生，这有助于保持客户满意度。</strong></p>
<p>The vehicles are outfitted with many sensors each of which broadcasts updated values at frequencies ranging from several times a second to<br>several times a minute. Boxer initially sets up their chaincode so that the central machine computer pushes these values out to the blockchain<br>as soon as they’re produced, and each sensor has its own row in the ledger which is updated when a new value comes in. While they find that<br>this works fine for the sensors which only update several times a minute, they run into some issues when updating the faster sensors. Often,<br>the blockchain skips several sensor readings before adding a new one, defeating the purpose of having a fast, always-on sensor. The issue they’re<br>running into is that they’re sending update transactions so fast that the version of the row is changed between the creation of a transaction’s<br>read-set and committing that transaction to the ledger. The result is that while a transaction is in the process of being committed, all future<br>transactions are rejected until the commitment process is complete and a new, much later reading updates the ledger.</p>
<p><strong>车辆配备了许多传感器，每个传感器以每秒几秒钟到每秒的频率广播更新的值。</strong><br><strong>一分钟几次。 Boxer最初设置其链码，以便中央计算机将这些值推送到区块链</strong><br><strong>传感器生产出来后，每个传感器在分类帐中都有自己的行，当输入新值时会更新该行。</strong><br><strong>这对于每分钟仅更新几次的传感器来说效果很好，在更新速度更快的传感器时会遇到一些问题。经常，</strong><br><strong>区块链在添加新的传感器读数之前跳过了多个传感器读数，从而达到了保持快速，始终在线的传感器的目的。他们的问题</strong><br><strong>遇到的问题是，他们发送更新交易的速度如此之快，以至于在创建交易的交易记录之间更改行的版本</strong><br><strong>读取设置并将该事务提交到分类帐。结果是，尽管交易正在进行中，但所有未来</strong><br><strong>交易被拒绝，直到承诺过程完成，并且新的，更晚的阅读内容更新了分类帐。</strong></p>
<p>To address this issue, they adopt a high-throughput design for the chaincode data model instead. Each sensor has a key which identifies it within the<br>ledger, and the difference between the previous reading and the current reading is published as a transaction. For example, if a sensor is monitoring<br>engine temperature, rather than sending the following list: 220F, 223F, 233F, 227F, the sensor would send: +220, +3, +10, -6 (the sensor is assumed<br>to start a 0 on initialization). This solves the throughput problem, as the machine can post delta transactions as fast as it wants and they will all<br>eventually be committed to the ledger in the order they were received. Additionally, these transactions can be processed as they appear in the ledger<br>by a dashboard to provide live monitoring data. The only difference the engineers have to pay attention to in this case is to make sure the sensors can<br>send deltas from the previous reading, rather than fixed readings.</p>
<p><strong>为了解决此问题，他们改为对链码数据模型采用高吞吐量设计。 每个传感器都有一个可在</strong><br><strong>分类帐，并且先前的读数和当前的读数之间的差异将作为事务发布。 例如，如果传感器正在监控</strong><br><strong>引擎温度，而不是发送以下列表：220F，223F，233F，227F，传感器将发送：+ 220，+ 3，+ 10，-6（假定传感器</strong><br><strong>在初始化时开始为0）。 这解决了吞吐量问题，因为计算机可以按所需的速度发布增量事务，并且它们都将</strong><br><strong>最终按照接收顺序将其承诺到分类帐中。 此外，这些交易可以按出现在分类帐中的方式进行处理</strong><br><strong>由仪表板提供实时监控数据。 在这种情况下，工程师必须注意的唯一区别是确保传感器可以</strong><br><strong>发送先前读数而不是固定读数的增量。</strong></p>
<h4 id="Example-2-Balance-Transfer-Robinson-Credit-Co"><a href="#Example-2-Balance-Transfer-Robinson-Credit-Co" class="headerlink" title="Example 2 (Balance Transfer): Robinson Credit Co."></a>Example 2 (Balance Transfer): Robinson Credit Co.</h4><h4 id="示例2（余额转移）：Robinson-Credit-Co"><a href="#示例2（余额转移）：Robinson-Credit-Co" class="headerlink" title="示例2（余额转移）：Robinson Credit Co."></a>示例2（余额转移）：Robinson Credit Co.</h4><p>Robinson Credit Co. provides credit and financial services to large businesses. As such, their accounts are large, complex, and accessed by many<br>people at once at any time of the day. They want to switch to blockchain, but are having trouble keeping up with the number of deposits and<br>withdrawals happening at once on the same account. Additionally, they need to ensure users never withdraw more money than is available<br>on an account, and transactions that do get rejected. The first problem is easy to solve, the second is more nuanced and requires a variety of<br>strategies to accommodate high-throughput storage model design.</p>
<p><strong>Robinson Credit Co. 为大型企业提供信贷和金融服务。 因此，他们的帐户庞大，复杂，并且许多人可以访问</strong><br><strong>一天中的任何时候都可以一次找到人。 他们想切换到区块链，但在跟上存款数量和</strong><br><strong>同一帐户同时发生提款。 此外，他们需要确保用户的提款金额永远不会超过可用金额</strong><br><strong>在一个帐户上，而确实被拒绝的交易。 第一个问题很容易解决，第二个问题更加细微，需要各种</strong><br><strong>适应高吞吐量存储模型设计的策略。</strong></p>
<p>To solve throughput, this new storage model is leveraged to allow every user performing transactions against the account to make that transaction in terms<br>of a delta. For example, global e-commerce company America Inc. must be able to accept thousands of transactions an hour in order to keep up with<br>their customer’s demands. Rather than attempt to update a single row with the total amount of money in America Inc’s account, Robinson Credit Co.<br>accepts each transaction as an additive delta to America Inc’s account. At the end of the day, America Inc’s accounting department can quickly<br>retrieve the total value in the account when the sums are aggregated.</p>
<p><strong>为了解决吞吐量，这种新的存储模型被利用来允许每个针对该帐户执行交易的用户按照该交易进行交易</strong><br><strong>三角洲 例如，全球电子商务公司America Inc.必须每小时能够接受数千笔交易，以便跟上</strong><br><strong>他们客户的需求。 Robinson Credit Co.并没有尝试用America Inc.帐户中的总金额更新一行。</strong><br><strong>接受每笔交易作为America Inc.帐户的附加差额。 归根结底，美国公司的会计部门可以迅速</strong><br><strong>汇总总和后，检索帐户中的总值。</strong></p>
<p>However, what happens when American Inc. now wants to pay its suppliers out of the same account, or a different account also on the blockchain?<br>Robinson Credit Co. would like to be assured that America Inc.’s accounting department can’t simply overdraw their account, which is difficult to<br>do while at the same enabling transactions to happen quickly, as deltas are added to the ledger without any sort of bounds checking on the final<br>aggregate value. There are a variety of solutions which can be used in combination to address this.</p>
<p><strong>但是，当美国公司现在想要从同一账户或区块链上的另一个账户向供应商付款时会发生什么呢？</strong><br><strong>Robinson Credit Co.希望放心，美国公司的会计部门不能简单地透支其帐户，这很难做到</strong><br><strong>同时做到了，同时使交易迅速发生，因为增量被添加到分类帐中，而没有任何形式的边界检查最终</strong><br><strong>总价值。 有多种解决方案可以结合使用以解决此问题。</strong></p>
<p>Solution 1 involves polling the aggregate value regularly. This happens separate from any delta transaction, and can be performed by a monitoring<br>service setup by Robinson themselves so that they can at least be guaranteed that if an overdraw does occur, they can detect it within a known<br>number of seconds and respond to it appropriately (e.g. by temporarily shutting off transactions on that account), all of which can be automated.<br>Furthermore, thanks to the decentralized nature of Fabric, this operation can be performed on a peer dedicated to this function that would not<br>slow down or impact the performance of peers processing customer transactions.</p>
<p><strong>解决方案1涉及定期轮询汇总值。 这与任何增量事务都独立发生，并且可以通过监视来执行</strong><br><strong>Robinson自己设置服务，以便至少可以保证如果透支确实发生，他们可以在已知范围内检测到</strong><br><strong>秒数并对其做出适当响应（例如，通过暂时关闭该帐户的交易），所有这些操作都可以自动进行。</strong><br><strong>此外，由于Fabric的分散性质，可以在专用于此功能的对等方上执行此操作</strong><br><strong>放慢或影响同行处理客户交易的性能。</strong></p>
<p>Solution 2 involves breaking up the submission and verification steps of the balance transfer. Balance transfer submissions happen very quickly<br>and don’t bother with checking overdrawing. However, a secondary process reviews each transaction sent to the chain and keeps a running total,<br>verifying that none of them overdraw the account, or at the very least that aggregated withdrawals vs deposits balance out at the end of the day.<br>Similar to Solution 1, this system would run separate from any transaction processing hardware and would not incur a performance hit on the<br>customer-facing chain.</p>
<p><strong>解决方案2涉及分解余额转帐的提交和验证步骤。 余额转帐提交非常迅速</strong><br><strong>并且不要打扰透支。 但是，辅助流程会审核发送到链上的每笔交易，并保持运行总额，</strong><br><strong>确认没有人透支该帐户，或者至少在一天结束时平衡了总提款与存款的余额。</strong><br><strong>与解决方案1相似，此系统将与任何事务处理硬件分开运行，并且不会对性能造成影响。</strong><br><strong>面向客户的链。</strong></p>
<p>Solution 3 involves individually tailoring the smart contracts between Robinson and America Inc, leveraging the power of chaincode to customize<br>spending limits based on solvency proofs. Perhaps a limit is set on withdrawal transactions such that anything below $1000 is automatically processed<br>and assumed to be correct and at minimal risk to either company simply due to America Inc. having proved solvency. However, withdrawals above $1000<br>must be verified before approval and admittance to the chain.</p>
<p><strong>解决方案3涉及量身定制Robinson和America Inc之间的智能合约，利用链码的力量进行定制</strong><br><strong>基于偿付能力证明的支出限额。 也许对取款交易设置了限制，以便自动处理低于$ 1000的任何内容</strong><br><strong>并仅由于America Inc.已证明具有偿付能力而被认为是正确的，并且对两家公司的风险最小。 但是，提款高于\ $ 1000</strong><br><strong>必须先进行验证，然后才能批准和允许进入连锁店。</strong></p>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><p>This sample provides the chaincode and scripts required to run a high-throughput application. For ease of use, it runs on the same network which is brought<br>up by <code>byfn.sh</code> in the <code>first-network</code> folder within <code>fabric-samples</code>, albeit with a few small modifications. The instructions to build the network<br>and run some invocations are provided below.</p>
<p><strong>该示例提供了运行高吞吐量应用程序所需的链代码和脚本。 为了易于使用，它运行在所带的同一网络上</strong><br><strong>尽管进行了一些小修改，但仍通过“ fabric-samples”内“ first-network”文件夹中的“ byfn.sh”进行了设置。 建立网络的说明</strong><br><strong>并运行下面提供的一些调用。</strong></p>
<h3 id="Build-your-network"><a href="#Build-your-network" class="headerlink" title="Build your network"></a>Build your network</h3><h3 id="建立您的网络"><a href="#建立您的网络" class="headerlink" title="建立您的网络"></a>建立您的网络</h3><ol>
<li><p><code>cd</code> into the <code>first-network</code> folder within <code>fabric-samples</code>, e.g. <code>cd ~/fabric-samples/first-network</code></p>
</li>
<li><p>Open <code>docker-compose-cli.yaml</code> in your favorite editor, and edit the following lines:</p>
<ul>
<li><p>In the <code>volumes</code> section of the <code>cli</code> container, edit the second line which refers to the chaincode folder to point to the chaincode folder<br>within the <code>high-throughput</code> folder, e.g.</p>
<p><code>./../chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go</code> –&gt;<br><code>./../high-throughput/chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go</code></p>
</li>
<li><p>Again in the <code>volumes</code> section, edit the fourth line which refers to the scripts folder so it points to the scripts folder within the<br><code>high-throughput</code> folder, e.g.</p>
<p><code>./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/</code> –&gt;<br><code>./../high-throughput/scripts/:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/</code></p>
</li>
<li><p>Finally, comment out the <code>docker exec cli scripts/script.sh</code> command from the <code>byfn.sh</code> script by placing a <code>#</code> before it so that the standard BYFN end to end script doesn’t run, e.g.</p>
<p><code>#  docker exec cli scripts/script.sh $CHANNEL_NAME $CLI_DELAY $LANGUAGE $CLI_TIMEOUT $VERBOSE</code></p>
</li>
</ul>
</li>
<li><p>We can now bring our network up by typing in <code>./byfn.sh -m up -c mychannel</code></p>
</li>
<li><p>Open a new terminal window and enter the CLI container using <code>docker exec -it cli bash</code>, all operations on the network will happen within<br>this container from now on.</p>
</li>
</ol>
<h3 id="Install-and-instantiate-the-chaincode"><a href="#Install-and-instantiate-the-chaincode" class="headerlink" title="Install and instantiate the chaincode"></a>Install and instantiate the chaincode</h3><ol>
<li>Once you’re in the CLI container run <code>cd scripts</code> to enter the <code>scripts</code> folder</li>
<li>Set-up the environment variables by running <code>source setclienv.sh</code></li>
<li>Set-up your channels and anchor peers by running <code>./channel-setup.sh</code></li>
<li>Install your chaincode by running <code>./install-chaincode.sh 1.0</code>. The only argument is a number representing the chaincode version, every time<br>you want to install and upgrade to a new chaincode version simply increment this value by 1 when running the command, e.g. <code>./install-chaincode.sh 2.0</code></li>
<li>Instantiate your chaincode by running <code>./instantiate-chaincode.sh 1.0</code>. The version argument serves the same purpose as in <code>./install-chaincode.sh 1.0</code><br>and should match the version of the chaincode you just installed. In the future, when upgrading the chaincode to a newer version,<br><code>./upgrade-chaincode.sh 2.0</code> should be used instead of <code>./instantiate-chaincode.sh 1.0</code>.</li>
<li>Your chaincode is now installed and ready to receive invocations</li>
</ol>
<h3 id="Invoke-the-chaincode"><a href="#Invoke-the-chaincode" class="headerlink" title="Invoke the chaincode"></a>Invoke the chaincode</h3><p>All invocations are provided as scripts in <code>scripts</code> folder; these are detailed below.</p>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><p>The format for update is: <code>./update-invoke.sh name value operation</code> where <code>name</code> is the name of the variable to update, <code>value</code> is the value to<br>add to the variable, and <code>operation</code> is either <code>+</code> or <code>-</code> depending on what type of operation you’d like to add to the variable. In the future,<br>multiply/divide operations will be supported (or add them yourself to the chaincode as an exercise!)</p>
<p>Example: <code>./update-invoke.sh myvar 100 +</code></p>
<h4 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h4><p>The format for get is: <code>./get-invoke.sh name</code> where <code>name</code> is the name of the variable to get.</p>
<p>Example: <code>./get-invoke.sh myvar</code></p>
<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><p>The format for delete is: <code>./delete-invoke.sh name</code> where <code>name</code> is the name of the variable to delete.</p>
<p>Example: <code>./delete-invoke.sh myvar</code></p>
<h4 id="Prune"><a href="#Prune" class="headerlink" title="Prune"></a>Prune</h4><p>Pruning takes all the deltas generated for a variable and combines them all into a single row, deleting all previous rows. This helps cleanup<br>the ledger when many updates have been performed. There are two types of pruning: <code>prunefast</code> and <code>prunesafe</code>. Prune fast performs the deletion<br>and aggregation simultaneously, so if an error happens along the way data integrity is not guaranteed. Prune safe performs the aggregation first,<br>backs up the results, then performs the deletion. This way, if an error occurs along the way, data integrity is maintained.</p>
<p>The format for pruning is: <code>./[prunesafe|prunefast]-invoke.sh name</code> where <code>name</code> is the name of the variable to prune.</p>
<p>Example: <code>./prunefast-invoke.sh myvar</code> or <code>./prunesafe-invoke.sh myvar</code></p>
<h3 id="Test-the-Network"><a href="#Test-the-Network" class="headerlink" title="Test the Network"></a>Test the Network</h3><p>Two scripts are provided to show the advantage of using this system when running many parallel transactions at once: <code>many-updates.sh</code> and<br><code>many-updates-traditional.sh</code>. The first script accepts the same arguments as <code>update-invoke.sh</code> but duplicates the invocation 1000 times<br>and in parallel. The final value, therefore, should be the given update value * 1000. Run this script to confirm that your network is functioning<br>properly. You can confirm this by checking your peer and orderer logs and verifying that no invocations are rejected due to improper versions.</p>
<p>The second script, <code>many-updates-traditional.sh</code>, also sends 1000 transactions but using the traditional storage system. It’ll update a single<br>row in the ledger 1000 times, with a value incrementing by one each time (i.e. the first invocation sets it to 0 and the last to 1000). The<br>expectation would be that the final value of the row is 999. However, the final value changes each time this script is run and you’ll find<br>errors in the peer and orderer logs.</p>
<p>There is one other script, <code>get-traditional.sh</code>, which simply gets the value of a row in the traditional way, with no deltas.</p>
<p>Examples:<br><code>./many-updates.sh testvar 100 +</code> –&gt; final value from <code>./get-invoke.sh</code> should be 100000<br><code>./many-updates-traditional.sh testvar</code> –&gt; final value from <code>./get-traditional.sh testvar</code> is undefined</p>
<h1 id="ChainCode"><a href="#ChainCode" class="headerlink" title="ChainCode"></a>ChainCode</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright IBM Corp All Rights Reserved</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Demonstrates how to handle data in an application with a high transaction volume where the transactions</span></span><br><span class="line"><span class="comment"> * all attempt to change the same key-value pair in the ledger. Such an application will have trouble</span></span><br><span class="line"><span class="comment"> * as multiple transactions may read a value at a certain version, which will then be invalid when the first</span></span><br><span class="line"><span class="comment"> * transaction updates the value to a new version, thus rejecting all other transactions until they're</span></span><br><span class="line"><span class="comment"> * re-executed.</span></span><br><span class="line"><span class="comment"> * Rather than relying on serialization of the transactions, which is slow, this application initializes</span></span><br><span class="line"><span class="comment"> * a value and then accepts deltas of that value which are added as rows to the ledger. The actual value</span></span><br><span class="line"><span class="comment"> * is then an aggregate of the initial value combined with all of the deltas. Additionally, a pruning</span></span><br><span class="line"><span class="comment"> * function is provided which aggregates and deletes the deltas to update the initial value. This should</span></span><br><span class="line"><span class="comment"> * be done during a maintenance window or when there is a lowered transaction volume, to avoid the proliferation</span></span><br><span class="line"><span class="comment"> * of millions of rows of data.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @author	Alexandre Pauwels for IBM</span></span><br><span class="line"><span class="comment"> * @created	17 Aug 2017</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Imports</span></span><br><span class="line"><span class="comment"> * 4 utility libraries for formatting, handling bytes, reading and writing JSON, and string manipulation</span></span><br><span class="line"><span class="comment"> * 2 specific Hyperledger Fabric specific libraries for Smart Contracts</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/hyperledger/fabric/core/chaincode/shim"</span></span><br><span class="line">	sc <span class="string">"github.com/hyperledger/fabric/protos/peer"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//SmartContract is the data structure which represents this contract and on which  various contract lifecycle functions are attached</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define Status codes for the response</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	OK    = <span class="number">200</span></span><br><span class="line">	ERROR = <span class="number">500</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init is called when the smart contract is instantiated</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">Init</span><span class="params">(APIstub shim.ChaincodeStubInterface)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> shim.Success(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invoke routes invocations to the appropriate function in chaincode</span></span><br><span class="line"><span class="comment">// Current supported invocations are:</span></span><br><span class="line"><span class="comment">//	- update, adds a delta to an aggregate variable in the ledger, all variables are assumed to start at 0</span></span><br><span class="line"><span class="comment">//	- get, retrieves the aggregate value of a variable in the ledger</span></span><br><span class="line"><span class="comment">//	- pruneFast, deletes all rows associated with the variable and replaces them with a single row containing the aggregate value</span></span><br><span class="line"><span class="comment">//	- pruneSafe, same as pruneFast except it pre-computed the value and backs it up before performing any destructive operations</span></span><br><span class="line"><span class="comment">//	- delete, removes all rows associated with the variable</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">Invoke</span><span class="params">(APIstub shim.ChaincodeStubInterface)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Retrieve the requested Smart Contract function and arguments</span></span><br><span class="line">	function, args := APIstub.GetFunctionAndParameters()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Route to the appropriate handler function to interact with the ledger appropriately</span></span><br><span class="line">	<span class="keyword">if</span> function == <span class="string">"update"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.update(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"get"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.get(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"prunefast"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.pruneFast(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"prunesafe"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.pruneSafe(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"delete"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.<span class="built_in">delete</span>(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"putstandard"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.putStandard(APIstub, args)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> function == <span class="string">"getstandard"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.getStandard(APIstub, args)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Error(<span class="string">"Invalid Smart Contract function name."</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Updates the ledger to include a new delta for a particular variable. If this is the first time</span></span><br><span class="line"><span class="comment"> * this variable is being added to the ledger, then its initial value is assumed to be 0. The arguments</span></span><br><span class="line"><span class="comment"> * to give in the args array are as follows:</span></span><br><span class="line"><span class="comment"> *	- args[0] -&gt; name of the variable</span></span><br><span class="line"><span class="comment"> *	- args[1] -&gt; new delta (float)</span></span><br><span class="line"><span class="comment"> *	- args[2] -&gt; operation (currently supported are addition "+" and subtraction "-")</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param APIstub The chaincode shim</span></span><br><span class="line"><span class="comment"> * @param args The arguments array for the update invocation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return A response structure indicating success or failure with a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">update</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Check we have a valid number of args</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">3</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Incorrect number of arguments, expecting 3"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Extract the args</span></span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line">	op := args[<span class="number">2</span>]</span><br><span class="line">	_, err := strconv.ParseFloat(args[<span class="number">1</span>], <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Provided value was not a number"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make sure a valid operator is provided</span></span><br><span class="line">	<span class="keyword">if</span> op != <span class="string">"+"</span> &amp;&amp; op != <span class="string">"-"</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Operator %s is unrecognized"</span>, op))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Retrieve info needed for the update procedure </span></span><br><span class="line">    <span class="comment">// 检索更新过程所需的信息</span></span><br><span class="line">	txid := APIstub.GetTxID()</span><br><span class="line">	compositeIndexName := <span class="string">"varName~op~value~txID"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create the composite key that will allow us to query for all deltas on a particular variable</span></span><br><span class="line">    <span class="comment">// 创建复合键，使我们可以查询特定变量上的所有增量</span></span><br><span class="line">	compositeKey, compositeErr := APIstub.CreateCompositeKey(compositeIndexName, []<span class="keyword">string</span>&#123;name, op, args[<span class="number">1</span>], txid&#125;)</span><br><span class="line">	<span class="keyword">if</span> compositeErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not create a composite key for %s: %s"</span>, name, compositeErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Save the composite key index</span></span><br><span class="line">    <span class="comment">// 保存组合键索引</span></span><br><span class="line">	compositePutErr := APIstub.PutState(compositeKey, []<span class="keyword">byte</span>&#123;<span class="number">0x00</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> compositePutErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not put operation for %s in the ledger: %s"</span>, name, compositePutErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">"Successfully added %s%s to %s"</span>, op, args[<span class="number">1</span>], name)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Retrieves the aggregate value of a variable in the ledger. Gets all delta rows for the variable</span></span><br><span class="line"><span class="comment"> * and computes the final value from all deltas. The args array for the invocation must contain the</span></span><br><span class="line"><span class="comment"> * following argument:</span></span><br><span class="line"><span class="comment"> *	- args[0] -&gt; The name of the variable to get the value of</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param APIstub The chaincode shim</span></span><br><span class="line"><span class="comment"> * @param args The arguments array for the get invocation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return A response structure indicating success or failure with a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">get</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Check we have a valid number of args</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Incorrect number of arguments, expecting 1"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line">	<span class="comment">// Get all deltas for the variable</span></span><br><span class="line">	deltaResultsIterator, deltaErr := APIstub.GetStateByPartialCompositeKey(<span class="string">"varName~op~value~txID"</span>, []<span class="keyword">string</span>&#123;name&#125;)</span><br><span class="line">	<span class="keyword">if</span> deltaErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve value for %s: %s"</span>, name, deltaErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> deltaResultsIterator.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Check the variable existed</span></span><br><span class="line">	<span class="keyword">if</span> !deltaResultsIterator.HasNext() &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"No variable by the name %s exists"</span>, name))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Iterate through result set and compute final value</span></span><br><span class="line">	<span class="keyword">var</span> finalVal <span class="keyword">float64</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i = <span class="number">0</span>; deltaResultsIterator.HasNext(); i++ &#123;</span><br><span class="line">		<span class="comment">// Get the next row</span></span><br><span class="line">		responseRange, nextErr := deltaResultsIterator.Next()</span><br><span class="line">		<span class="keyword">if</span> nextErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(nextErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Split the composite key into its component parts</span></span><br><span class="line">		_, keyParts, splitKeyErr := APIstub.SplitCompositeKey(responseRange.Key)</span><br><span class="line">		<span class="keyword">if</span> splitKeyErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(splitKeyErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Retrieve the delta value and operation</span></span><br><span class="line">		operation := keyParts[<span class="number">1</span>]</span><br><span class="line">		valueStr := keyParts[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Convert the value string and perform the operation</span></span><br><span class="line">		value, convErr := strconv.ParseFloat(valueStr, <span class="number">64</span>)</span><br><span class="line">		<span class="keyword">if</span> convErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(convErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> operation &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">			finalVal += value</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">			finalVal -= value</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Unrecognized operation %s"</span>, operation))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(strconv.FormatFloat(finalVal, <span class="string">'f'</span>, <span class="number">-1</span>, <span class="number">64</span>)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Prunes a variable by deleting all of its delta rows while computing the final value. Once all rows</span></span><br><span class="line"><span class="comment"> * have been processed and deleted, a single new row is added which defines a delta containing the final</span></span><br><span class="line"><span class="comment"> * computed value of the variable. This function is NOT safe as any failures or errors during pruning</span></span><br><span class="line"><span class="comment"> * will result in an undefined final value for the variable and loss of data. Use pruneSafe if data</span></span><br><span class="line"><span class="comment"> * integrity is important. The args array contains the following argument:</span></span><br><span class="line"><span class="comment"> *	- args[0] -&gt; The name of the variable to prune</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param APIstub The chaincode shim</span></span><br><span class="line"><span class="comment"> * @param args The args array for the pruneFast invocation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return A response structure indicating success or failure with a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">pruneFast</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Check we have a valid number of ars</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Incorrect number of arguments, expecting 1"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Retrieve the name of the variable to prune</span></span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get all delta rows for the variable</span></span><br><span class="line">	deltaResultsIterator, deltaErr := APIstub.GetStateByPartialCompositeKey(<span class="string">"varName~op~value~txID"</span>, []<span class="keyword">string</span>&#123;name&#125;)</span><br><span class="line">	<span class="keyword">if</span> deltaErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve value for %s: %s"</span>, name, deltaErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> deltaResultsIterator.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Check the variable existed</span></span><br><span class="line">	<span class="keyword">if</span> !deltaResultsIterator.HasNext() &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"No variable by the name %s exists"</span>, name))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Iterate through result set computing final value while iterating and deleting each key</span></span><br><span class="line">	<span class="keyword">var</span> finalVal <span class="keyword">float64</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i = <span class="number">0</span>; deltaResultsIterator.HasNext(); i++ &#123;</span><br><span class="line">		<span class="comment">// Get the next row</span></span><br><span class="line">		responseRange, nextErr := deltaResultsIterator.Next()</span><br><span class="line">		<span class="keyword">if</span> nextErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(nextErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Split the key into its composite parts</span></span><br><span class="line">		_, keyParts, splitKeyErr := APIstub.SplitCompositeKey(responseRange.Key)</span><br><span class="line">		<span class="keyword">if</span> splitKeyErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(splitKeyErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Retrieve the operation and value</span></span><br><span class="line">		operation := keyParts[<span class="number">1</span>]</span><br><span class="line">		valueStr := keyParts[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Convert the value to a float</span></span><br><span class="line">		value, convErr := strconv.ParseFloat(valueStr, <span class="number">64</span>)</span><br><span class="line">		<span class="keyword">if</span> convErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(convErr.Error())</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Delete the row from the ledger</span></span><br><span class="line">		deltaRowDelErr := APIstub.DelState(responseRange.Key)</span><br><span class="line">		<span class="keyword">if</span> deltaRowDelErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not delete delta row: %s"</span>, deltaRowDelErr.Error()))</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Add the value of the deleted row to the final aggregate</span></span><br><span class="line">		<span class="keyword">switch</span> operation &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">			finalVal += value</span><br><span class="line">		<span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">			finalVal -= value</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Unrecognized operation %s"</span>, operation))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Update the ledger with the final value and return</span></span><br><span class="line">	updateResp := s.update(APIstub, []<span class="keyword">string</span>&#123;name, strconv.FormatFloat(finalVal, <span class="string">'f'</span>, <span class="number">-1</span>, <span class="number">64</span>), <span class="string">"+"</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> updateResp.Status == OK &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">"Successfully pruned variable %s, final value is %f, %d rows pruned"</span>, args[<span class="number">0</span>], finalVal, i)))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Failed to prune variable: all rows deleted but could not update value to %f, variable no longer exists in ledger"</span>, finalVal))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function performs the same function as pruneFast except it provides data backups in case the</span></span><br><span class="line"><span class="comment"> * prune fails. The final aggregate value is computed before any deletion occurs and is backed up</span></span><br><span class="line"><span class="comment"> * to a new row. This back-up row is deleted only after the new aggregate delta has been successfully</span></span><br><span class="line"><span class="comment"> * written to the ledger. The args array contains the following argument:</span></span><br><span class="line"><span class="comment"> *	args[0] -&gt; The name of the variable to prune</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param APIstub The chaincode shim</span></span><br><span class="line"><span class="comment"> * @param args The arguments array for the pruneSafe invocation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @result A response structure indicating success or failure with a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">pruneSafe</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Verify there are a correct number of arguments</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Incorrect number of arguments, expecting 1 (the name of the variable to prune)"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get the var name</span></span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get the var's value and process it</span></span><br><span class="line">	getResp := s.get(APIstub, args)</span><br><span class="line">	<span class="keyword">if</span> getResp.Status == ERROR &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve the value of %s before pruning, pruning aborted: %s"</span>, name, getResp.Message))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	valueStr := <span class="keyword">string</span>(getResp.Payload)</span><br><span class="line">	val, convErr := strconv.ParseFloat(valueStr, <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> convErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not convert the value of %s to a number before pruning, pruning aborted: %s"</span>, name, convErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Store the var's value temporarily</span></span><br><span class="line">	backupPutErr := APIstub.PutState(fmt.Sprintf(<span class="string">"%s_PRUNE_BACKUP"</span>, name), []<span class="keyword">byte</span>(valueStr))</span><br><span class="line">	<span class="keyword">if</span> backupPutErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not backup the value of %s before pruning, pruning aborted: %s"</span>, name, backupPutErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Get all deltas for the variable</span></span><br><span class="line">	deltaResultsIterator, deltaErr := APIstub.GetStateByPartialCompositeKey(<span class="string">"varName~op~value~txID"</span>, []<span class="keyword">string</span>&#123;name&#125;)</span><br><span class="line">	<span class="keyword">if</span> deltaErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve value for %s: %s"</span>, name, deltaErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> deltaResultsIterator.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Delete each row</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i = <span class="number">0</span>; deltaResultsIterator.HasNext(); i++ &#123;</span><br><span class="line">		responseRange, nextErr := deltaResultsIterator.Next()</span><br><span class="line">		<span class="keyword">if</span> nextErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve next row for pruning: %s"</span>, nextErr.Error()))</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		deltaRowDelErr := APIstub.DelState(responseRange.Key)</span><br><span class="line">		<span class="keyword">if</span> deltaRowDelErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not delete delta row: %s"</span>, deltaRowDelErr.Error()))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Insert new row for the final value</span></span><br><span class="line">	updateResp := s.update(APIstub, []<span class="keyword">string</span>&#123;name, valueStr, <span class="string">"+"</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> updateResp.Status == ERROR &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not insert the final value of the variable after pruning, variable backup is stored in %s_PRUNE_BACKUP: %s"</span>, name, updateResp.Message))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Delete the backup value</span></span><br><span class="line">	delErr := APIstub.DelState(fmt.Sprintf(<span class="string">"%s_PRUNE_BACKUP"</span>, name))</span><br><span class="line">	<span class="keyword">if</span> delErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not delete backup value %s_PRUNE_BACKUP, this does not affect the ledger but should be removed manually"</span>, name))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">"Successfully pruned variable %s, final value is %f, %d rows pruned"</span>, name, val, i)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Deletes all rows associated with an aggregate variable from the ledger. The args array</span></span><br><span class="line"><span class="comment"> * contains the following argument:</span></span><br><span class="line"><span class="comment"> *	- args[0] -&gt; The name of the variable to delete</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param APIstub The chaincode shim</span></span><br><span class="line"><span class="comment"> * @param args The arguments array for the delete invocation</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return A response structure indicating success or failure with a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">delete</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	<span class="comment">// Check there are a correct number of arguments</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(<span class="string">"Incorrect number of arguments, expecting 1"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Retrieve the variable name</span></span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Delete all delta rows</span></span><br><span class="line">	deltaResultsIterator, deltaErr := APIstub.GetStateByPartialCompositeKey(<span class="string">"varName~op~value~txID"</span>, []<span class="keyword">string</span>&#123;name&#125;)</span><br><span class="line">	<span class="keyword">if</span> deltaErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve delta rows for %s: %s"</span>, name, deltaErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> deltaResultsIterator.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Ensure the variable exists</span></span><br><span class="line">	<span class="keyword">if</span> !deltaResultsIterator.HasNext() &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"No variable by the name %s exists"</span>, name))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Iterate through result set and delete all indices</span></span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i = <span class="number">0</span>; deltaResultsIterator.HasNext(); i++ &#123;</span><br><span class="line">		responseRange, nextErr := deltaResultsIterator.Next()</span><br><span class="line">		<span class="keyword">if</span> nextErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not retrieve next delta row: %s"</span>, nextErr.Error()))</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		deltaRowDelErr := APIstub.DelState(responseRange.Key)</span><br><span class="line">		<span class="keyword">if</span> deltaRowDelErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Could not delete delta row: %s"</span>, deltaRowDelErr.Error()))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">"Deleted %s, %d rows removed"</span>, name, i)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Converts a float64 to a byte array</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param f The float64 to convert</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return The byte array representation</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2barr</span><span class="params">(f <span class="keyword">float64</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	str := strconv.FormatFloat(f, <span class="string">'f'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> []<span class="keyword">byte</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The main function is only relevant in unit test mode. Only included here for completeness.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Create a new Smart Contract</span></span><br><span class="line">	err := shim.Start(<span class="built_in">new</span>(SmartContract))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Error creating new Smart Contract: %s"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * All functions below this are for testing traditional editing of a single row</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">putStandard</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line">	valStr := args[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">	_, getErr := APIstub.GetState(name)</span><br><span class="line">	<span class="keyword">if</span> getErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Failed to retrieve the statr of %s: %s"</span>, name, getErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	putErr := APIstub.PutState(name, []<span class="keyword">byte</span>(valStr))</span><br><span class="line">	<span class="keyword">if</span> putErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Failed to put state: %s"</span>, putErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">getStandard</span><span class="params">(APIstub shim.ChaincodeStubInterface, args []<span class="keyword">string</span>)</span> <span class="title">sc</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">	name := args[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	val, getErr := APIstub.GetState(name)</span><br><span class="line">	<span class="keyword">if</span> getErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">"Failed to get state: %s"</span>, getErr.Error()))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shim.Success(val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h1><h2 id="setclienv-sh"><a href="#setclienv-sh" class="headerlink" title="setclienv.sh"></a>setclienv.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright IBM Corp All Rights Reserved</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CHANNEL_NAME=mychannel</span><br><span class="line"><span class="built_in">export</span> CC_NAME=bigdatacc</span><br></pre></td></tr></table></figure>

<h2 id="channel-setup-sh"><a href="#channel-setup-sh" class="headerlink" title="channel-setup.sh"></a>channel-setup.sh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright IBM Corp All Rights Reserved</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># Channel creation</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========== Creating channel: "</span><span class="variable">$CHANNEL_NAME</span><span class="string">" =========="</span></span><br><span class="line">peer channel create -o orderer.example.com:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ../channel-artifacts/channel.tx --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># peer0.org1 channel join</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========== Joining peer0.org1.example.com to channel mychannel =========="</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">"Org1MSP"</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">peer channel join -b <span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br><span class="line">peer channel update -o orderer.example.com:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ../channel-artifacts/<span class="variable">$&#123;CORE_PEER_LOCALMSPID&#125;</span>anchors.tx --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># peer1.org1 channel join</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========== Joining peer1.org1.example.com to channel mychannel =========="</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">"Org1MSP"</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt</span><br><span class="line">peer channel join -b <span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br><span class="line"></span><br><span class="line"><span class="comment"># peer0.org2 channel join</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========== Joining peer0.org2.example.com to channel mychannel =========="</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">"Org2MSP"</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt</span><br><span class="line">peer channel join -b <span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br><span class="line">peer channel update -o orderer.example.com:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ../channel-artifacts/<span class="variable">$&#123;CORE_PEER_LOCALMSPID&#125;</span>anchors.tx --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># peer1.org2 channel join</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========== Joining peer1.org2.example.com to channel mychannel =========="</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line"><span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">"Org2MSP"</span></span><br><span class="line"><span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt</span><br><span class="line">peer channel join -b <span class="variable">$&#123;CHANNEL_NAME&#125;</span>.block</span><br></pre></td></tr></table></figure>




        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2019-10-31T01:51:32.000Z" itemprop="dateUpdated">2019-10-31 09:51:32</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://cupswen.github.io">
            <img src="/img/the_Huanghe_River.png" alt="CupsWen">
            CupsWen
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fabric/" rel="tag">Fabric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fabric-samples/" rel="tag">fabric-samples</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&title=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&title=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2019/10/29/2019/high-throughput/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/10/31/2019/chaincode-docker-devmode/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">fabric-sample之chaincode-docker-devmode(开发者模式下调试chaincode)</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/10/29/2019/fabric-samples/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">窥探fabric-samples详细内容</h4>
      </a>
    </div>
  
</nav>



    

</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>CupsWen &copy; 2019 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme indigo.</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&title=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&pic=http://cupswen.github.io/img/the_Huanghe_River.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&title=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cupswen.github.io/2019/10/29/2019/high-throughput/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《fabric-samples之High-Throughput Network(高通量网络)》 — Cups&url=http://cupswen.github.io/2019/10/29/2019/high-throughput/&via=http://cupswen.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cupswen.github.io/2019/10/29/2019/high-throughput/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://cupswen.github.io/2019/10/29/2019/high-throughput/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Cups';
            clearTimeout(titleTime);
        } else {
            document.title = 'Cups';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
